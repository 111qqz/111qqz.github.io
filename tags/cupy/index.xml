<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>cupy on 111qqz的小窝</title><link>https://111qqz.com/tags/cupy/</link><description>Recent content in cupy on 111qqz的小窝</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>Copyright © 2012-2022 all rights reserved.</copyright><lastBuildDate>Sun, 17 Dec 2023 18:22:24 +0800</lastBuildDate><atom:link href="https://111qqz.com/tags/cupy/index.xml" rel="self" type="application/rss+xml"/><item><title>[施工中] cupy与torch的导入顺序不同对计算结果的影响</title><link>https://111qqz.com/2023/12/cupy-torch-import-order-impact/</link><pubDate>Sun, 17 Dec 2023 18:22:24 +0800</pubDate><guid>https://111qqz.com/2023/12/cupy-torch-import-order-impact/</guid><description>
背景 公司内部的基于torch的toolbox发现某个版本之后,结果发生了偏移. 通过一系列排查,发现当导入cupy和torch的顺序不同时，计算结果会有所差异。 也就是说,如下两段代码会导致模型训练等环节的计算得到不同的结果.
1import cupy as cp 2import torch 1import torch 2import cupy as cp 3 最小复现代码 经过一番努力,把问题从内部框架中剥离了出来. 如下是得到的最小复现代码. 通过调整import cupy与import torch的相对顺序,会得到不同的结果.
1# import cupy as cp 2import torch 3import torch.nn as nn 4import cupy as cp 5import random 6import numpy as np 7 8# 设置随机种子 9def set_random_seed(seed: int): 10 random.seed(seed) 11 np.random.seed(seed) 12 torch.manual_seed(seed) 13 torch.cuda.manual_seed(seed) 14 torch.cuda.manual_seed_all(seed) 15 cp.random.seed(seed) 16 17# 定义一个简单的MLP模型 18class MLP(nn.Module): 19 def __init__(self): 20 super(MLP, self).</description></item></channel></rss>
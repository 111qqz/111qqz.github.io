<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="111qqz的小窝"><meta property="og:type" content="article"><meta property="og:image" content="https://111qqz.github.io/img/2.png"><meta property="twitter:image" content="https://111qqz.github.io/img/2.png"><meta name=title content="SSD: Single Shot MultiBox Detector　学习笔记"><meta property="og:title" content="SSD: Single Shot MultiBox Detector　学习笔记"><meta property="twitter:title" content="SSD: Single Shot MultiBox Detector　学习笔记"><meta name=description content><meta property="og:description" content><meta property="twitter:description" content><meta property="twitter:card" content="summary"><meta name=keyword content="ACM,111qqz,商汤科技,hust,华中科技大学"><link rel="shortcut icon" href=/img/favicon.ico><title>SSD: Single Shot MultiBox Detector　学习笔记-111qqz的小窝</title><link rel=canonical href=/2019/12/single-short-detector><link rel=stylesheet href=/css/iDisqus.min.css><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hux-blog.min.css><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/zanshang.css><link href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/hux-blog.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=stylesheet href=/css/hux-blog.min.css><link rel=stylesheet href=/css/hux-blog.min-custom.css></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=/>111qqz的小窝</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>Home</a></li><li><a href=/categories/acm/>ACM-ICPC</a></li><li><a href=/categories/deep-learning/>深度学习</a></li><li><a href=/categories/mooc/>公开课</a></li><li><a href=/categories/%e5%85%b6%e4%bb%96/>其他</a></li><li><a href=/top/about/>ABOUT</a></li><li><a href=/search>SEARCH <img src=/img/search.png height=15 style=cursor:pointer alt=Search></a></li></ul></div></div></div></nav><script>var $body=document.body;var $toggle=document.querySelector('.navbar-toggle');var $navbar=document.querySelector('#huxblog_navbar');var $collapse=document.querySelector('.navbar-collapse');$toggle.addEventListener('click',handleMagic)
function handleMagic(e){if($navbar.className.indexOf('in')>0){$navbar.className=" ";setTimeout(function(){if($navbar.className.indexOf('in')<0){$collapse.style.height="0px"}},400)}else{$collapse.style.height="auto"
$navbar.className+=" in";}}</script><style type=text/css>header.intro-header{background-image:url(/img/2.png)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags><a class=tag href=/tags/ssd title=SSD>SSD</a>
<a class=tag href=/tags/single-state-detector title="single state detector">single state detector</a></div><h1>SSD: Single Shot MultiBox Detector　学习笔记</h1><h2 class=subheading></h2><span class=meta>Posted by
111qqz
on
Sunday, December 8, 2019</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><header><h2>TOC</h2></header><nav id=TableOfContents><ol><li><a href=#概述>概述</a></li><li><a href=#基本概念>基本概念</a><ol><li><a href=#prior-box>prior box</a></li><li><a href=#loss>loss</a></li><li><a href=#different-scales-of-feature-maps>different scales of feature maps</a></li></ol></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ol></nav><h2 id=概述>概述</h2><p>SSD是一种单阶段目标检测算法．所谓单阶段，是指只使用了一个deep neural network,而不是像faster-rcnn这种两阶段网络．
为什么有了faster-rcnn还要使用SSD? 最主要是慢&mldr;
两阶段网络虽然准确率高，但是在嵌入式等算力不足的设备上做inference速度非常感人，很难达到real time的要求．
（实际业务上也是这样，公有云上的检测模型几乎都是faster-rcnn,而到了一些盒子之类的硬件设备，检测模型就全是SSD等single stage 模型了)</p><p>之前一直没有写SSD是因为相比faster rcnn的细节，SSD的问题似乎并不是很多．直到最近转模型的时候被FASF模型的一个细节卡了蛮久，因此决定还是记录一下．</p><h2 id=基本概念>基本概念</h2><p>这部分描述SSD中涉及到的一些想法．</p><h3 id=prior-box>prior box</h3><p>prior box的概念其实与faster-rcnn中anchor的概念是一样的，没有本质区别．
与faster-rcnn中的anchor不同的是，SSD会在多个feature map中的每个cell 都生成若干个prior_box.</p><p>对于一个特定的feature map,尺寸为m*n,假设有k个prior box,c种类别．
那么feature map的每个location会生成<code> k*(c+4)</code> 个结果，其中c代表每一类的confidence. ４代表相对prior_box中心点的offset.
整个feature_map会生成　<code> kmn(c+4)</code> 个结果．</p><p>prior_box的参数选择,以及一些训练有关的细节可以参考原论文,这里不再赘述.
这里主要想强调一下和priox box有关的inference 细节.
主要是decode box的部分.</p><p>由于模型输出的bbox其实是相对每个prior_box的offset,不是真正的bbox,因此需要由网络输出的box_pred和prior box得到真正的bbox 坐标.这部分通常称为decode box,其实已经算是后处理部分了.</p><p>pytorch中decode box的代码如下:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python> variance1, variance2 <span style=color:#f92672>=</span> variance
        cx <span style=color:#f92672>=</span> box_prior[:, :,
                       <span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> box_pred[:, :, <span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> variance1 <span style=color:#f92672>*</span> box_prior[:, :, <span style=color:#ae81ff>2</span>]
        cy <span style=color:#f92672>=</span> box_prior[:, :,
                       <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> box_pred[:, :, <span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> variance1 <span style=color:#f92672>*</span> box_prior[:, :, <span style=color:#ae81ff>3</span>]
        w <span style=color:#f92672>=</span> box_prior[:, :, <span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> torch<span style=color:#f92672>.</span>exp(box_pred[:, :, <span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> variance2)
        h <span style=color:#f92672>=</span> box_prior[:, :, <span style=color:#ae81ff>3</span>] <span style=color:#f92672>+</span> torch<span style=color:#f92672>.</span>exp(box_pred[:, :, <span style=color:#ae81ff>3</span>] <span style=color:#f92672>*</span> variance2)
        x1 <span style=color:#f92672>=</span> cx <span style=color:#f92672>-</span> w <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
        y1 <span style=color:#f92672>=</span> cy <span style=color:#f92672>-</span> h <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>
        x2 <span style=color:#f92672>=</span> w <span style=color:#f92672>+</span> x1
        y2 <span style=color:#f92672>=</span> h <span style=color:#f92672>+</span> y1

</code></pre></div><p>不考虑variance的话,box_prior存储的四个数据按顺序分别为cx,cy,w,h
也就是prior_box的中心点坐标(cx,cy)以及宽和高.</p><p>而variance是一个原始paper中没有提到的实现细节.
按照<a href=https://github.com/rykov8/ssd_keras/issues/53> What is the purpose of the variances?</a> 的说法,</p><blockquote><p>Probably, the naming comes from the idea, that the ground truth bounding boxes are not always precise, in other words, they vary from image to image probably for the same object in the same position just because human labellers cannot ideally repeat themselves. Thus, the encoded values are some random values, and we want them to have unit variance that is why we divide by some value.</p></blockquote><p>可以理解成一个用来消除由标注引入的随机因素的手段.</p><p>更多bbox encoding/decoding的内容可以参考 <a href=https://leimao.github.io/blog/Bounding-Box-Encoding-Decoding/>Bounding Box Encoding and Decoding in Object Detection</a></p><p>对应的cuda代码</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=color:#66d9ef>template</span> <span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> Dtype<span style=color:#f92672>&gt;</span>
__global__ <span style=color:#66d9ef>void</span> OneStageDecodeBBoxesSSDKernel_v2(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> nthreads, <span style=color:#66d9ef>const</span> Dtype<span style=color:#f92672>*</span> loc_data,
        <span style=color:#66d9ef>const</span> Dtype<span style=color:#f92672>*</span> prior_data, <span style=color:#66d9ef>const</span> Dtype variance1, <span style=color:#66d9ef>const</span> Dtype variance2,
        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> num_priors,<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>bool</span> clip_bbox, Dtype<span style=color:#f92672>*</span> bbox_loc){

    CUDA_KERNEL_LOOP(index, nthreads) {
        <span style=color:#75715e>// loc: Batch, num_priors, 4, 1
</span><span style=color:#75715e></span>        <span style=color:#75715e>// proir: 1, num_priors, 4, 1
</span><span style=color:#75715e></span>        <span style=color:#75715e>// nthreads = Batch * num_priors * 2
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> x_or_y <span style=color:#f92672>=</span> index <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span>;
        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> pri_idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>int</span>( (index <span style=color:#f92672>%</span>(<span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>num_priors)) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>+</span> x_or_y;
        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> loc_idx <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>int</span>(index <span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>+</span> x_or_y;
        Dtype box0 <span style=color:#f92672>=</span>  prior_data[pri_idx];
        box0 <span style=color:#f92672>=</span> box0 <span style=color:#f92672>+</span> loc_data[loc_idx] <span style=color:#f92672>*</span> variance1 <span style=color:#f92672>*</span> box0; 
        Dtype box2 <span style=color:#f92672>=</span> prior_data[pri_idx <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> exp(variance2<span style=color:#f92672>*</span> loc_data[loc_idx<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>]);
        <span style=color:#75715e>// box0就是prior box的中心点坐标x或者y,
</span><span style=color:#75715e></span>        <span style=color:#75715e>// box2 就是prior box的w或者h. 
</span><span style=color:#75715e></span>        <span style=color:#75715e>// 下面的box0和box2复用了变量,但是实际上分别表示水平或者垂直方向的两个坐标.
</span><span style=color:#75715e></span>        box0 <span style=color:#f92672>-</span><span style=color:#f92672>=</span> box2<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>; 
        box2 <span style=color:#f92672>+</span><span style=color:#f92672>=</span> box0;
        bbox_loc[loc_idx]  <span style=color:#f92672>=</span> clip_bbox <span style=color:#f92672>?</span> min(max(box0, <span style=color:#ae81ff>0.0</span>),<span style=color:#ae81ff>1.0</span>)<span style=color:#f92672>:</span> box0;
        bbox_loc[loc_idx<span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> clip_bbox <span style=color:#f92672>?</span> min(max(box2, <span style=color:#ae81ff>0.0</span>),<span style=color:#ae81ff>1.0</span>)<span style=color:#f92672>:</span> box2;
    }
}

</code></pre></div><p>如果涉及到部署,一个要注意的细节是,pytorch代码和caffe代码中prior_box 顺序的一致性.</p><h3 id=loss>loss</h3><p>由于不(wo)涉(bu)及(hui)训练,loss不是关注的重点,简单说一句.
loss function是localization loss 和confidence loss 的加权和.
前半部分用来衡量bbox的loss,后半部分是分数的loss.
其中localization loss 如下图:
<img src=https://i.loli.net/2019/12/08/qtaCuV5vRD3y67n.png alt=ssd_loc_loss.png></p><p>而confidence loss就是 softmax loss.</p><h3 id=different-scales-of-feature-maps>different scales of feature maps</h3><p>神经网络越深的layer有着越大的感受野(receptive fileds),每个feature map cell包含着更抽象的信息. 我们可以用浅层的feature map来检测小物体,用深层的feture map来检测大物体.
<img src=https://i.loli.net/2019/12/08/ZioIuOMHesyCPGV.png alt="Pyramidal feature hierarchy.png"></p><p><del>这个想法后面会延伸到FPN,因此这里不详细讲了.</del>
还是可以讲一讲的</p><p>我们可以直接看torchvision的SSD代码，预测的Module部分</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PredictionConvolutions</span>(nn<span style=color:#f92672>.</span>Module):
    <span style=color:#e6db74></span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    Convolutions to predict class scores and bounding boxes using lower and higher-level feature maps.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    The bounding boxes (locations) are predicted as encoded offsets w.r.t each of the 8732 prior (default) boxes.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    See </span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>cxcy_to_gcxgcy</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74> in utils.py for the encoding definition.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    The class scores represent the scores of each object class in each of the 8732 bounding boxes located.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    A high score for </span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>background</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74> = no object.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>    </span><span style=color:#e6db74>&#34;&#34;&#34;</span>

    <span style=color:#66d9ef>def</span> __init__(self, n_classes):
        <span style=color:#e6db74></span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param n_classes: number of different types of objects</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        </span><span style=color:#e6db74>&#34;&#34;&#34;</span>
        super(PredictionConvolutions, self)<span style=color:#f92672>.</span>__init__()

        self<span style=color:#f92672>.</span>n_classes <span style=color:#f92672>=</span> n_classes

        <span style=color:#75715e># Number of prior-boxes we are considering per position in each feature map</span>
        n_boxes <span style=color:#f92672>=</span> {<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv4_3</span><span style=color:#e6db74>&#39;</span>: <span style=color:#ae81ff>4</span>,
                   <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv7</span><span style=color:#e6db74>&#39;</span>: <span style=color:#ae81ff>6</span>,
                   <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv8_2</span><span style=color:#e6db74>&#39;</span>: <span style=color:#ae81ff>6</span>,
                   <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv9_2</span><span style=color:#e6db74>&#39;</span>: <span style=color:#ae81ff>6</span>,
                   <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv10_2</span><span style=color:#e6db74>&#39;</span>: <span style=color:#ae81ff>4</span>,
                   <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv11_2</span><span style=color:#e6db74>&#39;</span>: <span style=color:#ae81ff>4</span>}
        <span style=color:#75715e># 4 prior-boxes implies we use 4 different aspect ratios, etc.</span>

        <span style=color:#75715e># Localization prediction convolutions (predict offsets w.r.t prior-boxes)</span>
        self<span style=color:#f92672>.</span>loc_conv4_3 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>512</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv4_3</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>loc_conv7 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>1024</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv7</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>loc_conv8_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>512</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv8_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>loc_conv9_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>256</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv9_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>loc_conv10_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>256</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv10_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>loc_conv11_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>256</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv11_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)

        <span style=color:#75715e># Class prediction convolutions (predict classes in localization boxes)</span>
        self<span style=color:#f92672>.</span>cl_conv4_3 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>512</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv4_3</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>cl_conv7 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>1024</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv7</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>cl_conv8_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>512</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv8_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>cl_conv9_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>256</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv9_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>cl_conv10_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>256</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv10_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
        self<span style=color:#f92672>.</span>cl_conv11_2 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>256</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv11_2</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)

        <span style=color:#75715e># Initialize convolutions&#39; parameters</span>
        self<span style=color:#f92672>.</span>init_conv2d()

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>init_conv2d</span>(self):
        <span style=color:#e6db74></span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        Initialize convolution parameters.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        </span><span style=color:#e6db74>&#34;&#34;&#34;</span>
        <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>children():
            <span style=color:#66d9ef>if</span> isinstance(c, nn<span style=color:#f92672>.</span>Conv2d):
                nn<span style=color:#f92672>.</span>init<span style=color:#f92672>.</span>xavier_uniform_(c<span style=color:#f92672>.</span>weight)
                nn<span style=color:#f92672>.</span>init<span style=color:#f92672>.</span>constant_(c<span style=color:#f92672>.</span>bias, <span style=color:#ae81ff>0.</span>)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>forward</span>(self, conv4_3_feats, conv7_feats, conv8_2_feats, conv9_2_feats, conv10_2_feats, conv11_2_feats):
        <span style=color:#e6db74></span><span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        Forward propagation.</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param conv4_3_feats: conv4_3 feature map, a tensor of dimensions (N, 512, 38, 38)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param conv7_feats: conv7 feature map, a tensor of dimensions (N, 1024, 19, 19)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param conv8_2_feats: conv8_2 feature map, a tensor of dimensions (N, 512, 10, 10)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param conv9_2_feats: conv9_2 feature map, a tensor of dimensions (N, 256, 5, 5)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param conv10_2_feats: conv10_2 feature map, a tensor of dimensions (N, 256, 3, 3)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :param conv11_2_feats: conv11_2 feature map, a tensor of dimensions (N, 256, 1, 1)</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        :return: 8732 locations and class scores (i.e. w.r.t each prior box) for each image</span><span style=color:#e6db74>
</span><span style=color:#e6db74></span><span style=color:#e6db74>        </span><span style=color:#e6db74>&#34;&#34;&#34;</span>
        batch_size <span style=color:#f92672>=</span> conv4_3_feats<span style=color:#f92672>.</span>size(<span style=color:#ae81ff>0</span>)

        <span style=color:#75715e># Predict localization boxes&#39; bounds (as offsets w.r.t prior-boxes)</span>
        l_conv4_3 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv4_3(conv4_3_feats)  <span style=color:#75715e># (N, 16, 38, 38)</span>
        l_conv4_3 <span style=color:#f92672>=</span> l_conv4_3<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>,
                                      <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 38, 38, 16), to match prior-box order (after .view())</span>
        <span style=color:#75715e># (.contiguous() ensures it is stored in a contiguous chunk of memory, needed for .view() below)</span>
        l_conv4_3 <span style=color:#f92672>=</span> l_conv4_3<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 5776, 4), there are a total 5776 boxes on this feature map</span>

        l_conv7 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv7(conv7_feats)  <span style=color:#75715e># (N, 24, 19, 19)</span>
        l_conv7 <span style=color:#f92672>=</span> l_conv7<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 19, 19, 24)</span>
        l_conv7 <span style=color:#f92672>=</span> l_conv7<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 2166, 4), there are a total 2116 boxes on this feature map</span>

        l_conv8_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv8_2(conv8_2_feats)  <span style=color:#75715e># (N, 24, 10, 10)</span>
        l_conv8_2 <span style=color:#f92672>=</span> l_conv8_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 10, 10, 24)</span>
        l_conv8_2 <span style=color:#f92672>=</span> l_conv8_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 600, 4)</span>

        l_conv9_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv9_2(conv9_2_feats)  <span style=color:#75715e># (N, 24, 5, 5)</span>
        l_conv9_2 <span style=color:#f92672>=</span> l_conv9_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 5, 5, 24)</span>
        l_conv9_2 <span style=color:#f92672>=</span> l_conv9_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 150, 4)</span>

        l_conv10_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv10_2(conv10_2_feats)  <span style=color:#75715e># (N, 16, 3, 3)</span>
        l_conv10_2 <span style=color:#f92672>=</span> l_conv10_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 3, 3, 16)</span>
        l_conv10_2 <span style=color:#f92672>=</span> l_conv10_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 36, 4)</span>

        l_conv11_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv11_2(conv11_2_feats)  <span style=color:#75715e># (N, 16, 1, 1)</span>
        l_conv11_2 <span style=color:#f92672>=</span> l_conv11_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 1, 1, 16)</span>
        l_conv11_2 <span style=color:#f92672>=</span> l_conv11_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 4, 4)</span>

        <span style=color:#75715e># Predict classes in localization boxes</span>
        c_conv4_3 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv4_3(conv4_3_feats)  <span style=color:#75715e># (N, 4 * n_classes, 38, 38)</span>
        c_conv4_3 <span style=color:#f92672>=</span> c_conv4_3<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>,
                                      <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 38, 38, 4 * n_classes), to match prior-box order (after .view())</span>
        c_conv4_3 <span style=color:#f92672>=</span> c_conv4_3<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,
                                   self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 5776, n_classes), there are a total 5776 boxes on this feature map</span>

        c_conv7 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv7(conv7_feats)  <span style=color:#75715e># (N, 6 * n_classes, 19, 19)</span>
        c_conv7 <span style=color:#f92672>=</span> c_conv7<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 19, 19, 6 * n_classes)</span>
        c_conv7 <span style=color:#f92672>=</span> c_conv7<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,
                               self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 2166, n_classes), there are a total 2116 boxes on this feature map</span>

        c_conv8_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv8_2(conv8_2_feats)  <span style=color:#75715e># (N, 6 * n_classes, 10, 10)</span>
        c_conv8_2 <span style=color:#f92672>=</span> c_conv8_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 10, 10, 6 * n_classes)</span>
        c_conv8_2 <span style=color:#f92672>=</span> c_conv8_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 600, n_classes)</span>

        c_conv9_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv9_2(conv9_2_feats)  <span style=color:#75715e># (N, 6 * n_classes, 5, 5)</span>
        c_conv9_2 <span style=color:#f92672>=</span> c_conv9_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 5, 5, 6 * n_classes)</span>
        c_conv9_2 <span style=color:#f92672>=</span> c_conv9_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 150, n_classes)</span>

        c_conv10_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv10_2(conv10_2_feats)  <span style=color:#75715e># (N, 4 * n_classes, 3, 3)</span>
        c_conv10_2 <span style=color:#f92672>=</span> c_conv10_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 3, 3, 4 * n_classes)</span>
        c_conv10_2 <span style=color:#f92672>=</span> c_conv10_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 36, n_classes)</span>

        c_conv11_2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv11_2(conv11_2_feats)  <span style=color:#75715e># (N, 4 * n_classes, 1, 1)</span>
        c_conv11_2 <span style=color:#f92672>=</span> c_conv11_2<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 1, 1, 4 * n_classes)</span>
        c_conv11_2 <span style=color:#f92672>=</span> c_conv11_2<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 4, n_classes)</span>

        <span style=color:#75715e># A total of 8732 boxes</span>
        <span style=color:#75715e># Concatenate in this specific order (i.e. must match the order of the prior-boxes)</span>
        locs <span style=color:#f92672>=</span> torch<span style=color:#f92672>.</span>cat([l_conv4_3, l_conv7, l_conv8_2, l_conv9_2, l_conv10_2, l_conv11_2], dim<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)  <span style=color:#75715e># (N, 8732, 4)</span>
        classes_scores <span style=color:#f92672>=</span> torch<span style=color:#f92672>.</span>cat([c_conv4_3, c_conv7, c_conv8_2, c_conv9_2, c_conv10_2, c_conv11_2],
                                   dim<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)  <span style=color:#75715e># (N, 8732, n_classes)</span>

        <span style=color:#66d9ef>return</span> locs, classes_scores


</code></pre></div><p>位置的预测和分数的预测可以分两部分来看</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>
    self<span style=color:#f92672>.</span>loc_conv4_3 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>512</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv4_3</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
    <span style=color:#75715e># n_boxes里面是不同的feature_map中每个位置的prior box的数量 n_boxes[&#39;conv4_3&#39;] * 4是因为bbox有四个坐标（以offset的形式)</span>

    <span style=color:#75715e># conv4_3_feats:(N, 512, 38, 38)</span>
    <span style=color:#75715e># Predict localization boxes&#39; bounds (as offsets w.r.t prior-boxes)</span>
    l_conv4_3 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>loc_conv4_3(conv4_3_feats)  <span style=color:#75715e># (N, 16, 38, 38)</span>
    <span style=color:#75715e># shape中的16的含义是，每个位置有4个prior box,每个box有4个坐标。 这16个值坐落在16个channel上</span>
    l_conv4_3 <span style=color:#f92672>=</span> l_conv4_3<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>,
                                <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 38, 38, 16), to match prior-box order (after .view())</span>
    <span style=color:#75715e># (.contiguous() ensures it is stored in a contiguous chunk of memory, needed for .view() below)</span>
    l_conv4_3 <span style=color:#f92672>=</span> l_conv4_3<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>4</span>)  <span style=color:#75715e># (N, 5776, 4), there are a total 5776 boxes on this </span>

    <span style=color:#75715e>#  5776个box是 38*38的feature map上每个位置上有4个。 38*38*4=5776</span>

</code></pre></div><p>然后是分数的预测,我们注意到对于feature map上每个位置的每个prior box都有一个conf
<strong>注意这里对于每个prior box，虽然有多个类别的分数，但是他们的位置预测只有一组值，这里和frcnn是不同的</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>  <span style=color:#75715e># Class prediction convolutions (predict classes in localization boxes)</span>
    self<span style=color:#f92672>.</span>cl_conv4_3 <span style=color:#f92672>=</span> nn<span style=color:#f92672>.</span>Conv2d(<span style=color:#ae81ff>512</span>, n_boxes[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>conv4_3</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>*</span> n_classes, kernel_size<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, padding<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)

    <span style=color:#75715e># Predict classes in localization boxes</span>
    c_conv4_3 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>cl_conv4_3(conv4_3_feats)  <span style=color:#75715e># (N, 4 * n_classes, 38, 38)</span>
    c_conv4_3 <span style=color:#f92672>=</span> c_conv4_3<span style=color:#f92672>.</span>permute(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>,
                                    <span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>contiguous()  <span style=color:#75715e># (N, 38, 38, 4 * n_classes), to match prior-box order (after .view())</span>
    c_conv4_3 <span style=color:#f92672>=</span> c_conv4_3<span style=color:#f92672>.</span>view(batch_size, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,
                                self<span style=color:#f92672>.</span>n_classes)  <span style=color:#75715e># (N, 5776, n_classes), there are a total 5776 boxes on this feature map</span>


</code></pre></div><h2 id=总结>总结</h2><ul><li>使用不同scale的feature map来预测，提升了准确度。</li><li>预测bbox使用预测默认bbox(prior box)的offset的方式，使得使用small conv filters即可达到不错的效果，减少了计算。</li></ul><h2 id=参考资料>参考资料</h2><ul><li><a href=https://arxiv.org/pdf/1512.02325.pdf>原始论文</a></li><li><a href=https://arxiv.org/pdf/1612.03144.pdf>Feature Pyramid Networks for Object Detection</a></li><li><a href=https://medium.com/@smallfishbigsea/understand-ssd-and-implement-your-own-caa3232cd6ad>Understand Single Shot MultiBox Detector (SSD) and Implement It in Pytorch</a></li></ul><div class="entry-shang text-center"><p>「真诚赞赏，手留余香」</p><button class="zs show-zs btn btn-bred">赞赏支持</button></div><div class=zs-modal-bg></div><div class=zs-modal-box><div class=zs-modal-head><button type=button class=close>×</button>
<span class=author><a href=https://111qqz.github.io><img src=/img/favicon.png>111qqz的小窝</a></span><p class=tip><i></i><span>真诚赞赏，手留余香</span></p></div><div class=zs-modal-body><div class=zs-modal-btns><button class="btn btn-blink" data-num=2>2元</button>
<button class="btn btn-blink" data-num=5>5元</button>
<button class="btn btn-blink" data-num=10>10元</button>
<button class="btn btn-blink" data-num=50>50元</button>
<button class="btn btn-blink" data-num=100>100元</button>
<button class="btn btn-blink" data-num=1>任意金额</button></div><div class=zs-modal-pay><button class="btn btn-bred" id=pay-text>2元</button><p>使用<span id=pay-type>微信</span>扫描二维码完成支付</p><img src=/img/reward/wechat-2.png id=pay-image></div></div><div class=zs-modal-footer><label><input type=radio name=zs-type value=wechat class=zs-type checked><span><span class=zs-wechat><img src=/img/reward/wechat-btn.png></span></label>
<label><input type=radio name=zs-type value=alipay class=zs-type class=zs-alipay><img src=/img/reward/alipay-btn.png></span></label></div></div><script type=text/javascript src=/js/reward.js></script><hr><ul class=pager><li class=previous><a href=/2019/11/rankboost-Algorithm data-toggle=tooltip data-placement=top title="rankboost 算法学习笔记">&larr;
Previous Post</a></li><li class=next><a href=/2019/12/feature-pyramid-networks data-toggle=tooltip data-placement=top title="FPN:Feature Pyramid Networks 学习笔记">Next
Post &rarr;</a></li></ul><div id=git-comments></div><link rel=stylesheet href=https://wzxjayce.github.io/gitment.css><script src=https://wzxjayce.github.io/gitment.js></script><script>var gitment=new Gitment({id:decodeURI(window.location.pathname),owner:'111qqz',repo:'111qqz.github.io',oauth:{client_id:'8839ce5e58d5197e2490',client_secret:'2d475a8a7e27a8b509847a6c60f692b8cbaa274e',}})
gitment.render('git-comments')</script></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/bfs title=bfs>bfs</a>
<a href=/tags/binary-search title=binary-search>binary-search</a>
<a href=/tags/brute-force title=brute-force>brute-force</a>
<a href=/tags/c++ title=c++>c++</a>
<a href=/tags/caffe title=caffe>caffe</a>
<a href=/tags/dfs title=dfs>dfs</a>
<a href=/tags/dp title=dp>dp</a>
<a href=/tags/greedy title=greedy>greedy</a>
<a href=/tags/hash title=hash>hash</a>
<a href=/tags/km title=km>km</a>
<a href=/tags/kmp title=kmp>kmp</a>
<a href=/tags/leetcode title=leetcode>leetcode</a>
<a href=/tags/math title=math>math</a>
<a href=/tags/number-theory title=number-theory>number-theory</a>
<a href=/tags/rmq title=rmq>rmq</a>
<a href=/tags/sg%E5%87%BD%E6%95%B0 title=sg函数>sg函数</a>
<a href=/tags/stl title=stl>stl</a>
<a href=/tags/tensorflow title=tensorflow>tensorflow</a>
<a href=/tags/%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E4%BD%B3%E5%8C%B9%E9%85%8D title=二分图最佳匹配>二分图最佳匹配</a>
<a href=/tags/%E5%88%86%E5%9D%97 title=分块>分块</a>
<a href=/tags/%E5%89%8D%E7%BC%80%E5%92%8C title=前缀和>前缀和</a>
<a href=/tags/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95 title=匈牙利算法>匈牙利算法</a>
<a href=/tags/%E5%8C%BA%E9%97%B4dp title=区间dp>区间dp</a>
<a href=/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA title=博弈论>博弈论</a>
<a href=/tags/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA title=后缀自动机>后缀自动机</a>
<a href=/tags/%E5%9B%BE%E8%AE%BA title=图论>图论</a>
<a href=/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2 title=字符串>字符串</a>
<a href=/tags/%E5%BF%AB%E9%80%9F%E5%B9%82 title=快速幂>快速幂</a>
<a href=/tags/%E6%95%B0%E4%BD%8Ddp title=数位dp>数位dp</a>
<a href=/tags/%E6%9E%84%E9%80%A0 title=构造>构造</a>
<a href=/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84 title=树状数组>树状数组</a>
<a href=/tags/%E6%A6%82%E7%8E%87 title=概率>概率</a>
<a href=/tags/%E6%A8%A1%E6%8B%9F title=模拟>模拟</a>
<a href=/tags/%E6%AF%8D%E5%87%BD%E6%95%B0 title=母函数>母函数</a>
<a href=/tags/%E7%9F%A9%E9%98%B5 title=矩阵>矩阵</a>
<a href=/tags/%E7%A6%BB%E6%95%A3%E5%8C%96 title=离散化>离散化</a>
<a href=/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91 title=线段树>线段树</a>
<a href=/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95 title=计算几何>计算几何</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://111qqz.com>111qqz的wordpress博客</a></li></ul></section></div></div></div></article><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href rel=alternate type=application/rss+xml title=111qqz的小窝><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li><a href=mailto:hust.111qqz@gmail.com><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=/img/wechat.jpg><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-wechat fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/111qqz/><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 111qqz的小窝 2021<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function async(u,c){var d=document,t='script',o=d.createElement(t),s=d.getElementsByTagName(t)[0];o.src=u;if(c){o.addEventListener('load',function(e){c(null,e);},false);}
s.parentNode.insertBefore(o,s);}</script><script>if($('#tag_cloud').length!==0){async("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:'#bbbbee',end:'#0085a1'},};$('#tag_cloud a').tagcloud();})}</script><script>async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js",function(){var $nav=document.querySelector("nav");if($nav)FastClick.attach($nav);})</script></body></html>
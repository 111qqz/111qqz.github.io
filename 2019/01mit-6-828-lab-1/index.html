<!doctype html><html lang=zh data-figures class=page><head><title>ã€æ–½å·¥å®Œæˆã€‘MIT 6.828 lab 1: C, Assembly, Tools and Bootstrapping | 111qqzçš„å°çª</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-219255388-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-219255388-1")</script><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta name=description content="èŠ±è´¹äº†30+å°æ—¶ï¼Œç»ˆäºæå®šäº†orz
Part 1: PC Bootstrap
The PC&rsquo;s Physical Address Space
8086/8088æ—¶ä»£
 1+------------------+  <- 0x00100000 (1MB)
 2|     BIOS ROM     | â€¦"><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta name=twitter:title content="ã€æ–½å·¥å®Œæˆã€‘MIT 6.828 lab 1: C, Assembly, Tools and Bootstrapping"><meta property="og:url" content="https://111qqz.com/2019/01mit-6-828-lab-1/"><meta property="og:title" content="ã€æ–½å·¥å®Œæˆã€‘MIT 6.828 lab 1: C, Assembly, Tools and Bootstrapping"><meta property="og:description" content="èŠ±è´¹äº†30+å°æ—¶ï¼Œç»ˆäºæå®šäº†orz
Part 1: PC Bootstrap
The PC&rsquo;s Physical Address Space
8086/8088æ—¶ä»£
 1+------------------+  <- 0x00100000 (1MB)
 2|     BIOS ROM     | â€¦"><meta property="og:image" content="https://111qqz.com/images/2.png"><link rel=apple-touch-icon sizes=180x180 href=https://111qqz.com/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://111qqz.com/icons/favicon-32x32.png><link rel=manifest href=https://111qqz.com/icons/site.webmanifest><link rel=canonical href=https://111qqz.com/2019/01mit-6-828-lab-1/><link rel=preload href=https://111qqz.com/css/styles.f143f2039d975cd60c5524f52c5fbb6dd2236d44d0d53d71b5cb6f6127d4fe8082960bbb71fe0345b5bab4119124e0b09c0b7d7f4238a9288afc02815d258f76.css integrity="sha512-8UPyA52XXNYMVST1LF+7bdIjbUTQ1T1xtctvYSfU/oCClgu7cf4DRbW6tBGRJOCwnAt9f0I4qSiK/AKBXSWPdg==" as=style crossorigin=anonymous><link rel=preload href=https://111qqz.com/js/bundle.min.bcaa4356b3671ffa6f41987d56e87dfd749683d23fd99a70769b5dda29225b669759d387454da9cdf0988ec4da70f274486671d24ab4dcea2ae987fe33bdc030.js as=script integrity="sha512-vKpDVrNnH/pvQZh9Vuh9/XSWg9I/2Zpwdptd2ikiW2aXWdOHRU2pzfCYjsTacPJ0SGZx0kq03Ooq6Yf+M73AMA==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://111qqz.com/css/styles.f143f2039d975cd60c5524f52c5fbb6dd2236d44d0d53d71b5cb6f6127d4fe8082960bbb71fe0345b5bab4119124e0b09c0b7d7f4238a9288afc02815d258f76.css integrity="sha512-8UPyA52XXNYMVST1LF+7bdIjbUTQ1T1xtctvYSfU/oCClgu7cf4DRbW6tBGRJOCwnAt9f0I4qSiK/AKBXSWPdg==" crossorigin=anonymous></head><body data-code=15 data-lines=true id=documentTop><header class=nav_header><nav class=nav><a href=https://111qqz.com/ class="nav_brand nav_item" title=111qqzçš„å°çª><img src=https://111qqz.com/logos/logo.png class=logo alt=111qqzçš„å°çª><div class=nav_close><div><svg class="icon"><use xlink:href="#open-menu"/></svg><svg class="icon"><use xlink:href="#closeme"/></svg></div></div></a><div class='nav_body nav_body_left'><div class=nav_parent><a href=https://111qqz.com/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://111qqz.com/categories/acm/ class=nav_item title=ACM-ICPC>ACM-ICPC</a></div><div class=nav_parent><a href=https://111qqz.com/ class=nav_item title=æ·±åº¦å­¦ä¹ >æ·±åº¦å­¦ä¹  <img src=https://111qqz.com/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://111qqz.com/tags/caffe/ class="nav_child nav_item" title=caffeæºç é˜…è¯»ç¬”è®°>caffeæºç é˜…è¯»ç¬”è®°</a>
<a href=https://111qqz.com/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/ class="nav_child nav_item" title=æ¨èç³»ç»Ÿ>æ¨èç³»ç»Ÿ</a>
<a href=https://111qqz.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89 class="nav_child nav_item" title=è®¡ç®—æœºè§†è§‰>è®¡ç®—æœºè§†è§‰</a></div></div><div class=nav_parent><a href=https://111qqz.com/ class=nav_item title=å…¬å¼€è¯¾>å…¬å¼€è¯¾ <img src=https://111qqz.com/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://111qqz.com/tags/6.828/ class="nav_child nav_item" title=6.828>6.828</a>
<a href=https://111qqz.com/tags/cs341/ class="nav_child nav_item" title=CS341>CS341</a>
<a href=https://111qqz.com/tags/csapp/ class="nav_child nav_item" title=CSAPP>CSAPP</a></div></div><div class=nav_parent><a href=https://111qqz.com/ class=nav_item title=å·¥ç¨‹>å·¥ç¨‹ <img src=https://111qqz.com/icons/caret-icon.svg alt=icon class=nav_icon></a><div class=nav_sub><span class=nav_child></span>
<a href=https://111qqz.com/tags/cpp class="nav_child nav_item" title=cpp>cpp</a>
<a href=https://111qqz.com/tags/cuda class="nav_child nav_item" title=cuda>cuda</a>
<a href=https://111qqz.com/tags/leveldb class="nav_child nav_item" title=levelDBæºç ç¬”è®°>levelDBæºç ç¬”è®°</a>
<a href=https://111qqz.com/tags/linux class="nav_child nav_item" title=linux>linux</a>
<a href=https://111qqz.com/tags/%E5%89%8D%E7%AB%AF class="nav_child nav_item" title=å‰ç«¯>å‰ç«¯</a>
<a href=https://111qqz.com/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86 class="nav_child nav_item" title=å›¾åƒå¤„ç†>å›¾åƒå¤„ç†</a>
<a href=https://111qqz.com/tags/docker class="nav_child nav_item" title=å®¹å™¨>å®¹å™¨</a></div></div><div class=nav_parent><a href=https://111qqz.com/categories/%E9%9A%8F%E7%AC%94%E6%9D%82%E8%B0%88 class=nav_item title=éšç¬”æ‚è°ˆ>éšç¬”æ‚è°ˆ</a></div><div class=nav_parent><a href=https://111qqz.com/tags/%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%8E%86 class=nav_item title=é¢è¯•>é¢è¯•</a></div><div class=nav_parent><a href=https://111qqz.com/top/about/ class=nav_item title=About>About</a></div><div class=nav_parent><a href=# class=nav_item>ğŸŒ</a><div class=nav_sub><span class=nav_child></span>
<a href=https://111qqz.com/ class="nav_child nav_item">ä¸­æ–‡</a>
<a href=https://111qqz.com/en/ class="nav_child nav_item">English</a></div></div><div class=follow><a href=https://github.com/111qqz><svg class="icon"><use xlink:href="#github"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title>ã€æ–½å·¥å®Œæˆã€‘MIT 6.828 lab 1: C, Assembly, Tools and Bootstrapping</h1><div class=post_meta><span><svg class="icon"><use xlink:href="#calendar"/></svg></span>
<span class=post_date>2019-01-24</span>
<span class=post_time>Â· 40 min read</span><span>&nbsp;Â· <a href=https://111qqz.com/tags/6.828 title=6.828 class="post_tag button button_translucent">6.828</a></span></div><div class=post_toc><h2>æ–‡ç« ç›®å½•</h2><nav id=TableOfContents><ol><li><a href=#èŠ±è´¹äº†30å°æ—¶ç»ˆäºæå®šäº†orz>èŠ±è´¹äº†30+å°æ—¶ï¼Œç»ˆäºæå®šäº†orz</a></li><li><a href=#part-1-pc-bootstrap>Part 1: PC Bootstrap</a><ol><li><a href=#the-pcs-physical-address-space>The PC&rsquo;s Physical Address Space</a></li><li><a href=#the-rom-bios>The ROM BIOS</a></li></ol></li><li><a href=#part-2-the-boot-loader>Part 2: The Boot Loader</a><ol><li><a href=#real-mode--protected-mode>real mode / protected mode</a></li><li><a href=#bootbootsæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ>boot/boot.Sæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ</a></li><li><a href=#bootmaincè¿™ä¸ªæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ>boot/main.cè¿™ä¸ªæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ</a></li><li><a href=#loading-the-kernel>Loading the Kernel</a></li><li><a href=#elfæ–‡ä»¶>ELFæ–‡ä»¶</a></li></ol></li><li><a href=#part-3-the-kernel>Part 3: The Kernel</a><ol><li><a href=#using-virtual-memory-to-work-around-position-dependence>Using virtual memory to work around position dependence</a></li><li><a href=#formatted-printing-to-the-console>Formatted Printing to the Console</a></li><li><a href=#the-stack>The Stack</a></li></ol></li></ol></nav></div><div class=post_body><h2 id=èŠ±è´¹äº†30å°æ—¶ç»ˆäºæå®šäº†orz>èŠ±è´¹äº†30+å°æ—¶ï¼Œç»ˆäºæå®šäº†orz</h2><h2 id=part-1-pc-bootstrap>Part 1: PC Bootstrap</h2><h3 id=the-pcs-physical-address-space>The PC&rsquo;s Physical Address Space</h3><h4 id=80868088æ—¶ä»£>8086/8088æ—¶ä»£</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x00100000</span> <span class=p>(</span><span class=mi>1</span><span class=n>MB</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>|</span>     <span class=n>BIOS</span> <span class=n>ROM</span>     <span class=o>|</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x000F0000</span> <span class=p>(</span><span class=mi>960</span><span class=n>KB</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=o>|</span>  <span class=mi>16</span><span class=o>-</span><span class=n>bit</span> <span class=n>devices</span><span class=p>,</span> <span class=o>|</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=o>|</span>  <span class=n>expansion</span> <span class=n>ROMs</span>  <span class=o>|</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x000C0000</span> <span class=p>(</span><span class=mi>768</span><span class=n>KB</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=o>|</span>   <span class=n>VGA</span> <span class=n>Display</span>    <span class=o>|</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x000A0000</span> <span class=p>(</span><span class=mi>640</span><span class=n>KB</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=o>|</span>    <span class=n>Low</span> <span class=n>Memory</span>    <span class=o>|</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x00000000</span>
</span></span></code></pre></div><p>ç”±äº8086/8088åªæœ‰20è·Ÿåœ°å€çº¿ï¼Œå› æ­¤ç‰©ç†å†…å­˜ç©ºé—´å°±æ˜¯2^20=1MB.åœ°å€ç©ºé—´ä»0x00000åˆ°0xFFFFF.å…¶ä¸­ä»0x00000å¼€å§‹çš„640kç©ºé—´è¢«ç§°ä¸º"low memory"ï¼Œæ˜¯PCçœŸæ­£èƒ½ä½¿ç”¨çš„RAMã€‚ä» 0xA0000 åˆ° 0xFFFFFã€€çš„384kçš„non-volatile memoryè¢«ç¡¬ä»¶ä¿ç•™ï¼Œç”¨ä½œvideo display bufferså’ŒBIOSç­‰ã€‚</p><h4 id=8028680386æ—¶ä»£åŠä»¥å>80286/80386æ—¶ä»£åŠä»¥å</h4><p>ä¸ºäº†ä¿æŒå‘åå…¼å®¹ï¼Œå› æ­¤0-1MBçš„ç©ºé—´è¿˜æ˜¯å’ŒåŸæ¥ä¿æŒä¸€è‡´ã€‚å› æ­¤åœ°å€ç©ºé—´ä¼¼ä¹å­˜åœ¨ä¸€ä¸ªâ€œæ´â€ï¼ˆä¸ºä»€ä¹ˆæˆ‘è§‰å¾—å…¶å®æ˜¯ä¸¤ä¸ªâ€œæ´â€ã€‚ã€‚ã€‚ä¸æ˜¯ç©ºç€çš„æ‰å«â€œæ´â€å—ï¼‰ï¼ŒPCèƒ½ä½¿ç”¨çš„RAMè¢«è¿™ä¸ªâ€œæ´â€ï¼ˆä¹Ÿå°±æ˜¯0xA0000 åˆ° 0xFFFFF)åˆ†æˆäº†0x00000000åˆ°0x000BFFFFçš„640kå’ŒÂ 0x00100000åˆ°0xFFFFFFFFä¸¤éƒ¨åˆ†ã€‚</p><table align=center><tbody><tr><td><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0xFFFFFFFF</span> <span class=p>(</span><span class=mi>4</span><span class=n>GB</span><span class=p>)</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=o>|</span>      <span class=mi>32</span><span class=o>-</span><span class=n>bit</span>      <span class=o>|</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=o>|</span>  <span class=n>memory</span> <span class=n>mapped</span>   <span class=o>|</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=o>|</span>     <span class=n>devices</span>      <span class=o>|</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span><span class=o>/</span><span class=err>\</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=o>|</span>      <span class=n>Unused</span>      <span class=o>|</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=n>depends</span> <span class=n>on</span> <span class=n>amount</span> <span class=n>of</span> <span class=n>RAM</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=o>|</span> <span class=n>Extended</span> <span class=n>Memory</span>  <span class=o>|</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x00100000</span> <span class=p>(</span><span class=mi>1</span><span class=n>MB</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=o>|</span>     <span class=n>BIOS</span> <span class=n>ROM</span>     <span class=o>|</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x000F0000</span> <span class=p>(</span><span class=mi>960</span><span class=n>KB</span><span class=p>)</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=o>|</span>  <span class=mi>16</span><span class=o>-</span><span class=n>bit</span> <span class=n>devices</span><span class=p>,</span> <span class=o>|</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=o>|</span>  <span class=n>expansion</span> <span class=n>ROMs</span>  <span class=o>|</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x000C0000</span> <span class=p>(</span><span class=mi>768</span><span class=n>KB</span><span class=p>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=o>|</span>   <span class=n>VGA</span> <span class=n>Display</span>    <span class=o>|</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x000A0000</span> <span class=p>(</span><span class=mi>640</span><span class=n>KB</span><span class=p>)</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=o>|</span>    <span class=n>Low</span> <span class=n>Memory</span>    <span class=o>|</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=o>|</span>                  <span class=o>|</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=o>+------------------+</span>  <span class=o>&lt;-</span> <span class=mh>0x00000000</span>
</span></span></code></pre></div></td></tr></tbody></table>æ­¤å¤–ï¼Œåœ¨åœ°å€ç©ºé—´çš„æœ€ä¸Šé¢ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸è¢«BIOSä¿ç•™ç”¨äºÂ 32-bit PCI devicesçš„memory mapped. memory mappedæ˜¯å¯¹äºmemoryå’ŒI/Oè®¾å¤‡ä½¿ç”¨ç›¸åŒçš„åœ°å€ç©ºé—´çš„ä¸€ç§I/Oå¯»å€æ–¹å¼ã€‚å…·ä½“å¯ä»¥å‚è€ƒ[Memory-mapped I/O](https://en.wikipedia.org/wiki/Memory-mapped_I/O)ã€‚PCIè®¾å¤‡å…·ä½“å¯ä»¥å‚è€ƒ[PCI_Express](https://en.wikipedia.org/wiki/PCI_Express)å’Œ[æ·±å…¥PCIä¸PCIeä¹‹ä¸€ï¼šç¡¬ä»¶ç¯‡](https://zhuanlan.zhihu.com/p/26172972)<p>ç›®å‰å¤„ç†å™¨å·²ç»å¯ä»¥æ”¯æŒè¶…è¿‡4GBå¤§å°çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤ä¸ºäº†ä¿æŒåå‘å…¼å®¹æ€§ï¼Œåœ°å€ç©ºé—´åˆä¼šå¤šä¸€ä¸ª"æ´"ã€‚</p><h3 id=the-rom-bios>The ROM BIOS</h3><p>ç”¨qemuæ¨¡æ‹Ÿå¯åŠ¨ï¼Œè§‚å¯Ÿåˆ°è¿›å…¥BIOSæ‰§è¡Œçš„ç¬¬ä¸€æ¡å‘½ä»¤ä¸º</p><pre><code>[f000:fff0]    0xffff0: ljmp   $0xf000,$0xe05b
</code></pre><p>è¯´æ˜PCæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„ç‰©ç†åœ°å€ä¸º0xffff0ã€‚</p><p>ç„¶åä½¿ç”¨siå‘½ä»¤æ‰§è¡Œå•æ­¥æŒ‡ä»¤,å¾—åˆ°çš„å‰é¢å‡ æ¡æ‰§è¡Œçš„æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln>1</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e05b</span><span class=p>]</span>    <span class=mi>0xfe05b</span><span class=p>:</span> <span class=no>cmpl</span>   <span class=no>$0x0</span><span class=p>,</span><span class=nv>%cs</span><span class=p>:</span><span class=mi>0x6ac8</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e062</span><span class=p>]</span>    <span class=mi>0xfe062</span><span class=p>:</span> <span class=no>jne</span>    <span class=mi>0xfd2e1</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e066</span><span class=p>]</span>    <span class=mi>0xfe066</span><span class=p>:</span> <span class=no>xor</span>    <span class=nv>%dx</span><span class=p>,</span><span class=nv>%dx</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e068</span><span class=p>]</span>    <span class=mi>0xfe068</span><span class=p>:</span> <span class=no>mov</span>    <span class=nv>%dx</span><span class=p>,</span><span class=nv>%ss</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e06a</span><span class=p>]</span>    <span class=mi>0xfe06a</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>$0x7000</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e070</span><span class=p>]</span>    <span class=mi>0xfe070</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>$0xf34c2</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>e076</span><span class=p>]</span>    <span class=mi>0xfe076</span><span class=p>:</span> <span class=no>jmp</span>    <span class=mi>0xfd15c</span>
</span></span><span class=line><span class=ln>8</span><span class=cl><span class=err>[</span><span class=nl>f000:</span><span class=nf>d15c</span><span class=p>]</span>    <span class=mi>0xfd15c</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=na>...</span>
</span></span></code></pre></div><p>å¦‚æœçœ‹ç€è§‰å¾—ä¼¼æ‡‚éæ‡‚&mldr;ä¸è¦æ…Œï¼Œé—®é¢˜ä¸å¤§ï¼Œå› ä¸ºè¿™é‡Œä¸éœ€è¦å¼„æ˜ç™½BIOSåˆ°åº•åœ¨å¹²ä»€ä¹ˆã€‚ä¸è¿‡å»ºè®®å…ˆå¤ä¹ ä¸€ä¸‹x86æ±‡ç¼–ï¼Œå¯ä»¥å‚è€ƒ<a href=http://learn-assembly.blogspot.com/2009/04/general-registers-ax-bx-cx-and-dx.html>General Registers (AX, BX, CX, and DX)</a>ï¼Œ<a href=https://pdos.csail.mit.edu/6.828/2018/readings/i386/toc.htm>Intel 80386 Reference Programmer&rsquo;s Manual Table of Contents</a>Â ç­‰å†…å®¹ã€‚ç„¶åå¼ºçƒˆæ¨èå»ç¨å¾®çœ‹ä¸€ä¸‹<a href=#ZgotmplZ>gdb_examining data</a>Â éƒ¨åˆ†çš„æ•™ç¨‹ï¼Œå°¤å…¶æ˜¯æŸ¥çœ‹memoryå’Œregisterå†…å®¹çš„ç« èŠ‚ï¼Œå¯¹ææ¸…æ¥šBIOSè¿™é‡Œåˆ°åº•åœ¨å¹²å˜›å¤§æœ‰è£¨ç›Šã€‚<strong>(x [memory]æ¥æŸ¥çœ‹æŸä¸ªåœ°å€çš„å†…å®¹ï¼Œx/i [memory]å°†è¯¥åœ°å€çš„æŒ‡ä»¤ä»¥äººç±»å¯è¯»çš„æ–¹å¼å†™å‡ºï¼Œp/x $[register] æ¥æŸ¥çœ‹æŸä¸ªå¯„å­˜å™¨çš„å€¼ã€‚ï¼‰</strong></p><p>é‚£ä¹ˆBIOSå¤§æ¦‚åšäº†ä»€ä¹ˆå‘¢ï¼Ÿä¸»è¦æ˜¯å»ºç«‹<a href=https://en.wikipedia.org/wiki/Interrupt_descriptor_table>Interrupt descriptor table</a>ï¼ˆå…¶å®å°±æ˜¯x86ä½“ç³»æ¶æ„ä¸­æ–­å‘é‡è¡¨çš„å®ç°),åˆå§‹åŒ–ä¸€äº›ç¡¬ä»¶è®¾å¤‡ï¼Œç„¶åå¯»æ‰¾ä¸€ä¸ª"bootable"è®¾å¤‡ã€‚å¦‚æœæ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªè®¾å¤‡ï¼ŒBIOSå°±å°†è¯¥è®¾å¤‡ä¸Šçš„boot loaderåŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤ç»™boot loader.</p><p>å…ˆæ˜ç¡®å‡ ä¸ªæ¦‚å¿µã€‚æ‰€è°“boot loader,å°±æ˜¯åœ¨åŠ è½½OSå‰è¿è¡Œçš„ä¸€æ®µç¨‹åºã€‚é€šå¸¸åœ¨ç¡¬ç›˜çš„ç¬¬ä¸€ä¸ªsectoré‡Œï¼Œå› æ­¤è¿™ä¸ªsectorä¹Ÿå«boot sector.è‡³äºæˆ‘ä»¬æ›´ç»å¸¸è§åˆ°çš„<a href=https://en.wikipedia.org/wiki/Master_boot_record>master boot record(ä¸»å¼•å¯¼è®°å½•)</a>ï¼Œå…¶å®å°±æ˜¯ä¸€ç§å¯¹äºåˆ†åŒºè¿‡çš„åª’ä»‹çš„ç‰¹æ®Šçš„boot sector.</p><p>é¡ºä¾¿æä¸€å¥ï¼Œç¡®å®šä¸€ä¸ªè®¾å¤‡æ˜¯å¦ä¸º"bootable"æ˜¯é€šè¿‡Â 0x55å’Œ0xAAä¸¤ä¸ªboot signatureæ¥å†³å®šçš„ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªè®¾å¤‡ä¸­çš„ç¬¬0ä¸ªsectorçš„æœ€åä¸¤ä¸ªbyteçš„å€¼åˆ†åˆ«ä¸º0x55å’Œ0xAA,å°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªbootableè®¾å¤‡ã€‚å¯ä»¥å‚è€ƒ<a href=https://wiki.osdev.org/Boot_Sequence>bool sequence</a></p><h2 id=part-2-the-boot-loader>Part 2: The Boot Loader</h2><p>BIOSåœ¨åˆå§‹åŒ–å®Œæˆåéœ€è¦å°†boot loaderåŠ è½½åˆ°å†…å­˜ï¼Œå…·ä½“çš„åœ°å€ä¸ºÂ 0x7c00 åˆ°0x7dffã€‚</p><p>å…³äº0x7c00è¿™ä¸ªmagic numberæ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿã€€å…¶å®ä¸é‡è¦ï¼Œä¸è¿‡æ„Ÿå…´è¶£å¯ä»¥å‚è€ƒ<a href=https://www.glamenv-septzen.net/en/view/6>Why BIOS loads MBR into 0x7C00 in x86 ?</a>ã€€çŸ¥é“è¿™ä¸ªmagic numberå…¶å®ä¸æ˜¯x86ç›¸å…³çš„ï¼Œè€Œæ˜¯å’ŒIBMçš„BIOSå¼€å‘å›¢é˜Ÿæœ‰å…³å°±å¯ä»¥äº†ã€‚</p><p>boot loaderåŒ…å«ä¸€ä¸ªæ±‡ç¼–æ–‡ä»¶boot/boot.Så’Œä¸€ä¸ªcè¯­è¨€æ–‡ä»¶boot/main.c</p><p>å…ˆæ¥çœ‹ä¸‹boot/boot.Sæ–‡ä»¶éƒ½åœ¨å¹²ä»€ä¹ˆå§</p><p>ä¸è¿‡åœ¨è¿™ä¹‹å‰ï¼Œä¸å¦¨å…ˆå¤ä¹ ä¸€ä¸‹real modeå’Œproteced mode</p><h3 id=real-mode--protected-mode>real mode / protected mode</h3><pre><code>  * [Real_mode](https://en.wikipedia.org/wiki/Real_mode)ã€€åœ°å€ç©ºé—´è¢«é™åˆ¶åœ¨2^20(å› ä¸ºåœ°å€æ€»çº¿ä¸º20),æ²¡æœ‰è™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µï¼Œå†…å­˜éƒ½æ˜¯çœŸå®çš„ç‰©ç†å†…å­˜ã€‚åœ¨real modeä¸‹ï¼Œsegmentä½äºç‰©ç†å†…å­˜ä¸­çš„å›ºå®šä½ç½®ä¸Šã€‚
  * 16-bit Protected Modeã€€ç™»åœºäºintel 80286å¤„ç†å™¨ã€‚é¦–æ¬¡å¼•å…¥äº†è™šæ‹Ÿå†…å­˜çš„æ¦‚å¿µã€‚ä¾èµ–å±€éƒ¨æ€§åŸç†ï¼Œåªå°†ç¨‹åºè¿è¡Œéœ€è¦çš„éƒ¨åˆ†æ”¾å…¥å†…å­˜ï¼Œæš‚æ—¶ç”¨ä¸åˆ°çš„éƒ¨åˆ†åˆ™å­˜å‚¨åœ¨ç¡¬ç›˜ã€‚segmentçš„ä½ç½®åœ¨å…¶ä»diskå›åˆ°memoryä¸­ï¼Œå¯èƒ½å’Œä¹‹å‰çš„ä½ç½®ä¸åŒã€‚ç”±äºsegmentçš„ä½ç½®ä¸å†å›ºå®šï¼Œå¼•å…¥[Global Descriptor Tableï¼ŒGDT](https://en.wikipedia.org/wiki/Global_Descriptor_Table)æ¥æè¿°segmentçš„ä¿¡æ¯ï¼Œè¯¸å¦‚æ˜¯å¦åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœåœ¨ï¼Œåœ¨å†…å­˜ä¸­çš„ä»€ä¹ˆä½ç½®ï¼Œä»¥åŠè®¿é—®æƒé™ã€‚ç”±äºå¯„å­˜å™¨ä»ç„¶æ˜¯16bit,æ‰€ä»¥segment [OSTEP](http://pages.cs.wisc.edu/~remzi/OSTEP/)
  * Â 32-bit Protected Mode ã€€ç™»åœºäºintel 80386å¤„ç†å™¨ã€‚æ¯”èµ·80286,ä½¿ç”¨çš„å¯„å­˜å™¨æ˜¯32-bitçš„ï¼Œå› æ­¤segment size å¢å¤§åˆ°4GB(2^32). åŒæ—¶ï¼Œç”±äºsegment sizeä¸å†åƒ64ké‚£ä¹ˆå°ï¼Œä»¥å‰çš„ä¸€æ•´ä¸ªsegmentè¦ä¹ˆéƒ½åœ¨memoryä¸­ï¼Œè¦ä¹ˆéƒ½åœ¨diskä¸­çš„ç­–ç•¥å°±å˜å¾—ä¸å¤ªç§‘å­¦äº†ã€‚å› æ­¤å¼•å…¥[paging](https://en.wikipedia.org/wiki/Paging)Â æœºåˆ¶ï¼Œå°†segmentåˆ†æˆå°ºå¯¸æ›´å°çš„pageã€‚å…è®¸segmentä¸­çš„ä¸€éƒ¨åˆ†åœ¨memoryä¸­ã€‚å…³äºpagingå¯ä»¥å‚è€ƒ[OSTEP](http://pages.cs.wisc.edu/~remzi/OSTEP/)çš„18ç« ã€‚
</code></pre><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯¹äºæ”¯æŒprotected modeçš„cpu,å¯åŠ¨æ—¶ä¸ºäº†ä¿æŒå‘åå…¼å®¹ï¼Œä»ç„¶ä¼šä»¥real modeå¯åŠ¨ï¼Œä¹‹åå†åˆ‡æ¢åˆ°protected mode.</p><blockquote>_When a processor that supports x86 protected mode is powered on, it begins executing instructions inÂ [real mode](https://en.wikipedia.org/wiki/Real_mode), in order to maintainÂ [backward compatibility](https://en.wikipedia.org/wiki/Backward_compatibility)Â with earlier x86 processors.[[4]](https://en.wikipedia.org/wiki/Protected_mode#cite_note-Real_mode_on_powered_on-4)Â Protected mode may only be entered after the system software sets up one descriptor table and enables the Protection Enable (PE)Â [bit](https://en.wikipedia.org/wiki/Bit)Â in theÂ [control register](https://en.wikipedia.org/wiki/Control_register)Â 0 (CR0)_</blockquote><h3 id=bootbootsæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ>boot/boot.Sæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Asm data-lang=Asm><span class=line><span class=ln> 1</span><span class=cl>    
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>#include &lt;inc/mmu.h&gt;
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=c1># Start the CPU: switch to 32-bit protected mode, jump into C.
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>    <span class=c1># The BIOS loads this code from the first sector of the hard disk into
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>    <span class=c1># memory at physical address 0x7c00 and starts executing in real mode
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>    <span class=c1># with %cs=0 %ip=7c00.
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=na>.set</span> <span class=no>PROT_MODE_CSEG</span><span class=p>,</span> <span class=mi>0x8</span>         <span class=c1># kernel code segment selector
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>    <span class=na>.set</span> <span class=no>PROT_MODE_DSEG</span><span class=p>,</span> <span class=mi>0x10</span>        <span class=c1># kernel data segment selector
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>    <span class=na>.set</span> <span class=no>CR0_PE_ON</span><span class=p>,</span>      <span class=mi>0x1</span>         <span class=c1># protected mode enable flag
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=na>.globl</span> <span class=no>start</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nl>start:</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>      <span class=na>.code16</span>                     <span class=c1># Assemble for 16-bit mode
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span>      <span class=nf>cli</span>                         <span class=c1># Disable interrupts
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>      <span class=nf>cld</span>                         <span class=c1># String operations increment
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=c1># Set up the important data segment registers (DS, ES, SS).
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>      <span class=nf>xorw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%ax</span>             <span class=c1># Segment number zero
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%ds</span>             <span class=c1># - Data Segment
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%es</span>             <span class=c1># - Extra Segment
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%ss</span>             <span class=c1># - Stack Segment
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>25</span><span class=cl>      <span class=c1># Enable A20:
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1></span>      <span class=c1>#   For backwards compatibility with the earliest PCs, physical
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1></span>      <span class=c1>#   address line 20 is tied low, so that addresses higher than
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1></span>      <span class=c1>#   1MB wrap around to zero by default.  This code undoes this.
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1></span>    <span class=nl>seta20.1:</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>      <span class=nf>inb</span>     <span class=no>$0x64</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># Wait for not busy
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1></span>      <span class=nf>testb</span>   <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>      <span class=nf>jnz</span>     <span class=no>seta20.1</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    
</span></span><span class=line><span class=ln>34</span><span class=cl>      <span class=nf>movb</span>    <span class=no>$0xd1</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># 0xd1 - port 0x64
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=c1></span>      <span class=nf>outb</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x64</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    
</span></span><span class=line><span class=ln>37</span><span class=cl>    <span class=nl>seta20.2:</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>      <span class=nf>inb</span>     <span class=no>$0x64</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># Wait for not busy
</span></span></span><span class=line><span class=ln>39</span><span class=cl><span class=c1></span>      <span class=nf>testb</span>   <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>      <span class=nf>jnz</span>     <span class=no>seta20.2</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    
</span></span><span class=line><span class=ln>42</span><span class=cl>      <span class=nf>movb</span>    <span class=no>$0xdf</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># 0xdf - port 0x60
</span></span></span><span class=line><span class=ln>43</span><span class=cl><span class=c1></span>      <span class=nf>outb</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x60</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    
</span></span><span class=line><span class=ln>45</span><span class=cl>      <span class=c1># Switch from real to protected mode, using a bootstrap GDT
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=c1></span>      <span class=c1># and segment translation that makes virtual addresses 
</span></span></span><span class=line><span class=ln>47</span><span class=cl><span class=c1></span>      <span class=c1># identical to their physical addresses, so that the 
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1></span>      <span class=c1># effective memory map does not change during the switch.
</span></span></span><span class=line><span class=ln>49</span><span class=cl><span class=c1></span>      <span class=nf>lgdt</span>    <span class=no>gdtdesc</span>  <span class=c1># lgdt means load global descriptor table
</span></span></span><span class=line><span class=ln>50</span><span class=cl><span class=c1></span>      <span class=nf>movl</span>    <span class=nv>%cr0</span><span class=p>,</span> <span class=no>x</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>      <span class=nf>orl</span>     <span class=no>$CR0_PE_ON</span><span class=p>,</span> <span class=no>x</span>  <span class=c1># cr0 = cr0 | 1
</span></span></span><span class=line><span class=ln>52</span><span class=cl><span class=c1></span>      <span class=nf>movl</span>    <span class=no>x</span><span class=p>,</span> <span class=nv>%cr0</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>      
</span></span><span class=line><span class=ln>54</span><span class=cl>      <span class=c1># Jump to next instruction, but in 32-bit code segment.
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=c1></span>      <span class=c1># Switches processor into 32-bit mode.
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=c1></span>      <span class=nf>ljmp</span>    <span class=no>$PROT_MODE_CSEG</span><span class=p>,</span> <span class=no>$protcseg</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>    
</span></span><span class=line><span class=ln>58</span><span class=cl>      <span class=na>.code32</span>                     <span class=c1># Assemble for 32-bit mode
</span></span></span><span class=line><span class=ln>59</span><span class=cl><span class=c1></span>    <span class=nl>protcseg:</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>      <span class=c1># Set up the protected-mode data segment registers
</span></span></span><span class=line><span class=ln>61</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=no>$PROT_MODE_DSEG</span><span class=p>,</span> <span class=nv>%ax</span>    <span class=c1># Our data segment selector
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%ds</span>                <span class=c1># - DS: Data Segment
</span></span></span><span class=line><span class=ln>63</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%es</span>                <span class=c1># - ES: Extra Segment
</span></span></span><span class=line><span class=ln>64</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%fs</span>                <span class=c1># - FS
</span></span></span><span class=line><span class=ln>65</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%gs</span>                <span class=c1># - GS
</span></span></span><span class=line><span class=ln>66</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%ss</span>                <span class=c1># - SS: Stack Segment
</span></span></span><span class=line><span class=ln>67</span><span class=cl><span class=c1></span>      
</span></span><span class=line><span class=ln>68</span><span class=cl>      <span class=c1># Set up the stack pointer and call into C.
</span></span></span><span class=line><span class=ln>69</span><span class=cl><span class=c1></span>      <span class=nf>movl</span>    <span class=no>$start</span><span class=p>,</span> <span class=nv>%esp</span>
</span></span><span class=line><span class=ln>70</span><span class=cl>      <span class=nf>call</span> <span class=no>bootmain</span>
</span></span><span class=line><span class=ln>71</span><span class=cl>    
</span></span><span class=line><span class=ln>72</span><span class=cl>      <span class=c1># If bootmain returns (it shouldn&#39;t), loop.
</span></span></span><span class=line><span class=ln>73</span><span class=cl><span class=c1></span>    <span class=nl>spin:</span>
</span></span><span class=line><span class=ln>74</span><span class=cl>      <span class=nf>jmp</span> <span class=no>spin</span>
</span></span><span class=line><span class=ln>75</span><span class=cl>    
</span></span><span class=line><span class=ln>76</span><span class=cl>    <span class=c1># Bootstrap GDT
</span></span></span><span class=line><span class=ln>77</span><span class=cl><span class=c1></span>    <span class=na>.p2align</span> <span class=mi>2</span>                                <span class=c1># force 4 byte alignment
</span></span></span><span class=line><span class=ln>78</span><span class=cl><span class=c1></span>    <span class=nl>gdt:</span>
</span></span><span class=line><span class=ln>79</span><span class=cl>      <span class=nf>SEG_NULL</span>                              <span class=c1># null seg
</span></span></span><span class=line><span class=ln>80</span><span class=cl><span class=c1></span>      <span class=nf>SEG</span><span class=p>(</span><span class=no>STA_X</span><span class=err>|</span><span class=no>STA_R</span><span class=p>,</span> <span class=mi>0x0</span><span class=p>,</span> <span class=mi>0xffffffff</span><span class=p>)</span>     <span class=c1># code seg
</span></span></span><span class=line><span class=ln>81</span><span class=cl><span class=c1></span>      <span class=nf>SEG</span><span class=p>(</span><span class=no>STA_W</span><span class=p>,</span> <span class=mi>0x0</span><span class=p>,</span> <span class=mi>0xffffffff</span><span class=p>)</span>           <span class=c1># data seg
</span></span></span><span class=line><span class=ln>82</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>83</span><span class=cl>    <span class=nl>gdtdesc:</span>
</span></span><span class=line><span class=ln>84</span><span class=cl>      <span class=na>.word</span>   <span class=mi>0x17</span>                            <span class=c1># sizeof(gdt) - 1
</span></span></span><span class=line><span class=ln>85</span><span class=cl><span class=c1></span>      <span class=na>.long</span>   <span class=no>gdt</span>                             <span class=c1># address gdt
</span></span></span></code></pre></div><p>ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™æ®µä»£ç çš„æ—¶å€™æ„Ÿè§‰Enable A20è¿™ä¸€éƒ¨åˆ†æ¯”è¾ƒå–µ(ling)å–µ(ren)å–µ(fei)å–µ(jie)</p><p>å¯ä»¥å‚è€ƒ<a href=https://www.win.tue.nl/~aeb/linux/kbd/A20.html>A20 - a pain from the past</a>ã€‚é‡ç‚¹æ˜¯</p><blockquote>One sets the output port of the keyboard controller by first writing 0xd1 to port 0x64, and the the desired value of the output port to port 0x60. One usually sees the values 0xdd and 0xdf used to disable/enable A20.</blockquote><p>ç„¶åæ¯”è¾ƒè®©äººç–‘æƒ‘çš„å¯èƒ½æ˜¯"bootstrap GDTâ€è¿™éƒ¨åˆ†ã€‚å‚è€ƒ<a href=http://flint.cs.yale.edu/cs421/papers/x86-asm/asm.html>cs421 x86 Assembly Guide</a>å°¤å…¶æ˜¯:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln> 1</span><span class=cl>    <span class=na>.data</span>		
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=no>var</span><span class=p>:</span>		
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=no>.byte</span> <span class=mi>64</span>	<span class=cm>/* Declare a byte, referred to as location var, containing the value 64. */</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=na>.byte</span> <span class=mi>10</span>	<span class=cm>/* Declare a byte with no label, containing the value 10. Its location is var + 1. */</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nl>x:</span>		
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=na>.short</span> <span class=mi>42</span>	<span class=cm>/* Declare a 2-byte value initialized to 42, referred to as location x. */</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nl>y:</span>		
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=na>.long</span> <span class=mi>30000</span>    	<span class=cm>/* Declare a 4-byte value, referred to as location y, initialized to 30000. */</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    
</span></span><span class=line><span class=ln>10</span><span class=cl>    
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=nl>s:</span>		
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=na>.long</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span>	<span class=cm>/* Declare three 4-byte values, initialized to 1, 2, and 3. 
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=cm>    The value at location s + 8 will be 3. */</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nl>barr:</span>		
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=na>.zero</span> <span class=mi>10</span>	<span class=cm>/* Declare 10 bytes starting at location barr, initialized to 0. */</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=nl>str:</span>		
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=na>.string</span> <span class=s>&#34;hello&#34;</span>   	<span class=cm>/* Declare 6 bytes starting at the address str initialized to 
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=cm>    the ASCII character values for hello followed by a nul (0) byte. */</span>
</span></span></code></pre></div><p>çŸ¥é“gdtdescéƒ¨åˆ†åšçš„äº‹æƒ…æ˜¯ï¼Œåœ¨gdtdescè¿™ä¸ªä½ç½®å®šä¹‰äº†ä¸€ä¸ªwordç±»å‹ï¼ˆï¼’å­—èŠ‚ï¼‰çš„å˜é‡ï¼Œå€¼ä¸º0x17,å‚è€ƒæ³¨é‡Šä¹Ÿå°±æ˜¯gdtå®šä¹‰çš„é‚£ä¸€æ®µçš„sizeå¤§å°ã€‚ç„¶ååœ¨gdtdsec+2è¿™ä¸ªä½ç½®å®šä¹‰äº†longç±»å‹(4å­—èŠ‚)çš„gdtåœ°å€.</p><p>è¿™é‡Œgdtå’Œgdtdescéƒ½æ˜¯"label"ï¼Œlabelå…¶å®å°±æ˜¯æ ‡è®°äº†ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä¸€ä¸ªâ€œlabelâ€çš„å€¼ï¼Œæ˜¯å…¶ä¹‹åçš„ç¬¬ä¸€æ¡instructionçš„å†…å­˜åœ°å€ã€‚</p><blockquote>We use the notationÂ <label>Â to refer to labeled locations in the program text. Labels can be inserted anywhere in x86 assembly code text by entering a label name followed by a colon. For example,<div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln>1</span><span class=cl>        <span class=nf>mov</span> <span class=mi>8</span><span class=p>(</span><span class=no>p</span><span class=p>),</span> <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>2</span><span class=cl> <span class=nl>begin:</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>        <span class=nf>xor</span> <span class=no>x</span><span class=p>,</span> <span class=no>x</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=nf>mov</span> <span class=p>(</span><span class=nv>%esi</span><span class=p>),</span> <span class=no>x</span>
</span></span></code></pre></div><p>The second instruction in this code fragment is labeledÂ begin. Elsewhere in the code, we can refer to the memory location that this instruction is located at in memory using the more convenient symbolic nameÂ begin. This label is just a convenient way of expressing the location instead of its 32-bit value.</blockquote></p><p>ç„¶åæ˜¯å…³äºgdtéƒ¨åˆ†ï¼ŒSEGçœ‹èµ·æ¥æ˜¯ä¸ªå®ï¼Œæˆ‘ä»¬çœ‹åˆ°inc/mmu.hè¿™ä¸ªæ–‡ä»¶ä¸­ç›¸å…³çš„éƒ¨åˆ†ï¼Œè±ç„¶å¼€æœ—ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln> 1</span><span class=cl>    <span class=c1>#ifdef __ASSEMBLER__
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=cm>     * Macros to build GDT entries in assembly.
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=c1>#define SEG_NULL                                                \
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>            <span class=na>.word</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=c1>;                                             \
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>            <span class=na>.byte</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=c1>#define SEG(type,base,lim)                                      \
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>            <span class=na>.word</span> <span class=p>(((</span><span class=no>lim</span><span class=p>)</span> <span class=err>&gt;</span> <span class=mi>12</span><span class=p>)</span> <span class=err>&amp;</span> <span class=mi>0xffff</span><span class=p>),</span> <span class=p>((</span><span class=no>base</span><span class=p>)</span> <span class=err>&amp;</span> <span class=mi>0xffff</span><span class=p>)</span><span class=c1>;      \
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>            <span class=na>.byte</span> <span class=p>(((</span><span class=no>base</span><span class=p>)</span> <span class=err>&gt;</span> <span class=mi>16</span><span class=p>)</span> <span class=err>&amp;</span> <span class=mi>0xff</span><span class=p>),</span> <span class=p>(</span><span class=mi>0x90</span> <span class=err>|</span> <span class=p>(</span><span class=no>type</span><span class=p>)),</span>         <span class=err>\</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                    <span class=err>(0</span><span class=nf>xC0</span> <span class=err>|</span> <span class=p>(((</span><span class=no>lim</span><span class=p>)</span> <span class=err>&gt;</span> <span class=mi>28</span><span class=p>)</span> <span class=err>&amp;</span> <span class=mi>0xf</span><span class=p>)),</span> <span class=p>(((</span><span class=no>base</span><span class=p>)</span> <span class=err>&gt;</span> <span class=mi>24</span><span class=p>)</span> <span class=err>&amp;</span> <span class=mi>0xff</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=c1>#else   // not __ASSEMBLER__
</span></span></span></code></pre></div><p>æ¥ä¸‹æ¥ä¸å¤ªæ˜ç¡®çš„åœ°æ–¹å¯èƒ½æ˜¯cr0éƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°ä»£ç æœ€å¼€å§‹æœ‰ä¸€ä¸ªCR0_PE_ON,å€¼ä¸º0x1.ä¹‹åå°±æ˜¯åœ¨è®¡ç®—cr0 = cr0 | 0x1ï¼ŒæŒ‰ç…§æ³¨é‡Šè¯´è¿™æ ·å°±å¯ä»¥æŠŠä¿æŠ¤æ¨¡å¼æ‰“å¼€äº†ã€‚ç†è§£åˆ°è¿™é‡Œå…¶å®å°±okï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æƒ³å¤šè¯´ä¸¤å¥ã€‚ã€€Control registeræ˜¯ç”¨æ¥æ§åˆ¶cpuè¡Œä¸ºçš„å¯„å­˜å™¨ã€‚cr0æ˜¯x86ä½“ç³»æ¶æ„çš„<a href=https://en.wikipedia.org/wiki/Control_register>Control register</a>ä¸­çš„ä¸€ä¸ªã€‚cr0æ˜¯32bitçš„å¯„å­˜å™¨ï¼Œå…¶ä¸­ä¸€äº›bitä¸Šæœ‰åç§°ä»¥åŠå›ºå®šçš„ä½œç”¨ã€‚æ¯”å¦‚å¯¹äºä½ç½®bit 0,è¯¥ä½ç½®çš„åç§°æ˜¯"Protected Mode Enable"ï¼Œç®€ç§°ä¸ºPE,å½“è¯¥ä½ç½®å€¼ä¸º1,è¡¨ç¤ºä¿æŠ¤æ¨¡å¼è¢«æ‰“å¼€ã€‚</p><p>æœ€åä¸€ä¸ªå°ç»†èŠ‚æ˜¯".globl start"ã€‚".globl"æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿä¸ºä»€ä¹ˆè¦æŠŠstartè¿™ä¸ªlabelå®šä¹‰æˆglobalçš„ï¼Ÿå¯ä»¥å‚è€ƒ<a href=https://stackoverflow.com/questions/17898989/what-is-global-start-in-assembly-language>What is global _start in assembly language?</a>ã€€ç”¨äººè¯è¯´å°±æ˜¯å®šä¹‰æˆ.globlçš„lableä¼šè¢«å¯¼å‡ºåˆ°ç”Ÿæˆçš„.oæ–‡ä»¶ä¸­ï¼Œä¸ç„¶linkeræ‰¾ä¸åˆ°è¿™ä¸ªç¬¦å·ã€‚ç”±äºstartæ˜¯è¿™ä¸ªboot.Sæ–‡ä»¶çš„entry pointï¼Œå› æ­¤éœ€è¦linkerçœ‹åˆ°ã€‚</p><p>æœ€åï¼Œä»å…¨å±€æ¥çœ‹ï¼Œboot.Sè¿™ä¸ªæ–‡ä»¶åšäº†ä»€ä¹ˆå‘¢ï¼Ÿã€€å…¶å®ä¸Šé¢ä¸€ä¸ªå°èŠ‚ä¸­å·²ç»æåˆ°äº†ã€‚</p><blockquote>_When a processor that supports x86 protected mode is powered on, it begins executing instructions inÂ [real mode](https://en.wikipedia.org/wiki/Real_mode), in order to maintainÂ [backward compatibility](https://en.wikipedia.org/wiki/Backward_compatibility)Â with earlier x86 processors.[[4]](https://en.wikipedia.org/wiki/Protected_mode#cite_note-Real_mode_on_powered_on-4)Â Protected mode may only be entered after the system software sets up one descriptor table and enables the Protection Enable (PE)Â [bit](https://en.wikipedia.org/wiki/Bit)Â in theÂ [control register](https://en.wikipedia.org/wiki/Control_register)Â 0 (CR0)_</blockquote><h3 id=bootmaincè¿™ä¸ªæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ>boot/main.cè¿™ä¸ªæ–‡ä»¶åœ¨å¹²ä»€ä¹ˆ</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>  1</span><span class=cl>    
</span></span><span class=line><span class=ln>  2</span><span class=cl>    <span class=cp>#include</span> <span class=cpf>&lt;inc/x86.h                                                                                                                                                                          </span><span class=cp>
</span></span></span><span class=line><span class=ln>  3</span><span class=cl><span class=cp></span>    <span class=cp>#include</span> <span class=cpf>&lt;inc/elf.h                                                                                                                                                                          </span><span class=cp>
</span></span></span><span class=line><span class=ln>  4</span><span class=cl><span class=cp></span>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln>  5</span><span class=cl>    <span class=cm>/**********************************************************************                                                                                                                       
</span></span></span><span class=line><span class=ln>  6</span><span class=cl><span class=cm>     * This a dirt simple boot loader, whose sole job is to boot                                                                                                                                  
</span></span></span><span class=line><span class=ln>  7</span><span class=cl><span class=cm>     * an ELF kernel image from the first IDE hard disk.                                                                                                                                          
</span></span></span><span class=line><span class=ln>  8</span><span class=cl><span class=cm>     *                                                                                                                                                                                            
</span></span></span><span class=line><span class=ln>  9</span><span class=cl><span class=cm>     * DISK LAYOUT                                                                                                                                                                                
</span></span></span><span class=line><span class=ln> 10</span><span class=cl><span class=cm>     *  * This program(boot.S and main.c) is the bootloader.  It should                                                                                                                           
</span></span></span><span class=line><span class=ln> 11</span><span class=cl><span class=cm>     *    be stored in the first sector of the disk.                                                                                                                                              
</span></span></span><span class=line><span class=ln> 12</span><span class=cl><span class=cm>     *                                                                                                                                                                                            
</span></span></span><span class=line><span class=ln> 13</span><span class=cl><span class=cm>     *  * The 2nd sector onward holds the kernel image.                                                                                                                                           
</span></span></span><span class=line><span class=ln> 14</span><span class=cl><span class=cm>     *                                                                                                                                                                                            
</span></span></span><span class=line><span class=ln> 15</span><span class=cl><span class=cm>     *  * The kernel image must be in ELF format.                                                                                                                                                 
</span></span></span><span class=line><span class=ln> 16</span><span class=cl><span class=cm>     *                                                                                                      c                                                                                      
</span></span></span><span class=line><span class=ln> 17</span><span class=cl><span class=cm>     * BOOT UP STEPS                                                                                                                                                                              
</span></span></span><span class=line><span class=ln> 18</span><span class=cl><span class=cm>     *  * when the CPU boots it loads the BIOS into memory and executes it                                                                                                                        
</span></span></span><span class=line><span class=ln> 19</span><span class=cl><span class=cm>     *                                                                                                                                                                                            
</span></span></span><span class=line><span class=ln> 20</span><span class=cl><span class=cm>     *  * the BIOS intializes devices, sets of the interrupt routines, and
</span></span></span><span class=line><span class=ln> 21</span><span class=cl><span class=cm>     *    reads the first sector of the boot device(e.g., hard-drive)
</span></span></span><span class=line><span class=ln> 22</span><span class=cl><span class=cm>     *    into memory and jumps to it.
</span></span></span><span class=line><span class=ln> 23</span><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=ln> 24</span><span class=cl><span class=cm>     *  * Assuming this boot loader is stored in the first sector of the
</span></span></span><span class=line><span class=ln> 25</span><span class=cl><span class=cm>     *    hard-drive, this code takes over...
</span></span></span><span class=line><span class=ln> 26</span><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=ln> 27</span><span class=cl><span class=cm>     *  * control starts in boot.S -- which sets up protected mode,
</span></span></span><span class=line><span class=ln> 28</span><span class=cl><span class=cm>     *    and a stack so C code then run, then calls bootmain()
</span></span></span><span class=line><span class=ln> 29</span><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=ln> 30</span><span class=cl><span class=cm>     *  * bootmain() in this file takes over, reads in the kernel and jumps to it.
</span></span></span><span class=line><span class=ln> 31</span><span class=cl><span class=cm>     **********************************************************************/</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>    
</span></span><span class=line><span class=ln> 33</span><span class=cl>    <span class=cp>#define SECTSIZE        512
</span></span></span><span class=line><span class=ln> 34</span><span class=cl><span class=cp></span>    <span class=cp>#define ELFHDR          ((struct Elf *) 0x10000) </span><span class=c1>// scratch space
</span></span></span><span class=line><span class=ln> 35</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 36</span><span class=cl>    <span class=kt>void</span> <span class=nf>readsect</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>    <span class=kt>void</span> <span class=nf>readseg</span><span class=p>(</span><span class=kt>uint32_t</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>    
</span></span><span class=line><span class=ln> 39</span><span class=cl>    <span class=kt>void</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>    <span class=nf>bootmain</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>            <span class=k>struct</span> <span class=n>Proghdr</span> <span class=o>*</span><span class=n>ph</span><span class=p>,</span> <span class=o>*</span><span class=n>eph</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>    
</span></span><span class=line><span class=ln> 44</span><span class=cl>            <span class=c1>// read 1st page off disk
</span></span></span><span class=line><span class=ln> 45</span><span class=cl><span class=c1></span>            <span class=nf>readseg</span><span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span> <span class=n>ELFHDR</span><span class=p>,</span> <span class=n>SECTSIZE</span><span class=o>*</span><span class=mi>8</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>    
</span></span><span class=line><span class=ln> 47</span><span class=cl>            <span class=c1>// is this a valid ELF?
</span></span></span><span class=line><span class=ln> 48</span><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=n>ELFHDR</span><span class=o>-&gt;</span><span class=n>e_magic</span> <span class=o>!=</span> <span class=n>ELF_MAGIC</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>                    <span class=k>goto</span> <span class=n>bad</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>    
</span></span><span class=line><span class=ln> 51</span><span class=cl>            <span class=c1>// load each program segment (ignores ph flags)
</span></span></span><span class=line><span class=ln> 52</span><span class=cl><span class=c1></span>            <span class=n>ph</span> <span class=o>=</span> <span class=p>(</span><span class=k>struct</span> <span class=n>Proghdr</span> <span class=o>*</span><span class=p>)</span> <span class=p>((</span><span class=kt>uint8_t</span> <span class=o>*</span><span class=p>)</span> <span class=n>ELFHDR</span> <span class=o>+</span> <span class=n>ELFHDR</span><span class=o>-&gt;</span><span class=n>e_phoff</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>            <span class=n>eph</span> <span class=o>=</span> <span class=n>ph</span> <span class=o>+</span> <span class=n>ELFHDR</span><span class=o>-&gt;</span><span class=n>e_phnum</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>            <span class=k>for</span> <span class=p>(;</span> <span class=n>ph</span> <span class=o>&lt;</span> <span class=n>eph</span><span class=p>;</span> <span class=n>ph</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>                    <span class=c1>// p_pa is the load address of this segment (as well
</span></span></span><span class=line><span class=ln> 56</span><span class=cl><span class=c1></span>                    <span class=c1>// as the physical address)
</span></span></span><span class=line><span class=ln> 57</span><span class=cl><span class=c1></span>                    <span class=nf>readseg</span><span class=p>(</span><span class=n>ph</span><span class=o>-&gt;</span><span class=n>p_pa</span><span class=p>,</span> <span class=n>ph</span><span class=o>-&gt;</span><span class=n>p_memsz</span><span class=p>,</span> <span class=n>ph</span><span class=o>-&gt;</span><span class=n>p_offset</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>    
</span></span><span class=line><span class=ln> 59</span><span class=cl>            <span class=c1>// call the entry point from the ELF header
</span></span></span><span class=line><span class=ln> 60</span><span class=cl><span class=c1></span>            <span class=c1>// note: does not return!
</span></span></span><span class=line><span class=ln> 61</span><span class=cl><span class=c1></span>            <span class=p>((</span><span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=p>)(</span><span class=kt>void</span><span class=p>))</span> <span class=p>(</span><span class=n>ELFHDR</span><span class=o>-&gt;</span><span class=n>e_entry</span><span class=p>))();</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>    
</span></span><span class=line><span class=ln> 63</span><span class=cl>    <span class=nl>bad</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>            <span class=nf>outw</span><span class=p>(</span><span class=mh>0x8A00</span><span class=p>,</span> <span class=mh>0x8A00</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>            <span class=nf>outw</span><span class=p>(</span><span class=mh>0x8A00</span><span class=p>,</span> <span class=mh>0x8E00</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>                    <span class=cm>/* do nothing */</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>    
</span></span><span class=line><span class=ln> 70</span><span class=cl>    <span class=c1>// Read &#39;count&#39; bytes at &#39;offset&#39; from kernel into physical address &#39;pa&#39;.
</span></span></span><span class=line><span class=ln> 71</span><span class=cl><span class=c1></span>    <span class=c1>// Might copy more than asked
</span></span></span><span class=line><span class=ln> 72</span><span class=cl><span class=c1></span>    <span class=kt>void</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>    <span class=nf>readseg</span><span class=p>(</span><span class=kt>uint32_t</span> <span class=n>pa</span><span class=p>,</span> <span class=kt>uint32_t</span> <span class=n>count</span><span class=p>,</span> <span class=kt>uint32_t</span> <span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>            <span class=kt>uint32_t</span> <span class=n>end_pa</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl>    
</span></span><span class=line><span class=ln> 77</span><span class=cl>            <span class=n>end_pa</span> <span class=o>=</span> <span class=n>pa</span> <span class=o>+</span> <span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>    
</span></span><span class=line><span class=ln> 79</span><span class=cl>            <span class=c1>// round down to sector boundary
</span></span></span><span class=line><span class=ln> 80</span><span class=cl><span class=c1></span>            <span class=n>pa</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=p>(</span><span class=n>SECTSIZE</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>    
</span></span><span class=line><span class=ln> 82</span><span class=cl>            <span class=c1>// translate from bytes to sectors, and kernel starts at sector 1
</span></span></span><span class=line><span class=ln> 83</span><span class=cl><span class=c1></span>            <span class=n>offset</span> <span class=o>=</span> <span class=p>(</span><span class=n>offset</span> <span class=o>/</span> <span class=n>SECTSIZE</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>    
</span></span><span class=line><span class=ln> 85</span><span class=cl>            <span class=c1>// If this is too slow, we could read lots of sectors at a time.
</span></span></span><span class=line><span class=ln> 86</span><span class=cl><span class=c1></span>            <span class=c1>// We&#39;d write more to memory than asked, but it doesn&#39;t matter --
</span></span></span><span class=line><span class=ln> 87</span><span class=cl><span class=c1></span>            <span class=c1>// we load in increasing order.
</span></span></span><span class=line><span class=ln> 88</span><span class=cl><span class=c1></span>            <span class=k>while</span> <span class=p>(</span><span class=n>pa</span> <span class=o>&lt;</span> <span class=n>end_pa</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>                    <span class=c1>// Since we haven&#39;t enabled paging yet and we&#39;re using
</span></span></span><span class=line><span class=ln> 90</span><span class=cl><span class=c1></span>                    <span class=c1>// an identity segment mapping (see boot.S), we can
</span></span></span><span class=line><span class=ln> 91</span><span class=cl><span class=c1></span>                    <span class=c1>// use physical addresses directly.  This won&#39;t be the
</span></span></span><span class=line><span class=ln> 92</span><span class=cl><span class=c1></span>                    <span class=c1>// case once JOS enables the MMU.
</span></span></span><span class=line><span class=ln> 93</span><span class=cl><span class=c1></span>                    <span class=nf>readsect</span><span class=p>((</span><span class=kt>uint8_t</span><span class=o>*</span><span class=p>)</span> <span class=n>pa</span><span class=p>,</span> <span class=n>offset</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>                    <span class=n>pa</span> <span class=o>+=</span> <span class=n>SECTSIZE</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>                    <span class=n>offset</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>    
</span></span><span class=line><span class=ln> 99</span><span class=cl>    <span class=kt>void</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>    <span class=nf>waitdisk</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>            <span class=c1>// wait for disk reaady
</span></span></span><span class=line><span class=ln>103</span><span class=cl><span class=c1></span>            <span class=k>while</span> <span class=p>((</span><span class=nf>inb</span><span class=p>(</span><span class=mh>0x1F7</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xC0</span><span class=p>)</span> <span class=o>!=</span> <span class=mh>0x40</span><span class=p>)</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>                    <span class=cm>/* do nothing */</span><span class=p>;</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>    
</span></span><span class=line><span class=ln>107</span><span class=cl>    <span class=kt>void</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>    <span class=nf>readsect</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>dst</span><span class=p>,</span> <span class=kt>uint32_t</span> <span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>            <span class=c1>// wait for disk to be ready
</span></span></span><span class=line><span class=ln>111</span><span class=cl><span class=c1></span>            <span class=nf>waitdisk</span><span class=p>();</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>    
</span></span><span class=line><span class=ln>113</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mh>0x1F2</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>         <span class=c1>// count = 1
</span></span></span><span class=line><span class=ln>114</span><span class=cl><span class=c1></span>            <span class=nf>outb</span><span class=p>(</span><span class=mh>0x1F3</span><span class=p>,</span> <span class=n>offset</span><span class=p>);</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mh>0x1F4</span><span class=p>,</span> <span class=n>offset</span> <span class=o>&gt;</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mh>0x1F5</span><span class=p>,</span> <span class=n>offset</span> <span class=o>&gt;</span> <span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mh>0x1F6</span><span class=p>,</span> <span class=p>(</span><span class=n>offset</span> <span class=o>&gt;</span> <span class=mi>24</span><span class=p>)</span> <span class=o>|</span> <span class=mh>0xE0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mh>0x1F7</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>);</span>      <span class=c1>// cmd 0x20 - read sectors
</span></span></span><span class=line><span class=ln>119</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>120</span><span class=cl>            <span class=c1>// wait for disk to be ready
</span></span></span><span class=line><span class=ln>121</span><span class=cl><span class=c1></span>            <span class=nf>waitdisk</span><span class=p>();</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>    
</span></span><span class=line><span class=ln>123</span><span class=cl>            <span class=c1>// read a sector
</span></span></span><span class=line><span class=ln>124</span><span class=cl><span class=c1></span>            <span class=nf>insl</span><span class=p>(</span><span class=mh>0x1F0</span><span class=p>,</span> <span class=n>dst</span><span class=p>,</span> <span class=n>SECTSIZE</span><span class=o>/</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=ln>125</span><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>å…ˆæ³¨æ„åˆ°ä¸€äº›çœ‹èµ·æ¥åƒæ˜¯æ±‡ç¼–æŒ‡ä»¤çš„ä¸œè¥¿&mldr;æ¯”å¦‚outbä¹‹ç±»ã€‚æŸ¥çœ‹inc/x86.hæ–‡ä»¶ï¼Œæ‰¾åˆ°ä»–ä»¬çš„å®šä¹‰ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>    <span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=nf>outb</span><span class=p>(</span><span class=kt>int</span> <span class=n>port</span><span class=p>,</span> <span class=kt>uint8_t</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>            <span class=k>asm</span> <span class=k>volatile</span><span class=p>(</span><span class=s>&#34;outb %0,%w1&#34;</span> <span class=o>:</span> <span class=o>:</span> <span class=s>&#34;a&#34;</span> <span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=s>&#34;d&#34;</span> <span class=p>(</span><span class=n>port</span><span class=p>));</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    
</span></span><span class=line><span class=ln> 7</span><span class=cl>    
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=k>static</span> <span class=kr>inline</span> <span class=kt>void</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=nf>insl</span><span class=p>(</span><span class=kt>int</span> <span class=n>port</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>addr</span><span class=p>,</span> <span class=kt>int</span> <span class=n>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>            <span class=k>asm</span> <span class=k>volatile</span><span class=p>(</span><span class=s>&#34;cld</span><span class=se>\n\t</span><span class=s>repne</span><span class=se>\n\t</span><span class=s>insl&#34;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                         <span class=o>:</span> <span class=s>&#34;=D&#34;</span> <span class=p>(</span><span class=n>addr</span><span class=p>),</span> <span class=s>&#34;=c&#34;</span> <span class=p>(</span><span class=n>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>                         <span class=o>:</span> <span class=s>&#34;d&#34;</span> <span class=p>(</span><span class=n>port</span><span class=p>),</span> <span class=s>&#34;0&#34;</span> <span class=p>(</span><span class=n>addr</span><span class=p>),</span> <span class=s>&#34;1&#34;</span> <span class=p>(</span><span class=n>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                         <span class=o>:</span> <span class=s>&#34;memory&#34;</span><span class=p>,</span> <span class=s>&#34;cc&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>static</span> <span class=kr>inline</span> <span class=kt>uint8_t</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=nf>inb</span><span class=p>(</span><span class=kt>int</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>{</span>       
</span></span><span class=line><span class=ln>19</span><span class=cl>            <span class=kt>uint8_t</span> <span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>            <span class=k>asm</span> <span class=k>volatile</span><span class=p>(</span><span class=s>&#34;inb %w1,%0&#34;</span> <span class=o>:</span> <span class=s>&#34;=a&#34;</span> <span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>:</span> <span class=s>&#34;d&#34;</span> <span class=p>(</span><span class=n>port</span><span class=p>));</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>            <span class=k>return</span> <span class=n>data</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>å‘ç°å°±æ˜¯ç”¨cå°†æ±‡ç¼–å°è£…äº†ä¸€å±‚ã€‚è¿™ä¸ªä¸œè¥¿åº”è¯¥å«â€œinline assemblyâ€ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href=http://www.delorie.com/djgpp/doc/brennan/brennan_att_inline_djgpp.html>Brennan&rsquo;s Guide to Inline Assembly</a>ã€€å…¶ä¸­volatileå…³é”®å­—è¡¨ç¤ºç¦æ­¢gccä¼˜åŒ–è¿™æ®µä»£ç ã€‚</p><blockquote>If your assembly statementÂ _must_Â execute where you put it, (i.e. must not be moved out of a loop as an optimization), put the keywordÂ **volatile**Â afterÂ **asm**Â and before the ()'s. To be ultra-careful, use<p><strong>asm</strong> <strong>volatile</strong> (&mldr;whatever&mldr;);</p><p>However, I would like to point out that if your assembly&rsquo;s only purpose is to calculate the output registers, with no other side effects, you should leave off theÂ <strong>volatile</strong>Â keyword so your statement will be processed into GCC&rsquo;s common subexpression elimination optimization.</blockquote></p><p>æ³¨é‡Šä¸Šå†™çš„è¦"bootÂ  an ELF kernel image from the first IDE hard disk",é‚£ä¹ˆï¼Œé¦–å…ˆè¦çŸ¥é“ä»€ä¹ˆæ˜¯ELF.ã€€ELFå…¶å®å°±æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼ï¼Œå…¨ç§°ä¸ºâ€œExecutable and Linkable Formatâ€å¯ä»¥å‚è€ƒ<a href=https://en.wikipedia.org/wiki/Executable_and_Linkable_Format#File_layout>Executable_and_Linkable_Format#File_layout</a>ï¼Œå»ºè®®é€šè¯»è¿™ä¸€éƒ¨åˆ†ï¼Œå†…å®¹ä¸å¤šï¼Œä¸è¿‡å¯¹ä¹‹åå¾ˆæœ‰ç”¨ã€‚</p><p>å‚è€ƒä¸€ä¸‹inc/elf.hæ–‡ä»¶,ä»¥åŠmain.cä¸­çš„æ³¨é‡Šï¼Œå°±å¯ä»¥æ•´ä½“ä¸ŠçŸ¥é“è¿™æ®µä»£ç æ˜¯åœ¨å¹²ä»€ä¹ˆäº†ï¼šå°†ELFæ ¼å¼çš„kernel imageä»ç¡¬ç›˜è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†æ§åˆ¶æƒäº¤ç»™kernel image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>   <span class=cp>#ifndef JOS_INC_ELF_H
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp></span>   <span class=cp>#define JOS_INC_ELF_H
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cp></span>   
</span></span><span class=line><span class=ln> 4</span><span class=cl>   <span class=cp>#define ELF_MAGIC 0x464C457FU	</span><span class=cm>/* &#34;\x7FELF&#34; in little endian */</span><span class=cp>
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=cp></span>   
</span></span><span class=line><span class=ln> 6</span><span class=cl>   <span class=k>struct</span> <span class=n>Elf</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>e_magic</span><span class=p>;</span>	<span class=c1>// must equal ELF_MAGIC
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>   	<span class=kt>uint8_t</span> <span class=n>e_elf</span><span class=p>[</span><span class=mi>12</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>   	<span class=cm>/* e_elf[0] 1 for signed 32 bit , 2 for signed 64-bit
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=cm>   	        [1] 1 for little endianness ,2 for big endianness
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=cm>                   [2] version type
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=cm>                   [3] target OS
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=cm>                   [4] ABI version
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=cm>                   [5..11]  unused
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=cm>   	*/</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>   	<span class=kt>uint16_t</span> <span class=n>e_type</span><span class=p>;</span>     <span class=c1>// object file type
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>   	<span class=kt>uint16_t</span> <span class=n>e_machine</span><span class=p>;</span>  <span class=c1>// instruction set arch , x86/MIPS/IA-64 and etc.
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>e_version</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>19</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>e_entry</span><span class=p>;</span>    <span class=c1>// the memory address of the entry point where process start executing.
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>e_phoff</span><span class=p>;</span>    <span class=c1>// points to the start of the program header table.
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>e_shoff</span><span class=p>;</span>    <span class=c1>// Points to the start of the section header table.
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>e_flags</span><span class=p>;</span>  
</span></span><span class=line><span class=ln>23</span><span class=cl>   	<span class=kt>uint16_t</span> <span class=n>e_ehsize</span><span class=p>;</span>   <span class=c1>// size of this header. 64byte for 64-bit,52bytes for 32-bit
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>   	<span class=kt>uint16_t</span> <span class=n>e_phentsize</span><span class=p>;</span> <span class=c1>// the size of a program header table entry.
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>   	<span class=kt>uint16_t</span> <span class=n>e_phnum</span><span class=p>;</span>    <span class=c1>// the number of entries in the program header table.
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1></span>   	<span class=kt>uint16_t</span> <span class=n>e_shentsize</span><span class=p>;</span> <span class=c1>// the size of a section  header table entry.
</span></span></span><span class=line><span class=ln>27</span><span class=cl><span class=c1></span>   	<span class=kt>uint16_t</span> <span class=n>e_shnum</span><span class=p>;</span>    <span class=c1>// the number of entries in the section header table.
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1></span>   	<span class=kt>uint16_t</span> <span class=n>e_shstrndx</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>29</span><span class=cl>   <span class=p>};</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>   
</span></span><span class=line><span class=ln>31</span><span class=cl>   <span class=k>struct</span> <span class=n>Proghdr</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>p_type</span><span class=p>;</span>    <span class=c1>// type of the segment
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>p_offset</span><span class=p>;</span>  <span class=c1>//  offset of the segment in the file image
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>p_va</span><span class=p>;</span>      <span class=c1>// virtual address of the segment in memory
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>p_pa</span><span class=p>;</span>      <span class=c1>// physical address for segment(?)
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>p_filesz</span><span class=p>;</span>  <span class=c1>// Size in bytes of the segment in the file image. May be 0.
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>p_memsz</span><span class=p>;</span>   <span class=c1>// Size in bytes of the segment in memory. May be 0.
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>p_flags</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>p_align</span><span class=p>;</span>   <span class=c1>// 0 and 1 specify no alignment. Otherwise should be a positive, integral power of 2
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1></span>   <span class=p>};</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>   
</span></span><span class=line><span class=ln>42</span><span class=cl>   <span class=k>struct</span> <span class=n>Secthdr</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>sh_name</span><span class=p>;</span> <span class=c1>// An offset to a string in the .shstrtab section that represents the name of this section
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_type</span><span class=p>;</span> <span class=c1>// the type of this header
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_flags</span><span class=p>;</span> <span class=c1>// the attributes of the section
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_addr</span><span class=p>;</span> <span class=c1>// Virtual address of the section in memory
</span></span></span><span class=line><span class=ln>47</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_offset</span><span class=p>;</span>  <span class=c1>// Offset of the section in the file image
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_size</span><span class=p>;</span>    <span class=c1>// Size in bytes of the section in the file image. May be 0.
</span></span></span><span class=line><span class=ln>49</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_link</span><span class=p>;</span>    <span class=c1>// 
</span></span></span><span class=line><span class=ln>50</span><span class=cl><span class=c1></span>   	<span class=kt>uint32_t</span> <span class=n>sh_info</span><span class=p>;</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>sh_addralign</span><span class=p>;</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>   	<span class=kt>uint32_t</span> <span class=n>sh_entsize</span><span class=p>;</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>           <span class=cm>/*
</span></span></span><span class=line><span class=ln>54</span><span class=cl><span class=cm>             Contains the size, in bytes, of each entry, for sections that contain fixed-size entries. 
</span></span></span><span class=line><span class=ln>55</span><span class=cl><span class=cm>             Otherwise, this field contains zero.
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=cm>            */</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>   <span class=p>};</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>   
</span></span><span class=line><span class=ln>59</span><span class=cl>   <span class=c1>// Values for Proghdr::p_type
</span></span></span><span class=line><span class=ln>60</span><span class=cl><span class=c1></span>   <span class=cp>#define ELF_PROG_LOAD		1
</span></span></span><span class=line><span class=ln>61</span><span class=cl><span class=cp></span>   
</span></span><span class=line><span class=ln>62</span><span class=cl>   <span class=c1>// Flag bits for Proghdr::p_flags
</span></span></span><span class=line><span class=ln>63</span><span class=cl><span class=c1></span>   <span class=cp>#define ELF_PROG_FLAG_EXEC	1
</span></span></span><span class=line><span class=ln>64</span><span class=cl><span class=cp></span>   <span class=cp>#define ELF_PROG_FLAG_WRITE	2
</span></span></span><span class=line><span class=ln>65</span><span class=cl><span class=cp></span>   <span class=cp>#define ELF_PROG_FLAG_READ	4
</span></span></span><span class=line><span class=ln>66</span><span class=cl><span class=cp></span>   
</span></span><span class=line><span class=ln>67</span><span class=cl>   <span class=c1>// Values for Secthdr::sh_type
</span></span></span><span class=line><span class=ln>68</span><span class=cl><span class=c1></span>   <span class=cp>#define ELF_SHT_NULL		0
</span></span></span><span class=line><span class=ln>69</span><span class=cl><span class=cp></span>   <span class=cp>#define ELF_SHT_PROGBITS	1
</span></span></span><span class=line><span class=ln>70</span><span class=cl><span class=cp></span>   <span class=cp>#define ELF_SHT_SYMTAB		2
</span></span></span><span class=line><span class=ln>71</span><span class=cl><span class=cp></span>   <span class=cp>#define ELF_SHT_STRTAB		3
</span></span></span><span class=line><span class=ln>72</span><span class=cl><span class=cp></span>   
</span></span><span class=line><span class=ln>73</span><span class=cl>   <span class=c1>// Values for Secthdr::sh_name
</span></span></span><span class=line><span class=ln>74</span><span class=cl><span class=c1></span>   <span class=cp>#define ELF_SHN_UNDEF		0
</span></span></span><span class=line><span class=ln>75</span><span class=cl><span class=cp></span>   
</span></span><span class=line><span class=ln>76</span><span class=cl>   <span class=cp>#endif </span><span class=cm>/* !JOS_INC_ELF_H */</span><span class=cp>
</span></span></span></code></pre></div><p>ä¸‹é¢è¯´å‡ ä¸ªç»†èŠ‚ã€‚æˆ‘ä»¬çŸ¥é“readsectæ˜¯åœ¨è¯»ä¸€ä¸ªæ‰‡åŒºï¼Œä½†æ˜¯æˆ‘æ€ä¹ˆçŸ¥é“æ‰‡åŒºæ˜¯è¿™æ ·è¯»çš„ï¼Ÿå¯ä»¥å‚è€ƒ<a href=https://wiki.osdev.org/ATA_PIO_Mode>ATA_PIO_Modeçš„x86 Directionséƒ¨åˆ†</a></p><p>ç¬¬äºŒä¸ªç»†èŠ‚æ˜¯â€œ((void (*)(void)) (ELFHDR->e_entry))()â€ï¼Œä¹ä¸€çœ‹æœ‰ç‚¹ä¸æ˜è§‰å‰ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œe_entryæ˜¯å…¥å£å‡½æ•°çš„åœ°å€ã€‚é€šçŸ¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œå°†æ§åˆ¶æƒäº¤ç»™elfæ ¼å¼çš„kernel image.</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹æ ¹æ®ç¼–è¯‘boot.så’Œmain.cå¾—åˆ°çš„åæ±‡ç¼–æ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln>  1</span><span class=cl>
</span></span><span class=line><span class=ln>  2</span><span class=cl>    <span class=nf>obj</span><span class=err>/</span><span class=no>boot</span><span class=err>/</span><span class=no>boot.out</span><span class=p>:</span>     <span class=no>file</span> <span class=no>format</span> <span class=no>elf32-i386</span>                                                                                                                                                 
</span></span><span class=line><span class=ln>  3</span><span class=cl>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln>  4</span><span class=cl>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln>  5</span><span class=cl>    <span class=no>Disassembly</span> <span class=no>of</span> <span class=no>section</span> <span class=no>.text</span><span class=p>:</span>                                                                                                                                                                 
</span></span><span class=line><span class=ln>  6</span><span class=cl>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln>  7</span><span class=cl>    <span class=mh>00007c00</span> <span class=p>&lt;</span><span class=no>start</span><span class=p>&gt;:</span>                                                                                                                                                                             
</span></span><span class=line><span class=ln>  8</span><span class=cl>    <span class=no>.set</span> <span class=no>CR0_PE_ON</span><span class=p>,</span>      <span class=mi>0x1</span>         <span class=c1># protected mode enable flag                                                                                                                                 
</span></span></span><span class=line><span class=ln>  9</span><span class=cl><span class=c1></span>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln> 10</span><span class=cl>    <span class=na>.globl</span> <span class=no>start</span>                                                                                                                                                                                  
</span></span><span class=line><span class=ln> 11</span><span class=cl>    <span class=no>start</span><span class=p>:</span>                                                                                                                                                                                        
</span></span><span class=line><span class=ln> 12</span><span class=cl>      <span class=no>.code16</span>                     <span class=c1># Assemble for 16-bit mode                                                                                                                                      
</span></span></span><span class=line><span class=ln> 13</span><span class=cl><span class=c1></span>      <span class=nf>cli</span>                         <span class=c1># Disable interrupts                                                                                                                                            
</span></span></span><span class=line><span class=ln> 14</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c00:</span>       <span class=nf>fa</span>                      <span class=no>cli</span>                                                                                                                                                   
</span></span><span class=line><span class=ln> 15</span><span class=cl>      <span class=no>cld</span>                         <span class=c1># String operations increment                                                                                                                                   
</span></span></span><span class=line><span class=ln> 16</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c01:</span>       <span class=nf>fc</span>                      <span class=no>cld</span>                                                                                                                                                   
</span></span><span class=line><span class=ln> 17</span><span class=cl>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln> 18</span><span class=cl>      <span class=c1># Set up the important data segment registers (DS, ES, SS).                                                                                                                                 
</span></span></span><span class=line><span class=ln> 19</span><span class=cl><span class=c1></span>      <span class=nf>xorw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%ax</span>             <span class=c1># Segment number zero                                                                                                                                           
</span></span></span><span class=line><span class=ln> 20</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c02:</span>       <span class=err>31</span> <span class=nf>c0</span>                   <span class=no>xor</span>    <span class=no>x</span><span class=p>,</span><span class=no>x</span>                                                                                                                                      
</span></span><span class=line><span class=ln> 21</span><span class=cl>      <span class=no>movw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%ds</span>             <span class=c1># - Data Segment                                                                                                                                               
</span></span></span><span class=line><span class=ln> 22</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c04:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>d8</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ds</span>                                                                                                                                       
</span></span><span class=line><span class=ln> 23</span><span class=cl>      <span class=no>movw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%es</span>             <span class=c1># - Extra Segment                                                                                                                                              
</span></span></span><span class=line><span class=ln> 24</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c06:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>c0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%es</span>                                                                                                                                       
</span></span><span class=line><span class=ln> 25</span><span class=cl>      <span class=no>movw</span>    <span class=nv>%ax</span><span class=p>,</span><span class=nv>%ss</span>             <span class=c1># - Stack Segment                                                                                                                                              
</span></span></span><span class=line><span class=ln> 26</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c08:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>d0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ss</span>                                                                                                                                       
</span></span><span class=line><span class=ln> 27</span><span class=cl>                                                                                                                                                                                                  
</span></span><span class=line><span class=ln> 28</span><span class=cl>    <span class=mh>00007c0a</span> <span class=p>&lt;</span><span class=no>seta20.1</span><span class=p>&gt;:</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>      <span class=c1># Enable A20:
</span></span></span><span class=line><span class=ln> 30</span><span class=cl><span class=c1></span>      <span class=c1>#   For backwards compatibility with the earliest PCs, physical
</span></span></span><span class=line><span class=ln> 31</span><span class=cl><span class=c1></span>      <span class=c1>#   address line 20 is tied low, so that addresses higher than
</span></span></span><span class=line><span class=ln> 32</span><span class=cl><span class=c1></span>      <span class=c1>#   1MB wrap around to zero by default.  This code undoes this.
</span></span></span><span class=line><span class=ln> 33</span><span class=cl><span class=c1></span>    <span class=nl>seta20.1:</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>      <span class=nf>inb</span>     <span class=no>$0x64</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># Wait for not busy
</span></span></span><span class=line><span class=ln> 35</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c0a:</span>       <span class=nf>e4</span> <span class=mi>64</span>                   <span class=no>in</span>     <span class=no>$0x64</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>      <span class=nf>testb</span>   <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>        <span class=err>7</span><span class=nl>c0c:</span>       <span class=nf>a8</span> <span class=mi>02</span>                   <span class=no>test</span>   <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>      <span class=nf>jnz</span>     <span class=no>seta20.1</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>        <span class=err>7</span><span class=nl>c0e:</span>       <span class=err>75</span> <span class=nf>fa</span>                   <span class=no>jne</span>    <span class=mh>7c0a</span> <span class=p>&lt;</span><span class=no>seta20.1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>    
</span></span><span class=line><span class=ln> 41</span><span class=cl>      <span class=nf>movb</span>    <span class=no>$0xd1</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># 0xd1 - port 0x64
</span></span></span><span class=line><span class=ln> 42</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c10:</span>       <span class=nf>b0</span> <span class=no>d1</span>                   <span class=no>mov</span>    <span class=no>$0xd1</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>      <span class=nf>outb</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x64</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>        <span class=err>7</span><span class=nl>c12:</span>       <span class=nf>e6</span> <span class=mi>64</span>                   <span class=no>out</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x64</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>    
</span></span><span class=line><span class=ln> 46</span><span class=cl>    <span class=err>00007</span><span class=nf>c14</span> <span class=err>&lt;</span><span class=no>seta20.2</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>    
</span></span><span class=line><span class=ln> 48</span><span class=cl>    <span class=nl>seta20.2:</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>      <span class=nf>inb</span>     <span class=no>$0x64</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># Wait for not busy
</span></span></span><span class=line><span class=ln> 50</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c14:</span>       <span class=nf>e4</span> <span class=mi>64</span>                   <span class=no>in</span>     <span class=no>$0x64</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>      <span class=nf>testb</span>   <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl>        <span class=err>7</span><span class=nl>c16:</span>       <span class=nf>a8</span> <span class=mi>02</span>                   <span class=no>test</span>   <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>      <span class=nf>jnz</span>     <span class=no>seta20.2</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>        <span class=err>7</span><span class=nl>c18:</span>       <span class=err>75</span> <span class=nf>fa</span>                   <span class=no>jne</span>    <span class=mh>7c14</span> <span class=p>&lt;</span><span class=no>seta20.2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>    
</span></span><span class=line><span class=ln> 56</span><span class=cl>      <span class=nf>movb</span>    <span class=no>$0xdf</span><span class=p>,</span><span class=nv>%al</span>               <span class=c1># 0xdf - port 0x60
</span></span></span><span class=line><span class=ln> 57</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c1a:</span>       <span class=nf>b0</span> <span class=no>df</span>                   <span class=no>mov</span>    <span class=no>$0xdf</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>      <span class=nf>outb</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x60</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>        <span class=err>7</span><span class=nl>c1c:</span>       <span class=nf>e6</span> <span class=mi>60</span>                   <span class=no>out</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x60</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>    
</span></span><span class=line><span class=ln> 61</span><span class=cl>      <span class=c1># Switch from real to protected mode, using a bootstrap GDT
</span></span></span><span class=line><span class=ln> 62</span><span class=cl><span class=c1></span>      <span class=c1># and segment translation that makes virtual addresses 
</span></span></span><span class=line><span class=ln> 63</span><span class=cl><span class=c1></span>      <span class=c1># identical to their physical addresses, so that the 
</span></span></span><span class=line><span class=ln> 64</span><span class=cl><span class=c1></span>      <span class=c1># effective memory map does not change during the switch.
</span></span></span><span class=line><span class=ln> 65</span><span class=cl><span class=c1></span>      <span class=nf>lgdt</span>    <span class=no>gdtdesc</span>  <span class=c1># lgdt means load global descriptor table
</span></span></span><span class=line><span class=ln> 66</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c1e:</span>       <span class=err>0</span><span class=nf>f</span> <span class=mi>01</span> <span class=mi>16</span>                <span class=no>lgdtl</span>  <span class=p>(</span><span class=nv>%esi</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>        <span class=err>7</span><span class=nl>c21:</span>       <span class=err>64</span> <span class=err>7</span><span class=nf>c</span> <span class=mi>0</span><span class=no>f</span>                <span class=no>fs</span> <span class=no>jl</span>  <span class=mh>7c33</span> <span class=p>&lt;</span><span class=no>protcseg</span><span class=p>+</span><span class=mi>0x1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>      <span class=nf>movl</span>    <span class=nv>%cr0</span><span class=p>,</span> <span class=no>x</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>        <span class=err>7</span><span class=nl>c24:</span>       <span class=err>20</span> <span class=nf>c0</span>                   <span class=no>and</span>    <span class=nv>%al</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>      <span class=nf>orl</span>     <span class=no>$CR0_PE_ON</span><span class=p>,</span> <span class=no>x</span>  <span class=c1># crx = crx | 1
</span></span></span><span class=line><span class=ln> 71</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c26:</span>       <span class=err>66</span> <span class=err>83</span> <span class=nf>c8</span> <span class=mi>01</span>             <span class=no>or</span>     <span class=no>$0x1</span><span class=p>,</span><span class=nv>%ax</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>      <span class=nf>movl</span>    <span class=no>x</span><span class=p>,</span> <span class=nv>%cr0</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>        <span class=err>7</span><span class=nl>c2a:</span>       <span class=err>0</span><span class=nf>f</span> <span class=mi>22</span> <span class=no>c0</span>                <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%cr0</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>      
</span></span><span class=line><span class=ln> 75</span><span class=cl>      <span class=c1># Jump to next instruction, but in 32-bit code segment.
</span></span></span><span class=line><span class=ln> 76</span><span class=cl><span class=c1></span>      <span class=c1># Switches processor into 32-bit mode.
</span></span></span><span class=line><span class=ln> 77</span><span class=cl><span class=c1></span>      <span class=nf>ljmp</span>    <span class=no>$PROT_MODE_CSEG</span><span class=p>,</span> <span class=no>$protcseg</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>        <span class=err>7</span><span class=nl>c2d:</span>       <span class=nf>ea</span>                      <span class=no>.byte</span> <span class=mi>0xea</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>        <span class=err>7</span><span class=nl>c2e:</span>       <span class=err>32</span> <span class=err>7</span><span class=nf>c</span> <span class=mi>08</span> <span class=mi>00</span>             <span class=no>xor</span>    <span class=mi>0x0</span><span class=p>(</span><span class=no>x</span><span class=p>,</span><span class=no>x</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=nv>%bh</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>    
</span></span><span class=line><span class=ln> 81</span><span class=cl>    <span class=err>00007</span><span class=nf>c32</span> <span class=err>&lt;</span><span class=no>protcseg</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>    
</span></span><span class=line><span class=ln> 83</span><span class=cl>      <span class=na>.code32</span>                     <span class=c1># Assemble for 32-bit mode
</span></span></span><span class=line><span class=ln> 84</span><span class=cl><span class=c1></span>    <span class=nl>protcseg:</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>      <span class=c1># Set up the protected-mode data segment registers
</span></span></span><span class=line><span class=ln> 86</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=no>$PROT_MODE_DSEG</span><span class=p>,</span> <span class=nv>%ax</span>    <span class=c1># Our data segment selector
</span></span></span><span class=line><span class=ln> 87</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c32:</span>       <span class=err>66</span> <span class=nf>b8</span> <span class=mi>10</span> <span class=mi>00</span>             <span class=no>mov</span>    <span class=no>$0x10</span><span class=p>,</span><span class=nv>%ax</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%ds</span>                <span class=c1># - DS: Data Segment
</span></span></span><span class=line><span class=ln> 89</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c36:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>d8</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ds</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%es</span>                <span class=c1># - ES: Extra Segment
</span></span></span><span class=line><span class=ln> 91</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c38:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>c0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%es</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%fs</span>                <span class=c1># - FS
</span></span></span><span class=line><span class=ln> 93</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c3a:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>e0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%fs</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%gs</span>                <span class=c1># - GS
</span></span></span><span class=line><span class=ln> 95</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c3c:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>e8</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%gs</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%ss</span>                <span class=c1># - SS: Stack Segment
</span></span></span><span class=line><span class=ln> 97</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c3e:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>d0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ss</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>      
</span></span><span class=line><span class=ln> 99</span><span class=cl>      <span class=c1># Set up the stack pointer and call into C.
</span></span></span><span class=line><span class=ln>100</span><span class=cl><span class=c1></span>      <span class=nf>movl</span>    <span class=no>$start</span><span class=p>,</span> <span class=nv>%esp</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>        <span class=err>7</span><span class=nl>c40:</span>       <span class=nf>bc</span> <span class=mi>00</span> <span class=mi>7</span><span class=no>c</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x7c00</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>      <span class=nf>call</span> <span class=no>bootmain</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>        <span class=err>7</span><span class=nl>c45:</span>       <span class=nf>e8</span> <span class=no>c0</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>call</span>   <span class=mh>7d0a</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>    
</span></span><span class=line><span class=ln>105</span><span class=cl>    <span class=err>00007</span><span class=nf>c4a</span> <span class=err>&lt;</span><span class=no>spin</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>    
</span></span><span class=line><span class=ln>107</span><span class=cl>      <span class=c1># If bootmain returns (it shouldn&#39;t), loop.
</span></span></span><span class=line><span class=ln>108</span><span class=cl><span class=c1></span>    <span class=nl>spin:</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>      <span class=nf>jmp</span> <span class=no>spin</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>        <span class=err>7</span><span class=nl>c4a:</span>       <span class=nf>eb</span> <span class=no>fe</span>                   <span class=no>jmp</span>    <span class=mh>7c4a</span> <span class=p>&lt;</span><span class=no>spin</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>111</span><span class=cl>    
</span></span><span class=line><span class=ln>112</span><span class=cl>    <span class=err>00007</span><span class=nf>c4c</span> <span class=err>&lt;</span><span class=no>gdt</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>            <span class=na>...</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>        <span class=err>7</span><span class=nl>c54:</span>       <span class=nf>ff</span>                      <span class=p>(</span><span class=no>bad</span><span class=p>)</span>  
</span></span><span class=line><span class=ln>115</span><span class=cl>        <span class=mi>7</span><span class=no>c55</span><span class=p>:</span>       <span class=no>ff</span> <span class=mi>00</span>                   <span class=no>incl</span>   <span class=p>(</span><span class=no>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>        <span class=err>7</span><span class=nl>c57:</span>       <span class=err>00</span> <span class=err>00</span>                   <span class=nf>add</span>    <span class=nv>%al</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>        <span class=err>7</span><span class=nl>c59:</span>       <span class=err>9</span><span class=nf>a</span> <span class=no>cf</span> <span class=mi>00</span> <span class=no>ff</span> <span class=no>ff</span> <span class=mi>00</span> <span class=mi>00</span>    <span class=no>lcall</span>  <span class=no>$0x0</span><span class=p>,</span><span class=no>$0xffff00cf</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>        <span class=err>7</span><span class=nl>c60:</span>       <span class=err>00</span>                      <span class=na>.byte</span> <span class=mi>0x0</span>
</span></span><span class=line><span class=ln>119</span><span class=cl>        <span class=err>7</span><span class=nl>c61:</span>       <span class=err>92</span>                      <span class=nf>xchg</span>   <span class=no>x</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>120</span><span class=cl>        <span class=err>7</span><span class=nl>c62:</span>       <span class=nf>cf</span>                      <span class=no>iret</span>   
</span></span><span class=line><span class=ln>121</span><span class=cl>            <span class=no>...</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>    
</span></span><span class=line><span class=ln>123</span><span class=cl>    <span class=err>00007</span><span class=nf>c64</span> <span class=err>&lt;</span><span class=no>gdtdesc</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>        <span class=err>7</span><span class=nl>c64:</span>       <span class=err>17</span>                      <span class=nf>pop</span>    <span class=nv>%ss</span>
</span></span><span class=line><span class=ln>125</span><span class=cl>        <span class=err>7</span><span class=nl>c65:</span>       <span class=err>00</span> <span class=err>4</span><span class=nf>c</span> <span class=mi>7</span><span class=no>c</span> <span class=mi>00</span>             <span class=no>add</span>    <span class=nv>%cl</span><span class=p>,</span><span class=mi>0x0</span><span class=p>(</span><span class=nv>%esp</span><span class=p>,</span><span class=no>i</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln>126</span><span class=cl>            <span class=na>...</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>    
</span></span><span class=line><span class=ln>128</span><span class=cl>    <span class=err>00007</span><span class=nf>c6a</span> <span class=err>&lt;</span><span class=no>waitdisk</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>129</span><span class=cl>            <span class=err>}</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>    
</span></span><span class=line><span class=ln>132</span><span class=cl>    <span class=nf>void</span>
</span></span><span class=line><span class=ln>133</span><span class=cl>    <span class=nf>waitdisk</span><span class=p>(</span><span class=no>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln>134</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>        <span class=err>7</span><span class=nl>c6a:</span>       <span class=err>55</span>                      <span class=nf>push</span>   <span class=no>p</span>
</span></span><span class=line><span class=ln>136</span><span class=cl>    
</span></span><span class=line><span class=ln>137</span><span class=cl>    <span class=nf>static</span> <span class=no>inline</span> <span class=no>uint8_t</span>
</span></span><span class=line><span class=ln>138</span><span class=cl>    <span class=nf>inb</span><span class=p>(</span><span class=no>int</span> <span class=no>port</span><span class=p>)</span>
</span></span><span class=line><span class=ln>139</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>140</span><span class=cl>            <span class=nf>uint8_t</span> <span class=no>data</span><span class=c1>;
</span></span></span><span class=line><span class=ln>141</span><span class=cl><span class=c1></span>            <span class=nf>asm</span> <span class=no>volatile</span><span class=p>(</span><span class=err>&#34;</span><span class=no>inb</span> <span class=nv>%w1</span><span class=p>,</span><span class=err>%</span><span class=mi>0</span><span class=err>&#34;</span> <span class=p>:</span> <span class=err>&#34;=</span><span class=no>a</span><span class=err>&#34;</span> <span class=p>(</span><span class=no>data</span><span class=p>)</span> <span class=p>:</span> <span class=err>&#34;</span><span class=no>d</span><span class=err>&#34;</span> <span class=p>(</span><span class=no>port</span><span class=p>))</span><span class=c1>;
</span></span></span><span class=line><span class=ln>142</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c6b:</span>       <span class=nf>ba</span> <span class=no>f7</span> <span class=mi>01</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x1f7</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>143</span><span class=cl>        <span class=err>7</span><span class=nl>c70:</span>       <span class=err>89</span> <span class=nf>e5</span>                   <span class=no>mov</span>    <span class=nv>%esp</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln>144</span><span class=cl>        <span class=err>7</span><span class=nl>c72:</span>       <span class=nf>ec</span>                      <span class=no>in</span>     <span class=p>(</span><span class=nv>%dx</span><span class=p>),</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>145</span><span class=cl>            <span class=c1>// wait for disk reaady
</span></span></span><span class=line><span class=ln>146</span><span class=cl><span class=c1></span>            <span class=nf>while</span> <span class=p>((</span><span class=no>inb</span><span class=p>(</span><span class=mi>0x1F7</span><span class=p>)</span> <span class=err>&amp;</span> <span class=mi>0xC0</span><span class=p>)</span> <span class=p>!</span><span class=err>=</span> <span class=mi>0x40</span><span class=p>)</span>
</span></span><span class=line><span class=ln>147</span><span class=cl>        <span class=err>7</span><span class=nl>c73:</span>       <span class=err>83</span> <span class=nf>e0</span> <span class=no>c0</span>                <span class=no>and</span>    <span class=no>$0xffffffc0</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>148</span><span class=cl>        <span class=err>7</span><span class=nl>c76:</span>       <span class=err>3</span><span class=nf>c</span> <span class=mi>40</span>                   <span class=no>cmp</span>    <span class=no>$0x40</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>149</span><span class=cl>        <span class=err>7</span><span class=nl>c78:</span>       <span class=err>75</span> <span class=nf>f8</span>                   <span class=no>jne</span>    <span class=mh>7c72</span> <span class=p>&lt;</span><span class=no>waitdisk</span><span class=p>+</span><span class=mi>0x8</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>150</span><span class=cl>                    <span class=cm>/* do nothing */</span><span class=c1>;
</span></span></span><span class=line><span class=ln>151</span><span class=cl><span class=c1></span>    <span class=err>}</span>
</span></span><span class=line><span class=ln>152</span><span class=cl>        <span class=err>7</span><span class=nl>c7a:</span>       <span class=err>5</span><span class=nf>d</span>                      <span class=no>pop</span>    <span class=no>p</span>
</span></span><span class=line><span class=ln>153</span><span class=cl>        <span class=err>7</span><span class=nl>c7b:</span>       <span class=nf>c3</span>                      <span class=no>ret</span>    
</span></span><span class=line><span class=ln>154</span><span class=cl>    
</span></span><span class=line><span class=ln>155</span><span class=cl>    <span class=mh>00007c7c</span> <span class=p>&lt;</span><span class=no>readsect</span><span class=p>&gt;:</span>
</span></span><span class=line><span class=ln>156</span><span class=cl>    
</span></span><span class=line><span class=ln>157</span><span class=cl>    <span class=nf>void</span>
</span></span><span class=line><span class=ln>158</span><span class=cl>    <span class=nf>readsect</span><span class=p>(</span><span class=no>void</span> <span class=p>*</span><span class=no>dst</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>159</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>160</span><span class=cl>        <span class=err>7</span><span class=nl>c7c:</span>       <span class=err>55</span>                      <span class=nf>push</span>   <span class=no>p</span>
</span></span><span class=line><span class=ln>161</span><span class=cl>        <span class=err>7</span><span class=nl>c7d:</span>       <span class=err>89</span> <span class=nf>e5</span>                   <span class=no>mov</span>    <span class=nv>%esp</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln>162</span><span class=cl>        <span class=err>7</span><span class=nl>c7f:</span>       <span class=err>57</span>                      <span class=nf>push</span>   <span class=no>i</span>
</span></span><span class=line><span class=ln>163</span><span class=cl>        <span class=err>7</span><span class=nl>c80:</span>       <span class=err>53</span>                      <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln>164</span><span class=cl>        <span class=err>7</span><span class=nl>c81:</span>       <span class=err>8</span><span class=nf>b</span> <span class=mi>5</span><span class=no>d</span> <span class=mi>0</span><span class=no>c</span>                <span class=no>mov</span>    <span class=mi>0xc</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>165</span><span class=cl>            <span class=c1>// wait for disk to be ready
</span></span></span><span class=line><span class=ln>166</span><span class=cl><span class=c1></span>            <span class=nf>waitdisk</span><span class=p>()</span><span class=c1>;
</span></span></span><span class=line><span class=ln>167</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c84:</span>       <span class=nf>e8</span> <span class=no>e1</span> <span class=no>ff</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>call</span>   <span class=mh>7c6a</span> <span class=p>&lt;</span><span class=no>waitdisk</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>168</span><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=ln>169</span><span class=cl>    
</span></span><span class=line><span class=ln>170</span><span class=cl>    <span class=nf>static</span> <span class=no>inline</span> <span class=no>void</span>
</span></span><span class=line><span class=ln>171</span><span class=cl>    <span class=nf>outb</span><span class=p>(</span><span class=no>int</span> <span class=no>port</span><span class=p>,</span> <span class=no>uint8_t</span> <span class=no>data</span><span class=p>)</span>
</span></span><span class=line><span class=ln>172</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>173</span><span class=cl>            <span class=nf>asm</span> <span class=no>volatile</span><span class=p>(</span><span class=err>&#34;</span><span class=no>outb</span> <span class=err>%</span><span class=mi>0</span><span class=p>,</span><span class=nv>%w1</span><span class=err>&#34;</span> <span class=p>:</span> <span class=p>:</span> <span class=err>&#34;</span><span class=no>a</span><span class=err>&#34;</span> <span class=p>(</span><span class=no>data</span><span class=p>),</span> <span class=err>&#34;</span><span class=no>d</span><span class=err>&#34;</span> <span class=p>(</span><span class=no>port</span><span class=p>))</span><span class=c1>;
</span></span></span><span class=line><span class=ln>174</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c89:</span>       <span class=nf>ba</span> <span class=no>f2</span> <span class=mi>01</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x1f2</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>175</span><span class=cl>        <span class=err>7</span><span class=nl>c8e:</span>       <span class=nf>b0</span> <span class=mi>01</span>                   <span class=no>mov</span>    <span class=no>$0x1</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>176</span><span class=cl>        <span class=err>7</span><span class=nl>c90:</span>       <span class=nf>ee</span>                      <span class=no>out</span>    <span class=nv>%al</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>177</span><span class=cl>        <span class=err>7</span><span class=nl>c91:</span>       <span class=err>0</span><span class=nf>f</span> <span class=no>b6</span> <span class=no>c3</span>                <span class=no>movzbl</span> <span class=nv>%bl</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>178</span><span class=cl>        <span class=err>7</span><span class=nl>c94:</span>       <span class=nf>b2</span> <span class=no>f3</span>                   <span class=no>mov</span>    <span class=no>$0xf3</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>179</span><span class=cl>        <span class=err>7</span><span class=nl>c96:</span>       <span class=nf>ee</span>                      <span class=no>out</span>    <span class=nv>%al</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>180</span><span class=cl>        <span class=err>7</span><span class=nl>c97:</span>       <span class=err>0</span><span class=nf>f</span> <span class=no>b6</span> <span class=no>c7</span>                <span class=no>movzbl</span> <span class=nv>%bh</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>181</span><span class=cl>        <span class=err>7</span><span class=nl>c9a:</span>       <span class=nf>b2</span> <span class=no>f4</span>                   <span class=no>mov</span>    <span class=no>$0xf4</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>182</span><span class=cl>        <span class=err>7</span><span class=nl>c9c:</span>       <span class=nf>ee</span>                      <span class=no>out</span>    <span class=nv>%al</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>183</span><span class=cl>    
</span></span><span class=line><span class=ln>184</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mi>0x1F2</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span><span class=c1>;         // count = 1
</span></span></span><span class=line><span class=ln>185</span><span class=cl><span class=c1></span>            <span class=nf>outb</span><span class=p>(</span><span class=mi>0x1F3</span><span class=p>,</span> <span class=no>offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>186</span><span class=cl><span class=c1></span>            <span class=nf>outb</span><span class=p>(</span><span class=mi>0x1F4</span><span class=p>,</span> <span class=no>offset</span> <span class=err>&gt;</span> <span class=mi>8</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>187</span><span class=cl><span class=c1></span>            <span class=nf>outb</span><span class=p>(</span><span class=mi>0x1F5</span><span class=p>,</span> <span class=no>offset</span> <span class=err>&gt;</span> <span class=mi>16</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>188</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>c9d:</span>       <span class=err>89</span> <span class=nf>d8</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>189</span><span class=cl>        <span class=err>7</span><span class=nl>c9f:</span>       <span class=nf>b2</span> <span class=no>f5</span>                   <span class=no>mov</span>    <span class=no>$0xf5</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>190</span><span class=cl>        <span class=err>7</span><span class=nl>ca1:</span>       <span class=nf>c1</span> <span class=no>e8</span> <span class=mi>10</span>                <span class=no>shr</span>    <span class=no>$0x10</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>191</span><span class=cl>        <span class=err>7</span><span class=nl>ca4:</span>       <span class=err>0</span><span class=nf>f</span> <span class=no>b6</span> <span class=no>c0</span>                <span class=no>movzbl</span> <span class=nv>%al</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>192</span><span class=cl>        <span class=err>7</span><span class=nl>ca7:</span>       <span class=nf>ee</span>                      <span class=no>out</span>    <span class=nv>%al</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>193</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mi>0x1F6</span><span class=p>,</span> <span class=p>(</span><span class=no>offset</span> <span class=err>&gt;</span> <span class=mi>24</span><span class=p>)</span> <span class=err>|</span> <span class=mi>0xE0</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>194</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>ca8:</span>       <span class=nf>c1</span> <span class=no>eb</span> <span class=mi>18</span>                <span class=no>shr</span>    <span class=no>$0x18</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>195</span><span class=cl>        <span class=err>7</span><span class=nl>cab:</span>       <span class=nf>b2</span> <span class=no>f6</span>                   <span class=no>mov</span>    <span class=no>$0xf6</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>196</span><span class=cl>        <span class=err>7</span><span class=nl>cad:</span>       <span class=err>88</span> <span class=nf>d8</span>                   <span class=no>mov</span>    <span class=nv>%bl</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>197</span><span class=cl>        <span class=err>7</span><span class=nl>caf:</span>       <span class=err>83</span> <span class=nf>c8</span> <span class=no>e0</span>                <span class=no>or</span>     <span class=no>$0xffffffe0</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>198</span><span class=cl>        <span class=err>7</span><span class=nl>cb2:</span>       <span class=nf>ee</span>                      <span class=no>out</span>    <span class=nv>%al</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>199</span><span class=cl>        <span class=err>7</span><span class=nl>cb3:</span>       <span class=nf>b0</span> <span class=mi>20</span>                   <span class=no>mov</span>    <span class=no>$0x20</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>200</span><span class=cl>        <span class=err>7</span><span class=nl>cb5:</span>       <span class=nf>b2</span> <span class=no>f7</span>                   <span class=no>mov</span>    <span class=no>$0xf7</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>201</span><span class=cl>        <span class=err>7</span><span class=nl>cb7:</span>       <span class=nf>ee</span>                      <span class=no>out</span>    <span class=nv>%al</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>202</span><span class=cl>            <span class=nf>outb</span><span class=p>(</span><span class=mi>0x1F7</span><span class=p>,</span> <span class=mi>0x20</span><span class=p>)</span><span class=c1>;      // cmd 0x20 - read sectors
</span></span></span><span class=line><span class=ln>203</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>204</span><span class=cl>            <span class=c1>// wait for disk to be ready
</span></span></span><span class=line><span class=ln>205</span><span class=cl><span class=c1></span>            <span class=nf>waitdisk</span><span class=p>()</span><span class=c1>;
</span></span></span><span class=line><span class=ln>206</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cb8:</span>       <span class=nf>e8</span> <span class=no>ad</span> <span class=no>ff</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>call</span>   <span class=mh>7c6a</span> <span class=p>&lt;</span><span class=no>waitdisk</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>207</span><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=ln>208</span><span class=cl>    
</span></span><span class=line><span class=ln>209</span><span class=cl>    <span class=nf>static</span> <span class=no>inline</span> <span class=no>void</span>
</span></span><span class=line><span class=ln>210</span><span class=cl>    <span class=nf>insl</span><span class=p>(</span><span class=no>int</span> <span class=no>port</span><span class=p>,</span> <span class=no>void</span> <span class=p>*</span><span class=no>addr</span><span class=p>,</span> <span class=no>int</span> <span class=no>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=ln>211</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>212</span><span class=cl>            <span class=nf>asm</span> <span class=no>volatile</span><span class=p>(</span><span class=err>&#34;</span><span class=no>cld</span><span class=err>\</span><span class=no>n</span><span class=err>\</span><span class=no>trepne</span><span class=err>\</span><span class=no>n</span><span class=err>\</span><span class=no>tinsl</span><span class=err>&#34;</span>
</span></span><span class=line><span class=ln>213</span><span class=cl>        <span class=err>7</span><span class=nl>cbd:</span>       <span class=err>8</span><span class=nf>b</span> <span class=mi>7</span><span class=no>d</span> <span class=mi>08</span>                <span class=no>mov</span>    <span class=mi>0x8</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=no>i</span>
</span></span><span class=line><span class=ln>214</span><span class=cl>        <span class=err>7</span><span class=nl>cc0:</span>       <span class=nf>b9</span> <span class=mi>80</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x80</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>215</span><span class=cl>        <span class=err>7</span><span class=nl>cc5:</span>       <span class=nf>ba</span> <span class=no>f0</span> <span class=mi>01</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x1f0</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>216</span><span class=cl>        <span class=err>7</span><span class=nl>cca:</span>       <span class=nf>fc</span>                      <span class=no>cld</span>    
</span></span><span class=line><span class=ln>217</span><span class=cl>        <span class=mi>7</span><span class=no>ccb</span><span class=p>:</span>       <span class=no>f2</span> <span class=mi>6</span><span class=no>d</span>                   <span class=no>repnz</span> <span class=no>insl</span> <span class=p>(</span><span class=nv>%dx</span><span class=p>),</span><span class=nv>%es</span><span class=p>:(</span><span class=no>i</span><span class=p>)</span>
</span></span><span class=line><span class=ln>218</span><span class=cl>    
</span></span><span class=line><span class=ln>219</span><span class=cl>            <span class=c1>// read a sector
</span></span></span><span class=line><span class=ln>220</span><span class=cl><span class=c1></span>            <span class=nf>insl</span><span class=p>(</span><span class=mi>0x1F0</span><span class=p>,</span> <span class=no>dst</span><span class=p>,</span> <span class=no>SECTSIZE</span><span class=err>/</span><span class=mi>4</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>221</span><span class=cl><span class=c1></span>    <span class=err>}</span>
</span></span><span class=line><span class=ln>222</span><span class=cl>        <span class=err>7</span><span class=nl>ccd:</span>       <span class=err>5</span><span class=nf>b</span>                      <span class=no>pop</span>    <span class=no>x</span>
</span></span><span class=line><span class=ln>223</span><span class=cl>        <span class=err>7</span><span class=nl>cce:</span>       <span class=err>5</span><span class=nf>f</span>                      <span class=no>pop</span>    <span class=no>i</span>
</span></span><span class=line><span class=ln>224</span><span class=cl>        <span class=err>7</span><span class=nl>ccf:</span>       <span class=err>5</span><span class=nf>d</span>                      <span class=no>pop</span>    <span class=no>p</span>
</span></span><span class=line><span class=ln>225</span><span class=cl>        <span class=err>7</span><span class=nl>cd0:</span>       <span class=nf>c3</span>                      <span class=no>ret</span>    
</span></span><span class=line><span class=ln>226</span><span class=cl>    
</span></span><span class=line><span class=ln>227</span><span class=cl>    <span class=mh>00007cd1</span> <span class=p>&lt;</span><span class=no>readseg</span><span class=p>&gt;:</span>
</span></span><span class=line><span class=ln>228</span><span class=cl>    
</span></span><span class=line><span class=ln>229</span><span class=cl>    <span class=c1>// Read &#39;count&#39; bytes at &#39;offset&#39; from kernel into physical address &#39;pa&#39;.
</span></span></span><span class=line><span class=ln>230</span><span class=cl><span class=c1></span>    <span class=c1>// Might copy more than asked
</span></span></span><span class=line><span class=ln>231</span><span class=cl><span class=c1></span>    <span class=nf>void</span>
</span></span><span class=line><span class=ln>232</span><span class=cl>    <span class=nf>readseg</span><span class=p>(</span><span class=no>uint32_t</span> <span class=no>pa</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>count</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>233</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>234</span><span class=cl>        <span class=err>7</span><span class=nl>cd1:</span>       <span class=err>55</span>                      <span class=nf>push</span>   <span class=no>p</span>
</span></span><span class=line><span class=ln>235</span><span class=cl>        <span class=err>7</span><span class=nl>cd2:</span>       <span class=err>89</span> <span class=nf>e5</span>                   <span class=no>mov</span>    <span class=nv>%esp</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln>236</span><span class=cl>        <span class=err>7</span><span class=nl>cd4:</span>       <span class=err>57</span>                      <span class=nf>push</span>   <span class=no>i</span>
</span></span><span class=line><span class=ln>237</span><span class=cl>            <span class=nf>uint32_t</span> <span class=no>end_pa</span><span class=c1>;
</span></span></span><span class=line><span class=ln>238</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>239</span><span class=cl>            <span class=nf>end_pa</span> <span class=err>=</span> <span class=no>pa</span> <span class=err>+</span> <span class=no>count</span><span class=c1>;
</span></span></span><span class=line><span class=ln>240</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cd5:</span>       <span class=err>8</span><span class=nf>b</span> <span class=mi>7</span><span class=no>d</span> <span class=mi>0</span><span class=no>c</span>                <span class=no>mov</span>    <span class=mi>0xc</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=no>i</span>
</span></span><span class=line><span class=ln>241</span><span class=cl>    
</span></span><span class=line><span class=ln>242</span><span class=cl>    <span class=c1>// Read &#39;count&#39; bytes at &#39;offset&#39; from kernel into physical address &#39;pa&#39;.
</span></span></span><span class=line><span class=ln>243</span><span class=cl><span class=c1></span>    <span class=c1>// Might copy more than asked
</span></span></span><span class=line><span class=ln>244</span><span class=cl><span class=c1></span>    <span class=nf>void</span>
</span></span><span class=line><span class=ln>245</span><span class=cl>    <span class=nf>readseg</span><span class=p>(</span><span class=no>uint32_t</span> <span class=no>pa</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>count</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>246</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>247</span><span class=cl>        <span class=err>7</span><span class=nl>cd8:</span>       <span class=err>56</span>                      <span class=nf>push</span>   <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>248</span><span class=cl>        <span class=err>7</span><span class=nl>cd9:</span>       <span class=err>8</span><span class=nf>b</span> <span class=mi>75</span> <span class=mi>10</span>                <span class=no>mov</span>    <span class=mi>0x10</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=nv>%esi</span>
</span></span><span class=line><span class=ln>249</span><span class=cl>        <span class=err>7</span><span class=nl>cdc:</span>       <span class=err>53</span>                      <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln>250</span><span class=cl>        <span class=err>7</span><span class=nl>cdd:</span>       <span class=err>8</span><span class=nf>b</span> <span class=mi>5</span><span class=no>d</span> <span class=mi>08</span>                <span class=no>mov</span>    <span class=mi>0x8</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>251</span><span class=cl>    
</span></span><span class=line><span class=ln>252</span><span class=cl>            <span class=c1>// round down to sector boundary
</span></span></span><span class=line><span class=ln>253</span><span class=cl><span class=c1></span>            <span class=nf>pa</span> <span class=err>&amp;=</span> <span class=err>~</span><span class=p>(</span><span class=no>SECTSIZE</span> <span class=p>-</span> <span class=mi>1</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>254</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>255</span><span class=cl>            <span class=c1>// translate from bytes to sectors, and kernel starts at sector 1
</span></span></span><span class=line><span class=ln>256</span><span class=cl><span class=c1></span>            <span class=nf>offset</span> <span class=err>=</span> <span class=p>(</span><span class=no>offset</span> <span class=err>/</span> <span class=no>SECTSIZE</span><span class=p>)</span> <span class=err>+</span> <span class=mi>1</span><span class=c1>;
</span></span></span><span class=line><span class=ln>257</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>ce0:</span>       <span class=nf>c1</span> <span class=no>ee</span> <span class=mi>09</span>                <span class=no>shr</span>    <span class=no>$0x9</span><span class=p>,</span><span class=nv>%esi</span>
</span></span><span class=line><span class=ln>258</span><span class=cl>    <span class=nf>void</span>
</span></span><span class=line><span class=ln>259</span><span class=cl>    <span class=nf>readseg</span><span class=p>(</span><span class=no>uint32_t</span> <span class=no>pa</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>count</span><span class=p>,</span> <span class=no>uint32_t</span> <span class=no>offset</span><span class=p>)</span>
</span></span><span class=line><span class=ln>260</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>261</span><span class=cl>            <span class=nf>uint32_t</span> <span class=no>end_pa</span><span class=c1>;
</span></span></span><span class=line><span class=ln>262</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>263</span><span class=cl>            <span class=nf>end_pa</span> <span class=err>=</span> <span class=no>pa</span> <span class=err>+</span> <span class=no>count</span><span class=c1>;
</span></span></span><span class=line><span class=ln>264</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>ce3:</span>       <span class=err>01</span> <span class=nf>df</span>                   <span class=no>add</span>    <span class=no>x</span><span class=p>,</span><span class=no>i</span>
</span></span><span class=line><span class=ln>265</span><span class=cl>    
</span></span><span class=line><span class=ln>266</span><span class=cl>            <span class=c1>// round down to sector boundary
</span></span></span><span class=line><span class=ln>267</span><span class=cl><span class=c1></span>            <span class=nf>pa</span> <span class=err>&amp;=</span> <span class=err>~</span><span class=p>(</span><span class=no>SECTSIZE</span> <span class=p>-</span> <span class=mi>1</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>268</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>269</span><span class=cl>            <span class=c1>// translate from bytes to sectors, and kernel starts at sector 1
</span></span></span><span class=line><span class=ln>270</span><span class=cl><span class=c1></span>            <span class=nf>offset</span> <span class=err>=</span> <span class=p>(</span><span class=no>offset</span> <span class=err>/</span> <span class=no>SECTSIZE</span><span class=p>)</span> <span class=err>+</span> <span class=mi>1</span><span class=c1>;
</span></span></span><span class=line><span class=ln>271</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>ce5:</span>       <span class=err>46</span>                      <span class=nf>inc</span>    <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>272</span><span class=cl>            <span class=nf>uint32_t</span> <span class=no>end_pa</span><span class=c1>;
</span></span></span><span class=line><span class=ln>273</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>274</span><span class=cl>            <span class=nf>end_pa</span> <span class=err>=</span> <span class=no>pa</span> <span class=err>+</span> <span class=no>count</span><span class=c1>;
</span></span></span><span class=line><span class=ln>275</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>276</span><span class=cl>            <span class=c1>// round down to sector boundary
</span></span></span><span class=line><span class=ln>277</span><span class=cl><span class=c1></span>            <span class=nf>pa</span> <span class=err>&amp;=</span> <span class=err>~</span><span class=p>(</span><span class=no>SECTSIZE</span> <span class=p>-</span> <span class=mi>1</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>278</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>ce6:</span>       <span class=err>81</span> <span class=nf>e3</span> <span class=mi>00</span> <span class=no>fe</span> <span class=no>ff</span> <span class=no>ff</span>       <span class=no>and</span>    <span class=no>$0xfffffe00</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>279</span><span class=cl>            <span class=nf>offset</span> <span class=err>=</span> <span class=p>(</span><span class=no>offset</span> <span class=err>/</span> <span class=no>SECTSIZE</span><span class=p>)</span> <span class=err>+</span> <span class=mi>1</span><span class=c1>;
</span></span></span><span class=line><span class=ln>280</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>281</span><span class=cl>            <span class=c1>// If this is too slow, we could read lots of sectors at a time.
</span></span></span><span class=line><span class=ln>282</span><span class=cl><span class=c1></span>            <span class=c1>// We&#39;d write more to memory than asked, but it doesn&#39;t matter --
</span></span></span><span class=line><span class=ln>283</span><span class=cl><span class=c1></span>            <span class=c1>// we load in increasing order.
</span></span></span><span class=line><span class=ln>284</span><span class=cl><span class=c1></span>            <span class=nf>while</span> <span class=p>(</span><span class=no>pa</span> <span class=err>&lt;</span> <span class=no>end_pa</span><span class=p>)</span> <span class=err>{</span>
</span></span><span class=line><span class=ln>285</span><span class=cl>        <span class=err>7</span><span class=nl>cec:</span>       <span class=err>39</span> <span class=nf>fb</span>                   <span class=no>cmp</span>    <span class=no>i</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>286</span><span class=cl>        <span class=err>7</span><span class=nl>cee:</span>       <span class=err>73</span> <span class=err>12</span>                   <span class=nf>jae</span>    <span class=mh>7d02</span> <span class=p>&lt;</span><span class=no>readseg</span><span class=p>+</span><span class=mi>0x31</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>287</span><span class=cl>                    <span class=c1>// Since we haven&#39;t enabled paging yet and we&#39;re using
</span></span></span><span class=line><span class=ln>288</span><span class=cl><span class=c1></span>                    <span class=c1>// an identity segment mapping (see boot.S), we can
</span></span></span><span class=line><span class=ln>289</span><span class=cl><span class=c1></span>                    <span class=c1>// use physical addresses directly.  This won&#39;t be the
</span></span></span><span class=line><span class=ln>290</span><span class=cl><span class=c1></span>                    <span class=c1>// case once JOS enables the MMU.
</span></span></span><span class=line><span class=ln>291</span><span class=cl><span class=c1></span>                    <span class=nf>readsect</span><span class=p>((</span><span class=no>uint8_t</span><span class=p>*)</span> <span class=no>pa</span><span class=p>,</span> <span class=no>offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>292</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cf0:</span>       <span class=err>56</span>                      <span class=nf>push</span>   <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>293</span><span class=cl>                    <span class=nf>pa</span> <span class=err>+=</span> <span class=no>SECTSIZE</span><span class=c1>;
</span></span></span><span class=line><span class=ln>294</span><span class=cl><span class=c1></span>                    <span class=nf>offset</span><span class=err>++</span><span class=c1>;
</span></span></span><span class=line><span class=ln>295</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cf1:</span>       <span class=err>46</span>                      <span class=nf>inc</span>    <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>296</span><span class=cl>            <span class=nf>while</span> <span class=p>(</span><span class=no>pa</span> <span class=err>&lt;</span> <span class=no>end_pa</span><span class=p>)</span> <span class=err>{</span>
</span></span><span class=line><span class=ln>297</span><span class=cl>                    <span class=c1>// Since we haven&#39;t enabled paging yet and we&#39;re using
</span></span></span><span class=line><span class=ln>298</span><span class=cl><span class=c1></span>                    <span class=c1>// an identity segment mapping (see boot.S), we can
</span></span></span><span class=line><span class=ln>299</span><span class=cl><span class=c1></span>                    <span class=c1>// use physical addresses directly.  This won&#39;t be the
</span></span></span><span class=line><span class=ln>300</span><span class=cl><span class=c1></span>                    <span class=c1>// case once JOS enables the MMU.
</span></span></span><span class=line><span class=ln>301</span><span class=cl><span class=c1></span>                    <span class=nf>readsect</span><span class=p>((</span><span class=no>uint8_t</span><span class=p>*)</span> <span class=no>pa</span><span class=p>,</span> <span class=no>offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>302</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cf2:</span>       <span class=err>53</span>                      <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln>303</span><span class=cl>                    <span class=nf>pa</span> <span class=err>+=</span> <span class=no>SECTSIZE</span><span class=c1>;
</span></span></span><span class=line><span class=ln>304</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cf3:</span>       <span class=err>81</span> <span class=nf>c3</span> <span class=mi>00</span> <span class=mi>02</span> <span class=mi>00</span> <span class=mi>00</span>       <span class=no>add</span>    <span class=no>$0x200</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>305</span><span class=cl>            <span class=nf>while</span> <span class=p>(</span><span class=no>pa</span> <span class=err>&lt;</span> <span class=no>end_pa</span><span class=p>)</span> <span class=err>{</span>
</span></span><span class=line><span class=ln>306</span><span class=cl>                    <span class=c1>// Since we haven&#39;t enabled paging yet and we&#39;re using
</span></span></span><span class=line><span class=ln>307</span><span class=cl><span class=c1></span>                    <span class=c1>// an identity segment mapping (see boot.S), we can
</span></span></span><span class=line><span class=ln>308</span><span class=cl><span class=c1></span>                    <span class=c1>// use physical addresses directly.  This won&#39;t be the
</span></span></span><span class=line><span class=ln>309</span><span class=cl><span class=c1></span>                    <span class=c1>// case once JOS enables the MMU.
</span></span></span><span class=line><span class=ln>310</span><span class=cl><span class=c1></span>                    <span class=nf>readsect</span><span class=p>((</span><span class=no>uint8_t</span><span class=p>*)</span> <span class=no>pa</span><span class=p>,</span> <span class=no>offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>311</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cf9:</span>       <span class=nf>e8</span> <span class=mi>7</span><span class=no>e</span> <span class=no>ff</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>call</span>   <span class=mh>7c7c</span> <span class=p>&lt;</span><span class=no>readsect</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>312</span><span class=cl>                    <span class=nf>pa</span> <span class=err>+=</span> <span class=no>SECTSIZE</span><span class=c1>;
</span></span></span><span class=line><span class=ln>313</span><span class=cl><span class=c1></span>                    <span class=nf>offset</span><span class=err>++</span><span class=c1>;
</span></span></span><span class=line><span class=ln>314</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>cfe:</span>       <span class=err>58</span>                      <span class=nf>pop</span>    <span class=no>x</span>
</span></span><span class=line><span class=ln>315</span><span class=cl>        <span class=err>7</span><span class=nl>cff:</span>       <span class=err>5</span><span class=nf>a</span>                      <span class=no>pop</span>    <span class=no>x</span>
</span></span><span class=line><span class=ln>316</span><span class=cl>        <span class=err>7</span><span class=nl>d00:</span>       <span class=nf>eb</span> <span class=no>ea</span>                   <span class=no>jmp</span>    <span class=mh>7cec</span> <span class=p>&lt;</span><span class=no>readseg</span><span class=p>+</span><span class=mi>0x1b</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>317</span><span class=cl>            <span class=err>}</span>
</span></span><span class=line><span class=ln>318</span><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=ln>319</span><span class=cl>        <span class=err>7</span><span class=nl>d02:</span>       <span class=err>8</span><span class=nf>d</span> <span class=mi>65</span> <span class=no>f4</span>                <span class=no>lea</span>    <span class=p>-</span><span class=mi>0xc</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>320</span><span class=cl>        <span class=err>7</span><span class=nl>d05:</span>       <span class=err>5</span><span class=nf>b</span>                      <span class=no>pop</span>    <span class=no>x</span>
</span></span><span class=line><span class=ln>321</span><span class=cl>        <span class=err>7</span><span class=nl>d06:</span>       <span class=err>5</span><span class=nf>e</span>                      <span class=no>pop</span>    <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>322</span><span class=cl>        <span class=err>7</span><span class=nl>d07:</span>       <span class=err>5</span><span class=nf>f</span>                      <span class=no>pop</span>    <span class=no>i</span>
</span></span><span class=line><span class=ln>323</span><span class=cl>        <span class=err>7</span><span class=nl>d08:</span>       <span class=err>5</span><span class=nf>d</span>                      <span class=no>pop</span>    <span class=no>p</span>
</span></span><span class=line><span class=ln>324</span><span class=cl>        <span class=err>7</span><span class=nl>d09:</span>       <span class=nf>c3</span>                      <span class=no>ret</span>    
</span></span><span class=line><span class=ln>325</span><span class=cl>    
</span></span><span class=line><span class=ln>326</span><span class=cl>    <span class=mh>00007d0a</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>&gt;:</span>
</span></span><span class=line><span class=ln>327</span><span class=cl>    <span class=nf>void</span> <span class=no>readsect</span><span class=p>(</span><span class=no>void</span><span class=p>*,</span> <span class=no>uint32_t</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>328</span><span class=cl><span class=c1></span>    <span class=nf>void</span> <span class=no>readseg</span><span class=p>(</span><span class=no>uint32_t</span><span class=p>,</span> <span class=no>uint32_t</span><span class=p>,</span> <span class=no>uint32_t</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>329</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>330</span><span class=cl>    <span class=nf>void</span>
</span></span><span class=line><span class=ln>331</span><span class=cl>    <span class=nf>bootmain</span><span class=p>(</span><span class=no>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln>332</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>333</span><span class=cl>        <span class=err>7</span><span class=nl>d0a:</span>       <span class=err>55</span>                      <span class=nf>push</span>   <span class=no>p</span>
</span></span><span class=line><span class=ln>334</span><span class=cl>        <span class=err>7</span><span class=nl>d0b:</span>       <span class=err>89</span> <span class=nf>e5</span>                   <span class=no>mov</span>    <span class=nv>%esp</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln>335</span><span class=cl>        <span class=err>7</span><span class=nl>d0d:</span>       <span class=err>56</span>                      <span class=nf>push</span>   <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>336</span><span class=cl>        <span class=err>7</span><span class=nl>d0e:</span>       <span class=err>53</span>                      <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln>337</span><span class=cl>            <span class=nf>struct</span> <span class=no>Proghdr</span> <span class=p>*</span><span class=no>ph</span><span class=p>,</span> <span class=p>*</span><span class=no>eph</span><span class=c1>;
</span></span></span><span class=line><span class=ln>338</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>339</span><span class=cl>            <span class=c1>// read 1st page off disk
</span></span></span><span class=line><span class=ln>340</span><span class=cl><span class=c1></span>            <span class=nf>readseg</span><span class=p>((</span><span class=no>uint32_t</span><span class=p>)</span> <span class=no>ELFHDR</span><span class=p>,</span> <span class=no>SECTSIZE</span><span class=p>*</span><span class=mi>8</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>341</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d0f:</span>       <span class=err>6</span><span class=nf>a</span> <span class=mi>00</span>                   <span class=no>push</span>   <span class=no>$0x0</span>
</span></span><span class=line><span class=ln>342</span><span class=cl>        <span class=err>7</span><span class=nl>d11:</span>       <span class=err>68</span> <span class=err>00</span> <span class=err>10</span> <span class=err>00</span> <span class=err>00</span>          <span class=nf>push</span>   <span class=no>$0x1000</span>
</span></span><span class=line><span class=ln>343</span><span class=cl>        <span class=err>7</span><span class=nl>d16:</span>       <span class=err>68</span> <span class=err>00</span> <span class=err>00</span> <span class=err>01</span> <span class=err>00</span>          <span class=nf>push</span>   <span class=no>$0x10000</span>
</span></span><span class=line><span class=ln>344</span><span class=cl>        <span class=err>7</span><span class=nl>d1b:</span>       <span class=nf>e8</span> <span class=no>b1</span> <span class=no>ff</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>call</span>   <span class=mh>7cd1</span> <span class=p>&lt;</span><span class=no>readseg</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>345</span><span class=cl>    
</span></span><span class=line><span class=ln>346</span><span class=cl>            <span class=c1>// is this a valid ELF?
</span></span></span><span class=line><span class=ln>347</span><span class=cl><span class=c1></span>            <span class=nf>if</span> <span class=p>(</span><span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_magic</span> <span class=p>!</span><span class=err>=</span> <span class=no>ELF_MAGIC</span><span class=p>)</span>
</span></span><span class=line><span class=ln>348</span><span class=cl>        <span class=err>7</span><span class=nl>d20:</span>       <span class=err>83</span> <span class=nf>c4</span> <span class=mi>0</span><span class=no>c</span>                <span class=no>add</span>    <span class=no>$0xc</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>349</span><span class=cl>        <span class=err>7</span><span class=nl>d23:</span>       <span class=err>81</span> <span class=err>3</span><span class=nf>d</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>01</span> <span class=mi>00</span> <span class=mi>7</span><span class=no>f</span>    <span class=no>cmpl</span>   <span class=no>$0x464c457f</span><span class=p>,</span><span class=mi>0x10000</span>
</span></span><span class=line><span class=ln>350</span><span class=cl>        <span class=err>7</span><span class=nl>d2a:</span>       <span class=err>45</span> <span class=err>4</span><span class=nf>c</span> <span class=mi>46</span> 
</span></span><span class=line><span class=ln>351</span><span class=cl>        <span class=mi>7</span><span class=no>d2d</span><span class=p>:</span>       <span class=mi>75</span> <span class=mi>38</span>                   <span class=no>jne</span>    <span class=mh>7d67</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>+</span><span class=mi>0x5d</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>352</span><span class=cl>                    <span class=nf>goto</span> <span class=no>bad</span><span class=c1>;
</span></span></span><span class=line><span class=ln>353</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>354</span><span class=cl>            <span class=c1>// load each program segment (ignores ph flags)
</span></span></span><span class=line><span class=ln>355</span><span class=cl><span class=c1></span>            <span class=nf>ph</span> <span class=err>=</span> <span class=p>(</span><span class=no>struct</span> <span class=no>Proghdr</span> <span class=p>*)</span> <span class=p>((</span><span class=no>uint8_t</span> <span class=p>*)</span> <span class=no>ELFHDR</span> <span class=err>+</span> <span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_phoff</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>356</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d2f:</span>       <span class=nf>a1</span> <span class=mi>1</span><span class=no>c</span> <span class=mi>00</span> <span class=mi>01</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=mi>0x1001c</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>357</span><span class=cl>        <span class=err>7</span><span class=nl>d34:</span>       <span class=err>8</span><span class=nf>d</span> <span class=mi>98</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>01</span> <span class=mi>00</span>       <span class=no>lea</span>    <span class=mi>0x10000</span><span class=p>(</span><span class=no>x</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>358</span><span class=cl>            <span class=nf>eph</span> <span class=err>=</span> <span class=no>ph</span> <span class=err>+</span> <span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_phnum</span><span class=c1>;
</span></span></span><span class=line><span class=ln>359</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d3a:</span>       <span class=err>0</span><span class=nf>f</span> <span class=no>b7</span> <span class=mi>05</span> <span class=mi>2</span><span class=no>c</span> <span class=mi>00</span> <span class=mi>01</span> <span class=mi>00</span>    <span class=no>movzwl</span> <span class=mi>0x1002c</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>360</span><span class=cl>        <span class=err>7</span><span class=nl>d41:</span>       <span class=nf>c1</span> <span class=no>e0</span> <span class=mi>05</span>                <span class=no>shl</span>    <span class=no>$0x5</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>361</span><span class=cl>        <span class=err>7</span><span class=nl>d44:</span>       <span class=err>8</span><span class=nf>d</span> <span class=mi>34</span> <span class=mi>03</span>                <span class=no>lea</span>    <span class=p>(</span><span class=no>x</span><span class=p>,</span><span class=no>x</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=nv>%esi</span>
</span></span><span class=line><span class=ln>362</span><span class=cl>            <span class=nf>for</span> <span class=p>(</span><span class=c1>; ph &lt; eph; ph++)
</span></span></span><span class=line><span class=ln>363</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d47:</span>       <span class=err>39</span> <span class=nf>f3</span>                   <span class=no>cmp</span>    <span class=nv>%esi</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>364</span><span class=cl>        <span class=err>7</span><span class=nl>d49:</span>       <span class=err>73</span> <span class=err>16</span>                   <span class=nf>jae</span>    <span class=mh>7d61</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>+</span><span class=mi>0x57</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>365</span><span class=cl>                    <span class=c1>// p_pa is the load address of this segment (as well
</span></span></span><span class=line><span class=ln>366</span><span class=cl><span class=c1></span>                    <span class=c1>// as the physical address)
</span></span></span><span class=line><span class=ln>367</span><span class=cl><span class=c1></span>                    <span class=nf>readseg</span><span class=p>(</span><span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_pa</span><span class=p>,</span> <span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_memsz</span><span class=p>,</span> <span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>368</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d4b:</span>       <span class=nf>ff</span> <span class=mi>73</span> <span class=mi>04</span>                <span class=no>pushl</span>  <span class=mi>0x4</span><span class=p>(</span><span class=no>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln>369</span><span class=cl>                    <span class=nf>goto</span> <span class=no>bad</span><span class=c1>;
</span></span></span><span class=line><span class=ln>370</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>371</span><span class=cl>            <span class=c1>// load each program segment (ignores ph flags)
</span></span></span><span class=line><span class=ln>372</span><span class=cl><span class=c1></span>            <span class=nf>ph</span> <span class=err>=</span> <span class=p>(</span><span class=no>struct</span> <span class=no>Proghdr</span> <span class=p>*)</span> <span class=p>((</span><span class=no>uint8_t</span> <span class=p>*)</span> <span class=no>ELFHDR</span> <span class=err>+</span> <span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_phoff</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>373</span><span class=cl><span class=c1></span>            <span class=nf>eph</span> <span class=err>=</span> <span class=no>ph</span> <span class=err>+</span> <span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_phnum</span><span class=c1>;
</span></span></span><span class=line><span class=ln>374</span><span class=cl><span class=c1></span>            <span class=nf>for</span> <span class=p>(</span><span class=c1>; ph &lt; eph; ph++)
</span></span></span><span class=line><span class=ln>375</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d4e:</span>       <span class=err>83</span> <span class=nf>c3</span> <span class=mi>20</span>                <span class=no>add</span>    <span class=no>$0x20</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>376</span><span class=cl>                    <span class=c1>// p_pa is the load address of this segment (as well
</span></span></span><span class=line><span class=ln>377</span><span class=cl><span class=c1></span>                    <span class=c1>// as the physical address)
</span></span></span><span class=line><span class=ln>378</span><span class=cl><span class=c1></span>                    <span class=nf>readseg</span><span class=p>(</span><span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_pa</span><span class=p>,</span> <span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_memsz</span><span class=p>,</span> <span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>379</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d51:</span>       <span class=nf>ff</span> <span class=mi>73</span> <span class=no>f4</span>                <span class=no>pushl</span>  <span class=p>-</span><span class=mi>0xc</span><span class=p>(</span><span class=no>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln>380</span><span class=cl>        <span class=err>7</span><span class=nl>d54:</span>       <span class=nf>ff</span> <span class=mi>73</span> <span class=no>ec</span>                <span class=no>pushl</span>  <span class=p>-</span><span class=mi>0x14</span><span class=p>(</span><span class=no>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln>381</span><span class=cl>        <span class=err>7</span><span class=nl>d57:</span>       <span class=nf>e8</span> <span class=mi>75</span> <span class=no>ff</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>call</span>   <span class=mh>7cd1</span> <span class=p>&lt;</span><span class=no>readseg</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>382</span><span class=cl>                    <span class=nf>goto</span> <span class=no>bad</span><span class=c1>;
</span></span></span><span class=line><span class=ln>383</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>384</span><span class=cl>            <span class=c1>// load each program segment (ignores ph flags)
</span></span></span><span class=line><span class=ln>385</span><span class=cl><span class=c1></span>            <span class=nf>ph</span> <span class=err>=</span> <span class=p>(</span><span class=no>struct</span> <span class=no>Proghdr</span> <span class=p>*)</span> <span class=p>((</span><span class=no>uint8_t</span> <span class=p>*)</span> <span class=no>ELFHDR</span> <span class=err>+</span> <span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_phoff</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>386</span><span class=cl><span class=c1></span>            <span class=nf>eph</span> <span class=err>=</span> <span class=no>ph</span> <span class=err>+</span> <span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_phnum</span><span class=c1>;
</span></span></span><span class=line><span class=ln>387</span><span class=cl><span class=c1></span>            <span class=nf>for</span> <span class=p>(</span><span class=c1>; ph &lt; eph; ph++)
</span></span></span><span class=line><span class=ln>388</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d5c:</span>       <span class=err>83</span> <span class=nf>c4</span> <span class=mi>0</span><span class=no>c</span>                <span class=no>add</span>    <span class=no>$0xc</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>389</span><span class=cl>        <span class=err>7</span><span class=nl>d5f:</span>       <span class=nf>eb</span> <span class=no>e6</span>                   <span class=no>jmp</span>    <span class=mh>7d47</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>+</span><span class=mi>0x3d</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>390</span><span class=cl>                    <span class=c1>// as the physical address)
</span></span></span><span class=line><span class=ln>391</span><span class=cl><span class=c1></span>                    <span class=nf>readseg</span><span class=p>(</span><span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_pa</span><span class=p>,</span> <span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_memsz</span><span class=p>,</span> <span class=no>ph-</span><span class=err>&gt;</span><span class=no>p_offset</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>392</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>393</span><span class=cl>            <span class=c1>// call the entry point from the ELF header
</span></span></span><span class=line><span class=ln>394</span><span class=cl><span class=c1></span>            <span class=c1>// note: does not return!
</span></span></span><span class=line><span class=ln>395</span><span class=cl><span class=c1></span>            <span class=err>((</span><span class=nf>void</span> <span class=p>(*)(</span><span class=no>void</span><span class=p>))</span> <span class=p>(</span><span class=no>ELFHDR-</span><span class=err>&gt;</span><span class=no>e_entry</span><span class=p>))()</span><span class=c1>;
</span></span></span><span class=line><span class=ln>396</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d61:</span>       <span class=nf>ff</span> <span class=mi>15</span> <span class=mi>18</span> <span class=mi>00</span> <span class=mi>01</span> <span class=mi>00</span>       <span class=no>call</span>   <span class=p>*</span><span class=mi>0x10018</span>
</span></span><span class=line><span class=ln>397</span><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=ln>398</span><span class=cl>    
</span></span><span class=line><span class=ln>399</span><span class=cl>    <span class=nf>static</span> <span class=no>inline</span> <span class=no>void</span>
</span></span><span class=line><span class=ln>400</span><span class=cl>    <span class=nf>outw</span><span class=p>(</span><span class=no>int</span> <span class=no>port</span><span class=p>,</span> <span class=no>uint16_t</span> <span class=no>data</span><span class=p>)</span>
</span></span><span class=line><span class=ln>401</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln>402</span><span class=cl>            <span class=nf>asm</span> <span class=no>volatile</span><span class=p>(</span><span class=err>&#34;</span><span class=no>outw</span> <span class=err>%</span><span class=mi>0</span><span class=p>,</span><span class=nv>%w1</span><span class=err>&#34;</span> <span class=p>:</span> <span class=p>:</span> <span class=err>&#34;</span><span class=no>a</span><span class=err>&#34;</span> <span class=p>(</span><span class=no>data</span><span class=p>),</span> <span class=err>&#34;</span><span class=no>d</span><span class=err>&#34;</span> <span class=p>(</span><span class=no>port</span><span class=p>))</span><span class=c1>;
</span></span></span><span class=line><span class=ln>403</span><span class=cl><span class=c1></span>        <span class=err>7</span><span class=nl>d67:</span>       <span class=nf>ba</span> <span class=mi>00</span> <span class=mi>8</span><span class=no>a</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x8a00</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>404</span><span class=cl>        <span class=err>7</span><span class=nl>d6c:</span>       <span class=nf>b8</span> <span class=mi>00</span> <span class=mi>8</span><span class=no>a</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>mov</span>    <span class=no>$0xffff8a00</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>405</span><span class=cl>        <span class=err>7</span><span class=nl>d71:</span>       <span class=err>66</span> <span class=nf>ef</span>                   <span class=no>out</span>    <span class=nv>%ax</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>406</span><span class=cl>        <span class=err>7</span><span class=nl>d73:</span>       <span class=nf>b8</span> <span class=mi>00</span> <span class=mi>8</span><span class=no>e</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>mov</span>    <span class=no>$0xffff8e00</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>407</span><span class=cl>        <span class=err>7</span><span class=nl>d78:</span>       <span class=err>66</span> <span class=nf>ef</span>                   <span class=no>out</span>    <span class=nv>%ax</span><span class=p>,(</span><span class=nv>%dx</span><span class=p>)</span>
</span></span><span class=line><span class=ln>408</span><span class=cl>        <span class=err>7</span><span class=nl>d7a:</span>       <span class=nf>eb</span> <span class=no>fe</span>                   <span class=no>jmp</span>    <span class=mh>7d7a</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>+</span><span class=mi>0x70</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>409</span><span class=cl>    
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ä»£ç æ˜¯ä»0x7c00å¼€å§‹æ‰§è¡Œçš„ï¼Œè€Œç”¨gdbè°ƒè¯•å‘ç°BIOSæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®å…¶å®æ˜¯åœ¨0xf000:0xfff0ã€€ã€€é‚£ä¹ˆé—®é¢˜æ¥äº†&mldr;CSæ®µæ˜¯ä»€ä¹ˆæ—¶å€™ä»0xf000åˆ°0çš„å‘¢ï¼Ÿã€€åœ¨0x7c00ä¹‹å‰ï¼ŒBIOSæ˜¯åœ¨åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç”¨gdbçœ‹ä¸€ä¸‹è¿™ä¸€éƒ¨åˆ†çš„ä»£ç :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln> 1</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>fff0</span><span class=p>]</span>    <span class=mi>0xffff0</span><span class=p>:</span> <span class=no>ljmp</span>   <span class=no>$0xf000</span><span class=p>,</span><span class=no>$0xe05b</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e05b</span><span class=p>]</span>    <span class=mi>0xfe05b</span><span class=p>:</span> <span class=no>cmpl</span>   <span class=no>$0x0</span><span class=p>,</span><span class=nv>%cs</span><span class=p>:</span><span class=mi>0x6ac8</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e062</span><span class=p>]</span>    <span class=mi>0xfe062</span><span class=p>:</span> <span class=no>jne</span>    <span class=mi>0xfd2e1</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e066</span><span class=p>]</span>    <span class=mi>0xfe066</span><span class=p>:</span> <span class=no>xor</span>    <span class=nv>%dx</span><span class=p>,</span><span class=nv>%dx</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e068</span><span class=p>]</span>    <span class=mi>0xfe068</span><span class=p>:</span> <span class=no>mov</span>    <span class=nv>%dx</span><span class=p>,</span><span class=nv>%ss</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e06a</span><span class=p>]</span>    <span class=mi>0xfe06a</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>$0x7000</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e070</span><span class=p>]</span>    <span class=mi>0xfe070</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>$0xf34c2</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>e076</span><span class=p>]</span>    <span class=mi>0xfe076</span><span class=p>:</span> <span class=no>jmp</span>    <span class=mi>0xfd15c</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d15c</span><span class=p>]</span>    <span class=mi>0xfd15c</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d15f</span><span class=p>]</span>    <span class=mi>0xfd15f</span><span class=p>:</span> <span class=no>cli</span>  
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=p>[</span><span class=no>f000</span><span class=p>:</span><span class=no>d160</span><span class=p>]</span>    <span class=mi>0xfd160</span><span class=p>:</span> <span class=no>cld</span> 
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>[</span><span class=no>f000</span><span class=p>:</span><span class=no>d161</span><span class=p>]</span>    <span class=mi>0xfd161</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>$0x8f</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d167</span><span class=p>]</span>    <span class=mi>0xfd167</span><span class=p>:</span> <span class=no>out</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x70</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d169</span><span class=p>]</span>    <span class=mi>0xfd169</span><span class=p>:</span> <span class=no>in</span>     <span class=no>$0x71</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d16b</span><span class=p>]</span>    <span class=mi>0xfd16b</span><span class=p>:</span> <span class=no>in</span>     <span class=no>$0x92</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d16d</span><span class=p>]</span>    <span class=mi>0xfd16d</span><span class=p>:</span> <span class=no>or</span>     <span class=no>$0x2</span><span class=p>,</span><span class=nv>%al</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d16f</span><span class=p>]</span>    <span class=mi>0xfd16f</span><span class=p>:</span> <span class=no>out</span>    <span class=nv>%al</span><span class=p>,</span><span class=no>$0x92</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d171</span><span class=p>]</span>    <span class=mi>0xfd171</span><span class=p>:</span> <span class=no>lidtw</span>  <span class=nv>%cs</span><span class=p>:</span><span class=mi>0x6ab8</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d177</span><span class=p>]</span>    <span class=mi>0xfd177</span><span class=p>:</span> <span class=no>lgdtw</span>  <span class=nv>%cs</span><span class=p>:</span><span class=mi>0x6a74</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d17d</span><span class=p>]</span>    <span class=mi>0xfd17d</span><span class=p>:</span> <span class=no>mov</span>    <span class=nv>%cr0</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d180</span><span class=p>]</span>    <span class=mi>0xfd180</span><span class=p>:</span> <span class=no>or</span>     <span class=no>$0x1</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d184</span><span class=p>]</span>    <span class=mi>0xfd184</span><span class=p>:</span> <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%cr0</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=err>[</span><span class=nl>f000:</span><span class=nf>d187</span><span class=p>]</span>    <span class=mi>0xfd187</span><span class=p>:</span> <span class=no>ljmpl</span>  <span class=no>$0x8</span><span class=p>,</span><span class=no>$0xfd18f</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nf>The</span> <span class=no>target</span> <span class=no>architecture</span> <span class=no>is</span> <span class=no>assumed</span> <span class=no>to</span> <span class=no>be</span> <span class=no>i386</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=err>0</span><span class=nl>xfd18f:</span>     <span class=nf>mov</span>    <span class=no>$0x10</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=err>0</span><span class=nl>xfd194:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ds</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>    <span class=err>0</span><span class=nl>xfd196:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%es</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=err>0</span><span class=nl>xfd198:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ss</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=err>0</span><span class=nl>xfd19a:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%fs</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=err>0</span><span class=nl>xfd19c:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%gs</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=err>0</span><span class=nl>xfd19e:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=err>0</span><span class=nl>xfd1a0:</span>     <span class=nf>jmp</span>    <span class=p>*</span><span class=no>x</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=err>0</span><span class=nl>xf34c2:</span>     <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=err>0</span><span class=nl>xf34c3:</span>     <span class=nf>sub</span>    <span class=no>$0x2c</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=err>0</span><span class=nl>xf34c6:</span>     <span class=nf>movl</span>   <span class=no>$0xf5b5c</span><span class=p>,</span><span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>    <span class=err>0</span><span class=nl>xf34ce:</span>     <span class=nf>movl</span>   <span class=no>$0xf447b</span><span class=p>,(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>    <span class=err>0</span><span class=nl>xf34d5:</span>     <span class=nf>call</span>   <span class=mi>0xf099e</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=err>0</span><span class=nl>xf099e:</span>     <span class=nf>lea</span>    <span class=mi>0x8</span><span class=p>(</span><span class=nv>%esp</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=err>0</span><span class=nl>xf09a2:</span>     <span class=nf>mov</span>    <span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=err>0</span><span class=nl>xf09a6:</span>     <span class=nf>mov</span>    <span class=no>$0xf5b58</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=err>0</span><span class=nl>xf09ab:</span>     <span class=nf>call</span>   <span class=mi>0xf0574</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>    <span class=err>0</span><span class=nl>xf0574:</span>     <span class=nf>push</span>   <span class=no>p</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=err>0</span><span class=nl>xf0575:</span>     <span class=nf>push</span>   <span class=no>i</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=err>0</span><span class=nl>xf0576:</span>     <span class=nf>push</span>   <span class=nv>%esi</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=err>0</span><span class=nl>xf0577:</span>     <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=err>0</span><span class=nl>xf0578:</span>     <span class=nf>sub</span>    <span class=no>$0xc</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    <span class=err>0</span><span class=nl>xf057b:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>    <span class=err>0</span><span class=nl>xf057f:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>    <span class=err>0</span><span class=nl>xf0581:</span>     <span class=nf>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%esi</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>    <span class=err>0</span><span class=nl>xf0583:</span>     <span class=nf>movsbl</span> <span class=mi>0x0</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>    <span class=err>0</span><span class=nl>xf0587:</span>     <span class=nf>test</span>   <span class=nv>%dl</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>    <span class=err>0</span><span class=nl>xf0589:</span>     <span class=nf>je</span>     <span class=mi>0xf0758</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>    <span class=err>0</span><span class=nl>xf058f:</span>     <span class=nf>cmp</span>    <span class=no>$0x25</span><span class=p>,</span><span class=nv>%dl</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=err>0</span><span class=nl>xf0592:</span>     <span class=nf>jne</span>    <span class=mi>0xf0741</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>    <span class=err>0</span><span class=nl>xf0741:</span>     <span class=nf>mov</span>    <span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>    
</span></span><span class=line><span class=ln>58</span><span class=cl>    
</span></span></code></pre></div><p>å…¶ä¸­çš„lidtwæ˜¯åŠ è½½å‘é‡æè¿°è¡¨(load interrupt descriptor table), lgdtwæ˜¯åŠ è½½å…¨å±€æè¿°è¡¨(global descriptor table,GDT) å¯ä»¥å‚è€ƒ<a href=https://www.fermimn.edu.it/linux/quarta/x86/lgdt.htm> LGDT/LIDT &ndash; Load Global/Interrupt Descriptor Table Register</a></p><p>ç¬¬16,17è¡Œçš„0x70,0x71å¯ä»¥å‚è€ƒ<a href=https://wiki.osdev.org/CMOS#Accessing_CMOS_Registers>CMOS#Accessing_CMOS_Registers</a>ï¼Œè™½ç„¶æˆ‘è§‰å¾—è¿™å¤ªç»†èŠ‚äº†ï¼Œä¸çœ‹ä¹Ÿç½¢ã€‚</p><p>18-20è¡Œçš„å†…å®¹ï¼Œæ˜¯å¿«é€Ÿenbale A20çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ<a href=https://wiki.osdev.org/A20_Line>A20_Line</a></p><p>ç„¶åç¬¬21-26è¡Œ&mldr;ä¼¼æ›¾ç›¸è¯†å•Š..è¿™ä¸å°±æ˜¯å¯åŠ¨protected modeçš„æ­¥éª¤å—&mldr;</p><p>å¯æ˜¯è¿™è¿˜æ²¡æœ‰åŠ è½½boot loaderå•Š..æ€ä¹ˆå°±è¿›å…¥protected modeäº†å‘¢ã€‚ã€‚å‚è€ƒ<a href=https://stackoverflow.com/questions/5211541/bootloader-switching-processor-to-protected-mode>bootloader - switching processor to protected mode</a>ï¼Œå‘ç°æœ‰äº›BIOSåœ¨å®ç°çš„æ—¶å€™ï¼Œä¼šåœ¨åŠ è½½boot loaderä¹‹å‰ï¼Œå…ˆçŸ­æš‚è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œç›®çš„å¯èƒ½æ˜¯ä¸ºäº†ä½¿ç”¨åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹çš„ä¸€äº›ç‰¹æ€§(æ¯”å¦‚32-bitçš„register)ï¼Œç„¶ååœ¨è¿›å…¥bootloaderä¹‹å‰ï¼Œå†åˆ‡æ¢å›å®æ¨¡å¼ã€‚ ä»¥åŠæ®æŸ6.828å­¦ä¹ ç¾¤å¤§ä½¬è¯´&mldr;åœ¨è¿›å…¥boot loaderä¹‹å‰è¿›å…¥ä¿æŠ¤æ¨¡å¼çš„æ–¹æ³•å’Œboot loaderä¸­è¿›å…¥ä¿æŠ¤æ¨¡å¼çš„æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„&mldr;è¿›å…¥ä¿æŠ¤æ¨¡å¼çš„æ–¹æ³•ä¸€å…±æœ‰å››ç§&mldr; æ„Ÿè§‰å¤ªè¿‡ç»†èŠ‚ï¼Œæš‚ä¸”ä¸å»å…³å¿ƒäº†ã€‚</p><p>ç¬¬26è¡Œä¹‹åçš„ä»£ç &mldr;æŠ±æ­‰æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚&mldr;çœ‹èµ·æ¥æ— å…³ç´§è¦ï¼Œå¦‚æœä¹‹åå‘ç°è¿™æ®µæ˜¯é‡è¦çš„å†è¯´ã€‚</p><p>æ¥å›ç­”ä¸€ä¸‹å‡ ä¸ªé—®é¢˜å§ã€‚</p><blockquote><pre><code>  * At what point does the processor start executing 32-bit code? What exactly causes the switch from 16- to 32-bit mode?
</code></pre></blockquote><p>å¼€å§‹æ‰§è¡Œ32-bit codeæ˜¯ä»ä½ç½®0x7c32,æ‰§è¡Œçš„å‘½ä»¤ä¸ºmov Â Â Â $0x10,%ax
ä»16-bit modeè½¬åŒ–åˆ°32-bit modeæ˜¯å°†control register 0 çš„ ç¬¬1ä½(PE)è®¾ç½®ä¸º1å¯¼è‡´çš„ã€‚</p><blockquote><pre><code>  * What is theÂ _last_Â instruction of the boot loader executed, and what is theÂ _first_Â instruction of the kernel it just loaded?
</code></pre></blockquote><p>boot loaderæ‰§è¡Œçš„æœ€åä¸€æ¡æŒ‡ä»¤æ˜¯0x7d61: Â Â Â Â Â call Â Â <em>0x10018Â  ,å¯¹åº”çš„cè¯­è¨€ä»£ç æ˜¯Â ((void (</em>)(void)) (ELFHDR->e_entry))();Â  Â kernelåŠ è½½åæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä¸ºÂ movw Â Â $0x1234,0x472</p><blockquote><pre><code>  * _Where_Â is the first instruction of the kernel?
</code></pre></blockquote><p>kernelçš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ä¸º0x10000c</p><blockquote><pre><code>  * How does the boot loader decide how many sectors it must read in order to fetch the entire kernel from disk? Where does it find this information?
</code></pre></blockquote><p>boot loaderå…ˆè¯»ä¸€å°éƒ¨åˆ†kernelï¼Œå…·ä½“æ¥è¯´æ˜¯8ä¸ªsectorï¼Œä¹Ÿå°±æ˜¯1 page,å¯¹åº”çš„ä»£ç ä¸ºÂ readseg((uint32_t) ELFHDR, SECTSIZE*8, 0); ç„¶åè¯»è¿›æ¥çš„è¿™éƒ¨åˆ†é‡Œé¢åŒ…å«äº†æ•´ä¸ªkernelæœ‰å¤šå¤§çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨inc/elf.hæ–‡ä»¶ä¸­ã€‚</p><h3 id=loading-the-kernel>Loading the Kernel</h3><p>ç»ƒä¹ 4æåˆ°äº†è¦ç†Ÿæ‚‰cè¯­è¨€çš„æŒ‡é’ˆ..å»çœ‹äº†ä¸‹æ¨èçš„"<em>The C Programming Language</em>Â &ldquo;..å‘ç°çœŸæ˜¯ä¸€æœ¬éå¸¸æ£’çš„å…¥é—¨ä¹¦&mldr;ä¹‹å‰è¿˜ä»¥ä¸ºæ˜¯åƒã€Šç®—æ³•å¯¼è®ºã€‹ä¸€æ ·åªå¯è¿œè§‚çš„å¤§éƒ¨å¤´&mldr;å¯æƒœå·²ç»ä¸é€‚åˆå­¦è€…äº†&mldr; ç»ƒä¹ 4ä¸­ç»™å‡ºäº†ä¸€æ®µä½¿ç”¨cè¯­è¨€æŒ‡é’ˆçš„ä»£ç ï¼Œç¬¬5ä¸ªè¾“å‡ºè¦æ³¨æ„ä¸€ä¸‹å¤§å°ç«¯&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>    <span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp></span>    <span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cp></span>    
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=kt>void</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nf>f</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>        <span class=kt>int</span> <span class=o>*</span><span class=n>b</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=kt>int</span> <span class=o>*</span><span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;1: a = %p, b = %p, c = %p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    	<span class=n>a</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>100</span> <span class=o>+</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;2: a[0] = %d, a[1] = %d, a[2] = %d, a[3] = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    	   <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>300</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>        <span class=o>*</span><span class=p>(</span><span class=n>c</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span> <span class=o>=</span> <span class=mi>301</span><span class=p>;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=mi>3</span><span class=p>[</span><span class=n>c</span><span class=p>]</span> <span class=o>=</span> <span class=mi>302</span><span class=p>;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;3: a[0] = %d, a[1] = %d, a[2] = %d, a[3] = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    	   <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>    
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=n>c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=o>*</span><span class=n>c</span> <span class=o>=</span> <span class=mi>400</span><span class=p>;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;4: a[0] = %d, a[1] = %d, a[2] = %d, a[3] = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    	   <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    
</span></span><span class=line><span class=ln>32</span><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span> <span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span> <span class=n>c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=o>*</span><span class=n>c</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;5: a[0] = %d, a[1] = %d, a[2] = %d, a[3] = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>    	   <span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>a</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    
</span></span><span class=line><span class=ln>37</span><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span> <span class=n>a</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span> <span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span> <span class=n>a</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;6: a = %p, b = %p, c = %p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>    
</span></span><span class=line><span class=ln>42</span><span class=cl>    <span class=kt>int</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>    <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>ac</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>av</span><span class=p>)</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=nf>f</span><span class=p>();</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>    
</span></span></code></pre></div><p>åœ¨ç»§ç»­ä¹‹å‰ï¼Œéœ€è¦ä»”ç»†çœ‹ä¸€ä¸‹elfæ–‡ä»¶çš„å†…å®¹<a href=https://wiki.osdev.org/ELF>ELF</a></p><h3 id=elfæ–‡ä»¶>ELFæ–‡ä»¶</h3><p>elfæ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šä¸ªsection,é€šå¸¸.data sectionå­˜æ”¾åˆå§‹åŒ–çš„global/static variable,.text å­˜æ”¾ä»£ç ï¼Œ.rodata section ç”¨æ¥å­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡ï¼Œ.bss sectionç”¨æ¥å­˜æ”¾æœªåˆå§‹åŒ–çš„global/static variabel.Â  .bss sectionæ²¡æœ‰å¯¹åº”çš„å˜é‡å†…å®¹ï¼ŒåŸå› æ˜¯æœªåˆå§‹åŒ–çš„å˜é‡æŒ‰ç…§è§„å®šä¼šé»˜è®¤ä¸º0ï¼Œå› æ­¤æ²¡å¿…è¦å†å­˜ä¸€æ¬¡ã€‚â€œThus there is no need to store contents forÂ .bssÂ in the ELF binary; instead, the linker records just the address and size of theÂ .bssÂ section. The loader or the program itself must arrange to zero the.bssÂ section.â€</p><p>æˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒçš„æ˜¯.data section, .text section, .rodata section</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ objdump -h å‘½ä»¤æŸ¥çœ‹ä¸€ä¸ªELFæ–‡ä»¶çš„ section header,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln> 1</span><span class=cl>    <span class=nf>objdump</span> <span class=p>-</span><span class=no>h</span> <span class=no>obj</span><span class=err>/</span><span class=no>kern</span><span class=err>/</span><span class=no>kernel</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nf>obj</span><span class=err>/</span><span class=no>kern</span><span class=err>/</span><span class=no>kernel</span><span class=p>:</span>     <span class=no>file</span> <span class=no>format</span> <span class=no>elf32-i386</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nl>Sections:</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nf>Idx</span> <span class=no>Name</span>          <span class=no>Size</span>      <span class=no>VMA</span>       <span class=no>LMA</span>       <span class=no>File</span> <span class=no>off</span>  <span class=no>Algn</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>      <span class=err>0</span> <span class=na>.text</span>         <span class=mi>00001917</span>  <span class=no>f0100000</span>  <span class=mi>00100000</span>  <span class=mi>00001000</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>4</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>ALLOC</span><span class=p>,</span> <span class=no>LOAD</span><span class=p>,</span> <span class=no>READONLY</span><span class=p>,</span> <span class=no>CODE</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=err>1</span> <span class=na>.rodata</span>       <span class=mi>00000714</span>  <span class=no>f0101920</span>  <span class=mi>00101920</span>  <span class=mi>00002920</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>5</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>ALLOC</span><span class=p>,</span> <span class=no>LOAD</span><span class=p>,</span> <span class=no>READONLY</span><span class=p>,</span> <span class=no>DATA</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>      <span class=err>2</span> <span class=na>.stab</span>         <span class=mi>00003889</span>  <span class=no>f0102034</span>  <span class=mi>00102034</span>  <span class=mi>00003034</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>2</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>ALLOC</span><span class=p>,</span> <span class=no>LOAD</span><span class=p>,</span> <span class=no>READONLY</span><span class=p>,</span> <span class=no>DATA</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>      <span class=err>3</span> <span class=na>.stabstr</span>      <span class=mi>000018</span><span class=no>af</span>  <span class=no>f01058bd</span>  <span class=mi>001058</span><span class=no>bd</span>  <span class=mi>000068</span><span class=no>bd</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>0</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>ALLOC</span><span class=p>,</span> <span class=no>LOAD</span><span class=p>,</span> <span class=no>READONLY</span><span class=p>,</span> <span class=no>DATA</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>      <span class=err>4</span> <span class=na>.data</span>         <span class=mi>0000</span><span class=no>a300</span>  <span class=no>f0108000</span>  <span class=mi>00108000</span>  <span class=mi>00009000</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>12</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>ALLOC</span><span class=p>,</span> <span class=no>LOAD</span><span class=p>,</span> <span class=no>DATA</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>      <span class=err>5</span> <span class=na>.bss</span>          <span class=mi>00000648</span>  <span class=no>f0112300</span>  <span class=mi>00112300</span>  <span class=mi>00013300</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>5</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>ALLOC</span><span class=p>,</span> <span class=no>LOAD</span><span class=p>,</span> <span class=no>DATA</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=err>6</span> <span class=na>.comment</span>      <span class=mi>00000023</span>  <span class=mi>00000000</span>  <span class=mi>00000000</span>  <span class=mi>00013948</span>  <span class=mi>2</span><span class=p>**</span><span class=mi>0</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                      <span class=nf>CONTENTS</span><span class=p>,</span> <span class=no>READONLY</span>
</span></span></code></pre></div><p>å…¶ä¸­sizeæ˜¯è¿™ä¸ªsectionçš„å¤§å°ï¼ŒVMA (Virtual Memory Addressï¼Œ6.828ä¸­å«link address) æ˜¯sectionå¼€å§‹æ‰§è¡Œæ—¶æ‰€åœ¨çš„memory address,LMA (Load Memory Address)æ˜¯è¿™ä¸ªsectionè¢«åŠ è½½åˆ°memoryä¸­æ‰€å¤„çš„ä½ç½®ã€‚é€šå¸¸è¿™ä¸¤ä¸ªåœ°å€æ˜¯ä¸€æ ·çš„ã€‚</p><p>boot loaderä½¿ç”¨elfæ–‡ä»¶ä¸­çš„program headeræ¥å†³å®šå¦‚ä½•è®°è½½section, program headeræŒ‡æ˜äº†ELFæ–‡ä»¶çš„å“ªä¸€éƒ¨åˆ†éœ€è¦è®°è½½åˆ°memoryä¸­ï¼Œä»¥åŠåŠ è½½åˆ°memoryçš„ä»€ä¹ˆä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥ç”¨bjdump -x obj/kern/kernelæŸ¥çœ‹ELFçš„å…¨éƒ¨headeræ–‡ä»¶</p><blockquote>ç»ƒä¹ 5 Trace through the first few instructions of the boot loader again and identify the first instruction that would "break" or otherwise do the wrong thing if you were to get the boot loader's link address wrong. Then change the link address inÂ boot/MakefragÂ to something wrong, runÂ make clean, recompile the lab withÂ make, and trace into the boot loader again to see what happens. Don't forget to change the link address back andÂ make cleanÂ again afterward!</blockquote><p>æŠŠboot loaderçš„link addressä»0x7c00æ”¹æˆäº†0x9c00&mldr; ç„¶åè¿›å…¥gdbå•æ­¥è°ƒè¯•ã€‚</p><p>å‘ç°lgdtwçš„å‚æ•°å‡ºç°äº†è´Ÿæ•°Â [ 0:7c1e] = 0x7c1e: lgdtw -0x639cÂ  ï¼Œç„¶åç»§ç»­æ‰§è¡Œï¼Œåˆ°[ 0:7c2d] = 0x7c2d: ljmp $0x8,$0x9c32Â  ,å‘ç”Ÿäº†crash.</p><p>æˆ‘ä»¬è§‚å¯Ÿåˆ°ç”Ÿæˆçš„boot.asmæ–‡ä»¶ï¼Œåœ°å€ç¡®å®æ˜¯ä»0x9c00å¼€å§‹äº†ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln> 1</span><span class=cl>    <span class=nl>protcseg:</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>      <span class=c1># Set up the protected-mode data segment registers
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>      <span class=nf>movw</span>    <span class=no>$PROT_MODE_DSEG</span><span class=p>,</span> <span class=nv>%ax</span>    <span class=c1># Our data segment selector
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>        <span class=err>9</span><span class=nl>c32:</span>       <span class=err>66</span> <span class=nf>b8</span> <span class=mi>10</span> <span class=mi>00</span>             <span class=no>mov</span>    <span class=no>$0x10</span><span class=p>,</span><span class=nv>%ax</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%ds</span>                <span class=c1># - DS: Data Segment
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>        <span class=err>9</span><span class=nl>c36:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>d8</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ds</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%es</span>                <span class=c1># - ES: Extra Segment
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>        <span class=err>9</span><span class=nl>c38:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>c0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%es</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%fs</span>                <span class=c1># - FS
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>        <span class=err>9</span><span class=nl>c3a:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>e0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%fs</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%gs</span>                <span class=c1># - GS
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>        <span class=err>9</span><span class=nl>c3c:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>e8</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%gs</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>      <span class=nf>movw</span>    <span class=nv>%ax</span><span class=p>,</span> <span class=nv>%ss</span>                <span class=c1># - SS: Stack Segment
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span>        <span class=err>9</span><span class=nl>c3e:</span>       <span class=err>8</span><span class=nf>e</span> <span class=no>d0</span>                   <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=nv>%ss</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    
</span></span><span class=line><span class=ln>16</span><span class=cl>      <span class=c1># Set up the stack pointer and call into C.
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>      <span class=nf>movl</span>    <span class=no>$start</span><span class=p>,</span> <span class=nv>%esp</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=err>9</span><span class=nl>c40:</span>       <span class=nf>bc</span> <span class=mi>00</span> <span class=mi>9</span><span class=no>c</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x9c00</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=nf>call</span> <span class=no>bootmain</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>        <span class=err>9</span><span class=nl>c45:</span>       <span class=nf>e8</span> <span class=no>c0</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>call</span>   <span class=mh>9d0a</span> <span class=p>&lt;</span><span class=no>bootmain</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=err>00009</span><span class=nf>c4a</span> <span class=err>&lt;</span><span class=no>spin</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    
</span></span><span class=line><span class=ln>24</span><span class=cl>      <span class=c1># If bootmain returns (it shouldn&#39;t), loop.
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>    <span class=nl>spin:</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>      <span class=nf>jmp</span> <span class=no>spin</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>        <span class=err>9</span><span class=nl>c4a:</span>       <span class=nf>eb</span> <span class=no>fe</span>                   <span class=no>jmp</span>    <span class=mh>9c4a</span> <span class=p>&lt;</span><span class=no>spin</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>ä½†æ˜¯å®é™…ä¸Šã€‚ã€‚BIOSä»ç„¶æŠŠboot loaderè®°è½½åˆ°äº†0x7c00&mldr;.è¿™æ˜¯çº¦å®šä¿—æˆå—ï¼Ÿ BIOSæ— è§†Boot loaderçš„link addressï¼Œç›´æ¥åŠ è½½åˆ°0x7c00?Â  Â æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œæœ‰å¾…è¿›ä¸€æ­¥æ¢å¯»ã€‚</p><blockquote>ç»ƒä¹ 6 Reset the machine (exit QEMU/GDB and start them again). Examine the 8 words of memory at 0x00100000 at the point the BIOS enters the boot loader, and then again at the point the boot loader enters the kernel. Why are they different? What is there at the second breakpoint? (You do not really need to use QEMU to answer this question. Just think.)</blockquote><p>è¿™ä¸ªé—®é¢˜æ˜¯é—®ï¼ŒBIOSè¿›å…¥boot loaderæ—¶ï¼ˆä¹Ÿå°±æ˜¯åœ¨0x7c00æ—¶ï¼‰å’Œboot loaderè¿›å…¥kernelæ—¶(0x10000c)ï¼Œåœ°å€0x00100000å¼€å§‹çš„8ä¸ªwordå•ä½çš„å€¼ï¼Œä¸ºä»€ä¹ˆä¸åŒã€‚</p><p>0x7c00æ—¶ï¼Œ0x00100000å¤„çš„8ä¸ªwordçš„å€¼éƒ½ä¸º0&mldr;</p><p>åœ¨0x10000cæ—¶ï¼Œ0x00100000å¤„çš„å€¼ç¿»è¯‘æˆæŒ‡ä»¤ä¹‹åæ˜¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln>1</span><span class=cl><span class=err>0</span><span class=nl>x100000:</span>    <span class=nf>add</span>    <span class=mi>0x1bad</span><span class=p>(</span><span class=no>x</span><span class=p>),</span><span class=nv>%dh</span>                                                                                                                                    <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>   <span class=err>0</span><span class=nl>x100006:</span>    <span class=nf>add</span>    <span class=nv>%al</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>   <span class=err>0</span><span class=nl>x100008:</span>    <span class=nf>decb</span>   <span class=mi>0x52</span><span class=p>(</span><span class=no>i</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>   <span class=err>0</span><span class=nl>x10000b:</span>    <span class=nf>in</span>     <span class=no>$0x66</span><span class=p>,</span><span class=nv>%al</span>                                                                                                                                           <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>   <span class=err>0</span><span class=nl>x10000d:</span>    <span class=nf>movl</span>   <span class=no>$0xb81234</span><span class=p>,</span><span class=mi>0x472</span>                                                                                                                                     <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>   <span class=err>0</span><span class=nl>x100017:</span>    <span class=nf>add</span>    <span class=nv>%dl</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>   <span class=err>0</span><span class=nl>x100019:</span>    <span class=nf>add</span>    <span class=nv>%cl</span><span class=p>,(</span><span class=no>i</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>   <span class=err>0</span><span class=nl>x10001b:</span>    <span class=nf>and</span>    <span class=nv>%al</span><span class=p>,</span><span class=nv>%bl</span>
</span></span></code></pre></div><p>ä¸ä¸€æ ·çš„åŸå› æ˜¯ï¼Œåœ¨åˆšåˆšè¿›å…¥boot loaderæ—¶ï¼Œkernelè¿˜æ²¡æœ‰åŠ è½½è¿›å†…å­˜ï¼Œå› æ­¤æ˜¯ç©ºçš„.</p><h2 id=part-3-the-kernel>Part 3: The Kernel</h2><h3 id=using-virtual-memory-to-work-around-position-dependence>Using virtual memory to work around position dependence</h3><p>OSçš„kernelé€šå¸¸å–œæ¬¢è¿è¡Œå†è¾ƒé«˜åœ°å€çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œæ¯”å¦‚0xf0100000ï¼Œä¸ºçš„æ˜¯ä½åœ°å€ç•™ç»™ç”¨æˆ·ç¨‹åºã€‚ä½†æ˜¯æœ‰çš„æœºå™¨å¯èƒ½æ²¡æœ‰é‚£ä¹ˆå¤§çš„memoryï¼Œå› æ­¤ä¸å­˜åœ¨0xf0100000è¿™ä¸ªç‰©ç†åœ°å€ã€‚å› æ­¤è¿™é‡Œéœ€è¦åšä¸€ä¸ªè™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ã€‚åœ¨è¿™ä¸ªéƒ¨åˆ†å®éªŒä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡³å°‘åœ°å€æ˜ å°„æ˜¯å¦‚ä½•workçš„ï¼Œåªéœ€è¦çŸ¥é“æ•ˆæœå°±å¥½ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“CR0_PGè¢«ç½®ä¸º1ä¹‹å‰ï¼Œå†…å­˜åœ°å€ä¸ºç‰©ç†å†…å­˜åœ°å€(ä¸¥æ ¼åœ°è¯´ï¼Œå…¶å®æ˜¯çº¿æ€§åœ°å€ï¼Œä¸è¿‡åœ¨boot/boot.Sä¸­åšäº†çº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„ç­‰ä»·æ˜ å°„ï¼‰ï¼Œå½“CRO_PG flagè¢«ç½®ä¸º1ä¹‹åï¼Œåœ°å€å°±å˜æˆäº†è™šæ‹Ÿå†…å­˜åœ°å€ã€‚æˆ‘ä»¬å¯ä»¥ç”¨gdbè°ƒè¯•çœ‹ä¸€ä¸‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><blockquote>Exercise 7.Â  Use QEMU and GDB to trace into the JOS kernel and stop at theÂ `movl x, %cr0`. Examine memory at 0x00100000 and at 0xf0100000. Now, single step over that instruction using theÂ stepiÂ GDB command. Again, examine memory at 0x00100000 and at 0xf0100000. Make sure you understand what just happened.<p>What is the first instructionÂ <em>after</em>Â the new mapping is established that would fail to work properly if the mapping weren&rsquo;t in place? Comment out theÂ <code>movl x, %cr0</code>Â inÂ kern/entry.S, trace into it, and see if you were right.</blockquote></p><p>å…ˆç”¨b *0x10000cå¤„è®¾ç½®æ–­ç‚¹ï¼Œè¿™ä¸ªæ˜¯JOS kernelå¼€å§‹è¿è¡Œçš„åœ°å€ã€‚ç„¶åå•æ­¥å‡ æ­¥ï¼Œåœ¨movl x , %cr0å¤„åœç•™ï¼Œä¹Ÿå°±æ˜¯cr0_PG flagæ°å¥½ä¹Ÿè¢«åˆ¶ä¸º1ä¹‹å‰ã€‚è§‚å¯Ÿä¸€ä¸‹0x00100000å’Œ0xf0100000çš„å†…å®¹:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln> 1</span><span class=cl>    <span class=err>(</span><span class=nf>gdb</span><span class=p>)</span> <span class=no>x</span><span class=err>/</span><span class=mi>8</span><span class=no>x</span> <span class=mi>0xf0100000</span>                                                                                                 
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=mh>0xf0100000</span> <span class=p>&lt;</span><span class=no>_start</span><span class=p>+</span><span class=mi>4026531828</span><span class=p>&gt;:</span> <span class=mi>0x00000000</span>      <span class=mi>0x00000000</span>      <span class=mi>0x00000000</span>      <span class=mi>0x00000000</span>                                                                                 
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=mh>0xf0100010</span> <span class=p>&lt;</span><span class=no>entry</span><span class=p>+</span><span class=mi>4</span><span class=p>&gt;:</span>   <span class=mi>0x00000000</span>      <span class=mi>0x00000000</span>      <span class=mi>0x00000000</span>      <span class=mi>0x00000000</span> 
</span></span><span class=line><span class=ln> 4</span><span class=cl>    
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=no>x</span><span class=err>/</span><span class=mi>8</span><span class=no>i</span> <span class=mi>0x00100000</span>                                                                                                                                                      <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>       <span class=err>0</span><span class=nl>x100000:</span>    <span class=nf>add</span>    <span class=mi>0x1bad</span><span class=p>(</span><span class=no>x</span><span class=p>),</span><span class=nv>%dh</span>                                                                                                                                    <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>       <span class=err>0</span><span class=nl>x100006:</span>    <span class=nf>add</span>    <span class=nv>%al</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>       <span class=err>0</span><span class=nl>x100008:</span>    <span class=nf>decb</span>   <span class=mi>0x52</span><span class=p>(</span><span class=no>i</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>       <span class=err>0</span><span class=nl>x10000b:</span>    <span class=nf>in</span>     <span class=no>$0x66</span><span class=p>,</span><span class=nv>%al</span>                                                                                                                                           <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>       <span class=err>0</span><span class=nl>x10000d:</span>    <span class=nf>movl</span>   <span class=no>$0xb81234</span><span class=p>,</span><span class=mi>0x472</span>                                                                                                                                     <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>       <span class=err>0</span><span class=nl>x100017:</span>    <span class=nf>add</span>    <span class=nv>%dl</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>       <span class=err>0</span><span class=nl>x100019:</span>    <span class=nf>add</span>    <span class=nv>%cl</span><span class=p>,(</span><span class=no>i</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>       <span class=err>0</span><span class=nl>x10001b:</span>    <span class=nf>and</span>    <span class=nv>%al</span><span class=p>,</span><span class=nv>%bl</span>
</span></span></code></pre></div><p>ç„¶åæ¥ç€å•æ­¥ä¸€æ¬¡ï¼Œå†æ¬¡ç”¨x/8iè§‚å¯Ÿ8æ¡0x00100000å’Œ0xf0100000å¤„çš„å†…å®¹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln> 1</span><span class=cl><span class=err>(</span><span class=nf>gdb</span><span class=p>)</span> <span class=no>x</span><span class=err>/</span><span class=mi>8</span><span class=no>i</span> <span class=mi>0x00100000</span>                                                                                                                                                      <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>   <span class=err>0</span><span class=nl>x100000:</span>    <span class=nf>add</span>    <span class=mi>0x1bad</span><span class=p>(</span><span class=no>x</span><span class=p>),</span><span class=nv>%dh</span>                                                                                                                                    <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>   <span class=err>0</span><span class=nl>x100006:</span>    <span class=nf>add</span>    <span class=nv>%al</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>   <span class=err>0</span><span class=nl>x100008:</span>    <span class=nf>decb</span>   <span class=mi>0x52</span><span class=p>(</span><span class=no>i</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>   <span class=err>0</span><span class=nl>x10000b:</span>    <span class=nf>in</span>     <span class=no>$0x66</span><span class=p>,</span><span class=nv>%al</span>                                                                                                                                           <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>   <span class=err>0</span><span class=nl>x10000d:</span>    <span class=nf>movl</span>   <span class=no>$0xb81234</span><span class=p>,</span><span class=mi>0x472</span>                                                                                                                                     <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>   <span class=err>0</span><span class=nl>x100017:</span>    <span class=nf>add</span>    <span class=nv>%dl</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>   <span class=err>0</span><span class=nl>x100019:</span>    <span class=nf>add</span>    <span class=nv>%cl</span><span class=p>,(</span><span class=no>i</span><span class=p>)</span>                                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>   <span class=err>0</span><span class=nl>x10001b:</span>    <span class=nf>and</span>    <span class=nv>%al</span><span class=p>,</span><span class=nv>%bl</span>                                                                                                                                             <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=err>(</span><span class=nf>gdb</span><span class=p>)</span> <span class=no>x</span><span class=err>/</span><span class=mi>8</span><span class=no>i</span> <span class=mi>0xf0100000</span>                                                                                                                                                      <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>   <span class=err>0</span><span class=nf>xf0100000</span> <span class=err>&lt;</span><span class=no>_start</span><span class=err>+</span><span class=mi>4026531828</span><span class=err>&gt;</span><span class=p>:</span>      <span class=no>add</span>    <span class=mi>0x1bad</span><span class=p>(</span><span class=no>x</span><span class=p>),</span><span class=nv>%dh</span>                                                                                                            <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>   <span class=err>0</span><span class=nf>xf0100006</span> <span class=err>&lt;</span><span class=no>_start</span><span class=err>+</span><span class=mi>4026531834</span><span class=err>&gt;</span><span class=p>:</span>      <span class=no>add</span>    <span class=nv>%al</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                  <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>   <span class=err>0</span><span class=nf>xf0100008</span> <span class=err>&lt;</span><span class=no>_start</span><span class=err>+</span><span class=mi>4026531836</span><span class=err>&gt;</span><span class=p>:</span>      <span class=no>decb</span>   <span class=mi>0x52</span><span class=p>(</span><span class=no>i</span><span class=p>)</span>                                                                                                                  <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>   <span class=err>0</span><span class=nf>xf010000b</span> <span class=err>&lt;</span><span class=no>_start</span><span class=err>+</span><span class=mi>4026531839</span><span class=err>&gt;</span><span class=p>:</span>      <span class=no>in</span>     <span class=no>$0x66</span><span class=p>,</span><span class=nv>%al</span>                                                                                                                   <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>   <span class=err>0</span><span class=nf>xf010000d</span> <span class=err>&lt;</span><span class=no>entry</span><span class=err>+</span><span class=mi>1</span><span class=err>&gt;</span><span class=p>:</span>        <span class=no>movl</span>   <span class=no>$0xb81234</span><span class=p>,</span><span class=mi>0x472</span>                                                                                                                     <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>   <span class=err>0</span><span class=nf>xf0100017</span> <span class=err>&lt;</span><span class=no>entry</span><span class=err>+</span><span class=mi>11</span><span class=err>&gt;</span><span class=p>:</span>       <span class=no>add</span>    <span class=nv>%dl</span><span class=p>,(</span><span class=no>x</span><span class=p>)</span>                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>   <span class=err>0</span><span class=nf>xf0100019</span> <span class=err>&lt;</span><span class=no>entry</span><span class=err>+</span><span class=mi>13</span><span class=err>&gt;</span><span class=p>:</span>       <span class=no>add</span>    <span class=nv>%cl</span><span class=p>,(</span><span class=no>i</span><span class=p>)</span>                                                                                                                          <span class=err>â”‚Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>   <span class=err>0</span><span class=nf>xf010001b</span> <span class=err>&lt;</span><span class=no>entry</span><span class=err>+</span><span class=mi>15</span><span class=err>&gt;</span><span class=p>:</span>       <span class=no>and</span>    <span class=nv>%al</span><span class=p>,</span><span class=nv>%bl</span>
</span></span></code></pre></div><p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåœ¨cx0_PG flagè¢«ç½®ä¸º1ä¹‹å‰ï¼Œåœ°å€0xf0100000å¤„æ˜¯ä¸€ç‰‡è™šæ— ã€‚</p><p>ç½®ä¸º1ä¹‹åï¼Œåœ°å€0xf0100000å¤„çš„å†…å®¹å’Œ0x00100000å¤„çš„å†…å®¹ä¸€è‡´ã€‚éœ€è¦æ³¨æ„ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªåœ°å€éƒ½æ˜¯è™šæ‹Ÿå†…å­˜åœ°å€äº†ã€‚å…·ä½“æ¥è¯´</p><blockquote>OnceÂ `CR0_PG`Â is set, memory references are virtual addresses that get translated by the virtual memory hardware to physical addresses.Â `entry_pgdir`Â translates virtual addresses in the range 0xf0000000 through 0xf0400000 to physical addresses 0x00000000 through 0x00400000, as well as virtual addresses 0x00000000 through 0x00400000 to physical addresses 0x00000000 through 0x00400000</blockquote><p>ç„¶åæˆ‘ä»¬æ³¨é‡Šæ‰<code>movl x, %cr0</code>Â inÂ kern/entry.S</p><p>å†æ¬¡ç”¨gdbè°ƒè¯•ï¼Œå‘ç°0x10002a: jmp *xÂ  crashäº†ã€‚ åŸå› æ˜¾ç„¶æ˜¯ç”±äºæ²¡æœ‰å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œeaxçš„åœ°å€å€¼ä¸åˆæ³•ã€‚</p><h3 id=formatted-printing-to-the-console>Formatted Printing to the Console</h3><p>printfçš„æ ¼å¼åŒ–è¾“å‡ºå¹¶ä¸æ˜¯å¤©ç”Ÿå°±æœ‰çš„ï¼Œé¦–å…ˆé˜…è¯»ä¸€ä¸‹ç›¸å…³çš„å‡ ä¸ªä»£ç ã€‚kern/printf.c, kern/console.cå’Œlib/printfmt.c</p><blockquote>Exercise 8.Â We have omitted a small fragment of code - the code necessary to print octal numbers using patterns of the form "%o". Find and fill in this code fragment.</blockquote><p>å¾ˆç®€å•ï¼Œä¿®æ”¹ä¹‹åä»£ç ä¸º</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl>    <span class=k>case</span> <span class=sc>&#39;o&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    			<span class=c1>// Replace this with your code.
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=c1></span>    			<span class=n>num</span> <span class=o>=</span> <span class=nf>getuint</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ap</span><span class=p>,</span><span class=n>lflag</span><span class=p>);</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    			<span class=n>base</span> <span class=o>=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    			<span class=k>goto</span> <span class=n>number</span><span class=p>;</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥æ¥å›ç­”å‡ ä¸ªé—®é¢˜</p><blockquote><pre><code>  1. Explain the interface betweenÂ printf.cÂ andÂ console.c. Specifically, what function doesÂ console.cÂ export? How is this function used byÂ printf.c?
</code></pre></blockquote><p>printf.cä¸console.cçš„æ¥å£æ˜¯console.cä¸­çš„cputchar()ï¼Œä½œç”¨æ˜¯å‘consoleä¸­æ‰“å°ä¸€ä¸ªå­—ç¬¦ã€‚printf.cåœ¨patch()å‡½æ•°ä¸­ä½¿ç”¨äº†cputchar()</p><p>2.Explain the following fromÂ console.c:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>     
</span></span><span class=line><span class=ln> 2</span><span class=cl>     <span class=k>if</span> <span class=p>(</span><span class=n>crt_pos</span> <span class=o>&gt;=</span> <span class=n>CRT_SIZE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>              <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>              <span class=nf>memmove</span><span class=p>(</span><span class=n>crt_buf</span><span class=p>,</span> <span class=n>crt_buf</span> <span class=o>+</span> <span class=n>CRT_COLS</span><span class=p>,</span> <span class=p>(</span><span class=n>CRT_SIZE</span> <span class=o>-</span> <span class=n>CRT_COLS</span><span class=p>)</span> <span class=o>*</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>uint16_t</span><span class=p>));</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>              <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=n>CRT_SIZE</span> <span class=o>-</span> <span class=n>CRT_COLS</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>CRT_SIZE</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>              <span class=n>crt_buf</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x0700</span> <span class=o>|</span> <span class=sc>&#39; &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>              <span class=n>crt_pos</span> <span class=o>-=</span> <span class=n>CRT_COLS</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl> 
</span></span><span class=line><span class=ln>10</span><span class=cl> 
</span></span></code></pre></div><p>è¿™æ®µä»£ç å¾ˆæ˜¾ç„¶ï¼Œå«ä¹‰æ˜¯å±å¹•çš„å­—ç¬¦æ•°è¶…è¿‡äº†å±å¹•èƒ½æ˜¾ç¤ºçš„æœ€å¤§æ•°ç›®çš„æƒ…å†µä¸‹ï¼Œå°†ç¬¬äºŒè¡Œåˆ°æœ€åä¸€è¡Œçš„å­—ç¬¦æ•´ä½“ä¸Šç§»ä¸€è¡Œï¼ˆè¿™æ ·åŸå…ˆçš„ç¬¬ä¸€è¡Œå°±è¢«è¦†ç›–äº†ï¼‰ï¼Œç„¶åå°†æœ€åä¸€è¡Œçš„å†…å®¹æ¸…ç©ºï¼ˆå› ä¸ºå·²ç»ä¸Šç§»åˆ°å€’æ•°ç¬¬äºŒè¡Œäº†)Â  Â åº”è¯¥æ˜¯ç±»ä¼¼å±å¹•æ»šåŠ¨çš„æ•ˆæœ</p><blockquote>3. For the following questions you might wish to consult the notes for Lecture 2. These notes cover GCC's calling convention on the x86.<p>Trace the execution of the following code step-by-step:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl>
</span></span><span class=line><span class=ln>2</span><span class=cl>     <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>z</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>     <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;x %d, y %x, z %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>);</span>
</span></span></code></pre></div><pre><code>  * In the call toÂ `cprintf()`, to what doesÂ `fmt`Â point? To what doesÂ `ap`Â point?
  * List (in order of execution) each call toÂ `cons_putc`,Â `va_arg`, andÂ `vcprintf`. ForÂ `cons_putc`, list its argument as well. ForÂ `va_arg`, list whatÂ `ap`Â points to before and after the call. ForÂ `vcprintf`Â list the values of its two arguments.
</code></pre><p>è¿™ä¸ªé—®é¢˜çš„è§£ç­”å¯ä»¥å…ˆå‚è€ƒä¸€ä¸‹<a href=https://111qqz.com/2019/02/variadic-function-of-c/>cè¯­è¨€å˜é•¿å‚æ•°</a>å’Œ<a href=https://111qqz.com/2019/01/x86-calling-conventions/>x86 calling conventions</a></p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹print.cçš„ä»£ç :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>      <span class=k>static</span> <span class=kt>void</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>      <span class=nf>putch</span><span class=p>(</span><span class=kt>int</span> <span class=n>ch</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>cnt</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>      	<span class=nf>cputchar</span><span class=p>(</span><span class=n>ch</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>      	<span class=o>*</span><span class=n>cnt</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>      <span class=kt>int</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=nf>vcprintf</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=n>va_list</span> <span class=n>ap</span><span class=p>)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>      	<span class=kt>int</span> <span class=n>cnt</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>      
</span></span><span class=line><span class=ln>13</span><span class=cl>      	<span class=nf>vprintfmt</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=n>putch</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>cnt</span><span class=p>,</span> <span class=n>fmt</span><span class=p>,</span> <span class=n>ap</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>      	<span class=k>return</span> <span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>      
</span></span><span class=line><span class=ln>17</span><span class=cl>      <span class=kt>int</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>      <span class=nf>cprintf</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=p>...)</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>      	<span class=n>va_list</span> <span class=n>ap</span><span class=p>;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>      	<span class=kt>int</span> <span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>      
</span></span><span class=line><span class=ln>23</span><span class=cl>      	<span class=nf>va_start</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=n>fmt</span><span class=p>);</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>      	<span class=n>cnt</span> <span class=o>=</span> <span class=nf>vcprintf</span><span class=p>(</span><span class=n>fmt</span><span class=p>,</span> <span class=n>ap</span><span class=p>);</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>      	<span class=nf>va_end</span><span class=p>(</span><span class=n>ap</span><span class=p>);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>      
</span></span><span class=line><span class=ln>27</span><span class=cl>      	<span class=k>return</span> <span class=n>cnt</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>      <span class=p>}</span>
</span></span></code></pre></div><p>ä»int cprintf(const char <em>fmt, &mldr;)å¼€å§‹çœ‹ï¼Œå‚æ•°</em>fmtåº”è¯¥å°±æ˜¯ æˆ‘ä»¬ç†Ÿæ‚‰çš„cè¯­è¨€çš„printfçš„æ ¼å¼åŒ–éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p>ç„¶åæ•´ä½“å°±æ˜¯cè¯­è¨€å˜é•¿å‚æ•°çš„routineï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨va_arg, è€Œæ˜¯ç”¨cnt = cvprintf(fmt,ap)ï¼Œè¿”å›äº†ä¸€ä¸ªä¸çŸ¥é“ä»€ä¹ˆçš„ä¸ªæ•°ã€‚</p><p>æ¥ä¸‹æ¥çœ‹int vcprintf(const char *fmt, va_list ap)ï¼Œå¥½åƒæ²¡ä»€ä¹ˆå¥½çœ‹çš„&mldr;. ç„¶åæ˜¯vprintfmtï¼Œä»£ç å¦‚ä¸‹:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>  1</span><span class=cl>      <span class=kt>void</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>      <span class=nf>vprintfmt</span><span class=p>(</span><span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>putch</span><span class=p>)(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>void</span><span class=o>*</span><span class=p>),</span> <span class=kt>void</span> <span class=o>*</span><span class=n>putdat</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>fmt</span><span class=p>,</span> <span class=n>va_list</span> <span class=n>ap</span><span class=p>)</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl>      	<span class=k>register</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>      	<span class=k>register</span> <span class=kt>int</span> <span class=n>ch</span><span class=p>,</span> <span class=n>err</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>      	<span class=kt>unsigned</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>      	<span class=kt>int</span> <span class=n>base</span><span class=p>,</span> <span class=n>lflag</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=n>precision</span><span class=p>,</span> <span class=n>altflag</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>      	<span class=kt>char</span> <span class=n>padc</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>      
</span></span><span class=line><span class=ln> 10</span><span class=cl>      	<span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>      		<span class=k>while</span> <span class=p>((</span><span class=n>ch</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span> <span class=n>fmt</span><span class=o>++</span><span class=p>)</span> <span class=o>!=</span> <span class=sc>&#39;%&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>      			<span class=k>if</span> <span class=p>(</span><span class=n>ch</span> <span class=o>==</span> <span class=sc>&#39;\0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>      				<span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>      			<span class=nf>putch</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>      		<span class=p>}</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>      
</span></span><span class=line><span class=ln> 17</span><span class=cl>      		<span class=c1>// Process a %-escape sequence
</span></span></span><span class=line><span class=ln> 18</span><span class=cl><span class=c1></span>      		<span class=n>padc</span> <span class=o>=</span> <span class=sc>&#39; &#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>      		<span class=n>width</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>      		<span class=n>precision</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>      		<span class=n>lflag</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>      		<span class=n>altflag</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>      	<span class=nl>reswitch</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>      		<span class=k>switch</span> <span class=p>(</span><span class=n>ch</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span> <span class=n>fmt</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>      
</span></span><span class=line><span class=ln> 26</span><span class=cl>      		<span class=c1>// flag to pad on the right
</span></span></span><span class=line><span class=ln> 27</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;-&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl>      			<span class=n>padc</span> <span class=o>=</span> <span class=sc>&#39;-&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>      			<span class=k>goto</span> <span class=n>reswitch</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>      
</span></span><span class=line><span class=ln> 31</span><span class=cl>      		<span class=c1>// flag to pad with 0&#39;s instead of spaces
</span></span></span><span class=line><span class=ln> 32</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;0&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>      			<span class=n>padc</span> <span class=o>=</span> <span class=sc>&#39;0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>      			<span class=k>goto</span> <span class=n>reswitch</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl>      
</span></span><span class=line><span class=ln> 36</span><span class=cl>      		<span class=c1>// width field
</span></span></span><span class=line><span class=ln> 37</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;1&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;2&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;3&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;4&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;5&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;6&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;7&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;8&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;9&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>      			<span class=k>for</span> <span class=p>(</span><span class=n>precision</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>;</span> <span class=o>++</span><span class=n>fmt</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>      				<span class=n>precision</span> <span class=o>=</span> <span class=n>precision</span> <span class=o>*</span> <span class=mi>10</span> <span class=o>+</span> <span class=n>ch</span> <span class=o>-</span> <span class=sc>&#39;0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl>      				<span class=n>ch</span> <span class=o>=</span> <span class=o>*</span><span class=n>fmt</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>      				<span class=k>if</span> <span class=p>(</span><span class=n>ch</span> <span class=o>&lt;</span> <span class=sc>&#39;0&#39;</span> <span class=o>||</span> <span class=n>ch</span>   <span class=sc>&#39;9&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>      					<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>      			<span class=p>}</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl>      			<span class=k>goto</span> <span class=n>process_precision</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>      
</span></span><span class=line><span class=ln> 54</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;*&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>      			<span class=n>precision</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl>      			<span class=k>goto</span> <span class=n>process_precision</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>      
</span></span><span class=line><span class=ln> 58</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;.&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>      			<span class=k>if</span> <span class=p>(</span><span class=n>width</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>      				<span class=n>width</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl>      			<span class=k>goto</span> <span class=n>reswitch</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>      
</span></span><span class=line><span class=ln> 63</span><span class=cl>      		<span class=k>case</span> <span class=sc>&#39;#&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>      			<span class=n>altflag</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>      			<span class=k>goto</span> <span class=n>reswitch</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>      
</span></span><span class=line><span class=ln> 67</span><span class=cl>      		<span class=nl>process_precision</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>      			<span class=k>if</span> <span class=p>(</span><span class=n>width</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>      				<span class=n>width</span> <span class=o>=</span> <span class=n>precision</span><span class=p>,</span> <span class=n>precision</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>      			<span class=k>goto</span> <span class=n>reswitch</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>      
</span></span><span class=line><span class=ln> 72</span><span class=cl>      		<span class=c1>// long flag (doubled for long long)
</span></span></span><span class=line><span class=ln> 73</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;l&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>      			<span class=n>lflag</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>      			<span class=k>goto</span> <span class=n>reswitch</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl>      
</span></span><span class=line><span class=ln> 77</span><span class=cl>      		<span class=c1>// character
</span></span></span><span class=line><span class=ln> 78</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;c&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>      			<span class=nf>putch</span><span class=p>(</span><span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>),</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>      			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>      
</span></span><span class=line><span class=ln> 82</span><span class=cl>      		<span class=c1>// error message
</span></span></span><span class=line><span class=ln> 83</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;e&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>      			<span class=n>err</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>      			<span class=k>if</span> <span class=p>(</span><span class=n>err</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>      				<span class=n>err</span> <span class=o>=</span> <span class=o>-</span><span class=n>err</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>      			<span class=k>if</span> <span class=p>(</span><span class=n>err</span>  <span class=o>=</span> <span class=n>MAXERROR</span> <span class=o>||</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=n>error_string</span><span class=p>[</span><span class=n>err</span><span class=p>])</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl>      				<span class=nf>printfmt</span><span class=p>(</span><span class=n>putch</span><span class=p>,</span> <span class=n>putdat</span><span class=p>,</span> <span class=s>&#34;error %d&#34;</span><span class=p>,</span> <span class=n>err</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>      			<span class=k>else</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>      				<span class=nf>printfmt</span><span class=p>(</span><span class=n>putch</span><span class=p>,</span> <span class=n>putdat</span><span class=p>,</span> <span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>      			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>      
</span></span><span class=line><span class=ln> 93</span><span class=cl>      		<span class=c1>// string
</span></span></span><span class=line><span class=ln> 94</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;s&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>      			<span class=k>if</span> <span class=p>((</span><span class=n>p</span> <span class=o>=</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=p>))</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>      				<span class=n>p</span> <span class=o>=</span> <span class=s>&#34;(null)&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>      			<span class=k>if</span> <span class=p>(</span><span class=n>width</span>   <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>padc</span> <span class=o>!=</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>      				<span class=k>for</span> <span class=p>(</span><span class=n>width</span> <span class=o>-=</span> <span class=nf>strnlen</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>precision</span><span class=p>);</span> <span class=n>width</span>   <span class=mi>0</span><span class=p>;</span> <span class=n>width</span><span class=o>--</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>      					<span class=nf>putch</span><span class=p>(</span><span class=n>padc</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>      			<span class=k>for</span> <span class=p>(;</span> <span class=p>(</span><span class=n>ch</span> <span class=o>=</span> <span class=o>*</span><span class=n>p</span><span class=o>++</span><span class=p>)</span> <span class=o>!=</span> <span class=sc>&#39;\0&#39;</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>precision</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=o>--</span><span class=n>precision</span>  <span class=o>=</span> <span class=mi>0</span><span class=p>);</span> <span class=n>width</span><span class=o>--</span><span class=p>)</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>      				<span class=k>if</span> <span class=p>(</span><span class=n>altflag</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>ch</span> <span class=o>&lt;</span> <span class=sc>&#39; &#39;</span> <span class=o>||</span> <span class=n>ch</span>   <span class=sc>&#39;~&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>      					<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;?&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>      				<span class=k>else</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>      					<span class=nf>putch</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>      			<span class=k>for</span> <span class=p>(;</span> <span class=n>width</span>   <span class=mi>0</span><span class=p>;</span> <span class=n>width</span><span class=o>--</span><span class=p>)</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>      				<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39; &#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>107</span><span class=cl>      			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>      
</span></span><span class=line><span class=ln>109</span><span class=cl>      		<span class=c1>// (signed) decimal
</span></span></span><span class=line><span class=ln>110</span><span class=cl><span class=c1></span>      		<span class=k>case</span> <span class=sc>&#39;d&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>111</span><span class=cl>      			<span class=n>num</span> <span class=o>=</span> <span class=nf>getint</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ap</span><span class=p>,</span> <span class=n>lflag</span><span class=p>);</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>      			<span class=k>if</span> <span class=p>((</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span> <span class=n>num</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>      				<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;-&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>      				<span class=n>num</span> <span class=o>=</span> <span class=o>-</span><span class=p>(</span><span class=kt>long</span> <span class=kt>long</span><span class=p>)</span> <span class=n>num</span><span class=p>;</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>      			<span class=p>}</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>     			<span class=n>base</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>     			<span class=k>goto</span> <span class=n>number</span><span class=p>;</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>     
</span></span><span class=line><span class=ln>119</span><span class=cl>     		<span class=c1>// unsigned decimal
</span></span></span><span class=line><span class=ln>120</span><span class=cl><span class=c1></span>     		<span class=k>case</span> <span class=sc>&#39;u&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>121</span><span class=cl>     			<span class=n>num</span> <span class=o>=</span> <span class=nf>getuint</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ap</span><span class=p>,</span> <span class=n>lflag</span><span class=p>);</span>
</span></span><span class=line><span class=ln>122</span><span class=cl>     			<span class=n>base</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=ln>123</span><span class=cl>     			<span class=k>goto</span> <span class=n>number</span><span class=p>;</span>
</span></span><span class=line><span class=ln>124</span><span class=cl>     
</span></span><span class=line><span class=ln>125</span><span class=cl>     		<span class=c1>// (unsigned) octal
</span></span></span><span class=line><span class=ln>126</span><span class=cl><span class=c1></span>     		<span class=k>case</span> <span class=sc>&#39;o&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>     			<span class=c1>// Replace this with your code.
</span></span></span><span class=line><span class=ln>128</span><span class=cl><span class=c1></span>     			<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;X&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>129</span><span class=cl>     			<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;X&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>     			<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;X&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>     			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>132</span><span class=cl>     
</span></span><span class=line><span class=ln>133</span><span class=cl>     		<span class=c1>// pointer
</span></span></span><span class=line><span class=ln>134</span><span class=cl><span class=c1></span>     		<span class=k>case</span> <span class=sc>&#39;p&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>     			<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;0&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>136</span><span class=cl>     			<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;x&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>137</span><span class=cl>     			<span class=n>num</span> <span class=o>=</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>long</span> <span class=kt>long</span><span class=p>)</span>
</span></span><span class=line><span class=ln>138</span><span class=cl>     				<span class=p>(</span><span class=kt>uintptr_t</span><span class=p>)</span> <span class=nf>va_arg</span><span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=ln>139</span><span class=cl>     			<span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=ln>140</span><span class=cl>     			<span class=k>goto</span> <span class=n>number</span><span class=p>;</span>
</span></span><span class=line><span class=ln>141</span><span class=cl>     
</span></span><span class=line><span class=ln>142</span><span class=cl>     		<span class=c1>// (unsigned) hexadecimal
</span></span></span><span class=line><span class=ln>143</span><span class=cl><span class=c1></span>     		<span class=k>case</span> <span class=sc>&#39;x&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>144</span><span class=cl>     			<span class=n>num</span> <span class=o>=</span> <span class=nf>getuint</span><span class=p>(</span><span class=o>&amp;</span><span class=n>ap</span><span class=p>,</span> <span class=n>lflag</span><span class=p>);</span>
</span></span><span class=line><span class=ln>145</span><span class=cl>     			<span class=n>base</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=ln>146</span><span class=cl>     		<span class=nl>number</span><span class=p>:</span>
</span></span><span class=line><span class=ln>147</span><span class=cl>     			<span class=nf>printnum</span><span class=p>(</span><span class=n>putch</span><span class=p>,</span> <span class=n>putdat</span><span class=p>,</span> <span class=n>num</span><span class=p>,</span> <span class=n>base</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=n>padc</span><span class=p>);</span>
</span></span><span class=line><span class=ln>148</span><span class=cl>     			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>149</span><span class=cl>     
</span></span><span class=line><span class=ln>150</span><span class=cl>     		<span class=c1>// escaped &#39;%&#39; character
</span></span></span><span class=line><span class=ln>151</span><span class=cl><span class=c1></span>     		<span class=k>case</span> <span class=sc>&#39;%&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>152</span><span class=cl>     			<span class=nf>putch</span><span class=p>(</span><span class=n>ch</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>153</span><span class=cl>     			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>154</span><span class=cl>     
</span></span><span class=line><span class=ln>155</span><span class=cl>     		<span class=c1>// unrecognized escape sequence - just print it literally
</span></span></span><span class=line><span class=ln>156</span><span class=cl><span class=c1></span>     		<span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=ln>157</span><span class=cl>     			<span class=nf>putch</span><span class=p>(</span><span class=sc>&#39;%&#39;</span><span class=p>,</span> <span class=n>putdat</span><span class=p>);</span>
</span></span><span class=line><span class=ln>158</span><span class=cl>     			<span class=k>for</span> <span class=p>(</span><span class=n>fmt</span><span class=o>--</span><span class=p>;</span> <span class=n>fmt</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>!=</span> <span class=sc>&#39;%&#39;</span><span class=p>;</span> <span class=n>fmt</span><span class=o>--</span><span class=p>)</span>
</span></span><span class=line><span class=ln>159</span><span class=cl>     				<span class=cm>/* do nothing */</span><span class=p>;</span>
</span></span><span class=line><span class=ln>160</span><span class=cl>     			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>161</span><span class=cl>     		<span class=p>}</span>
</span></span><span class=line><span class=ln>162</span><span class=cl>     	<span class=p>}</span>
</span></span><span class=line><span class=ln>163</span><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=ln>164</span><span class=cl> 
</span></span></code></pre></div><p>å¤§è‡´æ‰«ä¸€çœ¼å¯ä»¥å‘ç°è¿™æ®µä»£ç æ˜¯å¤„ç†è¾“å‡ºçš„æ ¼å¼åŒ–å‚æ•°çš„ï¼ŒåŒ…æ‹¬è¾“å‡ºç±»å‹ï¼Œç²¾åº¦ï¼Œåœºå®½ä¹‹ç±»ã€‚</p><p>æˆ‘ä»¬æ³¨æ„åˆ°putchå‡½æ•°çš„ä½œç”¨æ˜¯å‘consoleè¾“å‡ºä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶ç»Ÿè®¡å½“å‰ç´¯è®¡çš„è¾“å‡ºå­—ç¬¦ä¸ªæ•°ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å›ç­”é—®é¢˜:</p><pre><code>  * åœ¨cprintfçš„è°ƒç”¨ä¸­ï¼ŒfmtæŒ‡å‘çš„æ˜¯&quot;x %d, y %x, z %d\n&quot;, apæŒ‡å‘çš„æ˜¯ç¬¬ä¸€ä¸ªå˜é•¿å‚æ•°ï¼Œä¹Ÿå°±æ˜¯å˜é‡xåœ¨è°ƒç”¨æ ˆä¸­çš„åœ°å€ã€‚
  * cons_putcè°ƒç”¨çš„è¿‡ç¨‹æŒ‰å…ˆåé¡ºåºä¸º:

    * cons_putc('x')
    * cons_putc(' ')
    * cons_putc('1')
    * cons_putc(',')
    * cons_putc(' ')
    * cons_putc('y')
    * cons_putc(' ')
    * cons_putc('3')
    * cons_putc(',')
    * cons_putc(' ')
    * cons_putc('z')
    * cons_putc(' ')
    * cons_putc('4')
    * cons_putc('\n')


  * va_argä¸€å…±è°ƒç”¨äº†ä¸‰æ¬¡

    * ç¬¬ä¸€æ¬¡è°ƒç”¨å‰,apæŒ‡å‘å‚æ•°xåœ¨æ ˆä¸­çš„åœ°å€,è°ƒç”¨ä¹‹å,apæŒ‡å‘å‚æ•°yåœ¨æ ˆä¸­çš„åœ°å€ã€‚
    * ç¬¬äºŒæ¬¡è°ƒç”¨å‰,apæŒ‡å‘å‚æ•°yåœ¨æ ˆä¸­çš„åœ°å€,è°ƒç”¨ä¹‹å,apæŒ‡å‘å‚æ•°zåœ¨æ ˆä¸­çš„åœ°å€ã€‚
    * ç¬¬ä¸‰æ¬¡è°ƒç”¨å‰,apæŒ‡å‘å‚æ•°zåœ¨æ ˆä¸­çš„åœ°å€,è°ƒç”¨ä¹‹å,apæŒ‡å‘å‚æ•°zä¹‹å4å­—èŠ‚çš„åœ°å€ã€‚


  * vcprintfçš„å‚æ•°å€¼ä¸º&quot;x %d, y %x, z %d\n&quot; å’Œ å‚æ•°xåœ¨è°ƒç”¨æ ˆä¸­çš„åœ°å€ã€‚
</code></pre><p>4.Run the following code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl>         <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mh>0x00646c72</span><span class=p>;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>         <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;H%x Wo%s&#34;</span><span class=p>,</span> <span class=mi>57616</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>     
</span></span></code></pre></div><p>What is the output? Explain how this output is arrived at in the step-by-step manner of the previous exercise.Â <a href=http://web.cs.mun.ca/~michael/c/ascii-table.html>Here&rsquo;s an ASCII table</a>Â that maps bytes to characters.</p><p>The output depends on that fact that the x86 is little-endian. If the x86 were instead big-endian what would you setÂ <code>i</code>Â to in order to yield the same output? Would you need to changeÂ <code>57616</code>Â to a different value?</blockquote></p><p>è¾“å‡ºç»“æœä¸ºÂ  &ldquo;He110 World&rdquo; å‰åŠéƒ¨åˆ†çš„e110å°±æ˜¯57616çš„åå…­è¿›åˆ¶è¡¨ç¤ºã€‚ååŠéƒ¨åˆ†å°†unsiged int i å½“æˆunsigned charç±»å‹è¾“å‡ºï¼Œåå…­è¿›åˆ¶64,6c,72å¯¹åº”çš„å­—ç¬¦åˆ†åˆ«ä¸ºâ€˜dâ€™,â€˜lâ€™,&lsquo;r&rsquo;.</p><p>ç„¶åå…ˆå¤ä¹ ä¸€ä¸‹å­—èŠ‚åºã€‚<strong>æ•´æ•°ç±»å‹static_castä¸ä¼šæœ‰å­—èŠ‚åºé—®é¢˜ï¼ŒæŒ‡é’ˆ++å’Œ&ndash;æ“ä½œä¸æ¶‰åŠcastå’Œå­—èŠ‚åºé—®é¢˜ã€‚æŠŠæŒ‡é’ˆç±»å‹reinterpret_castæ‰ä¼šæœ‰å­—èŠ‚åºé—®é¢˜</strong>ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl>    
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mh>0x12345678</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>c</span> <span class=o>=</span> <span class=n>reinterpret_cast</span><span class=o>&lt;</span><span class=kt>char</span><span class=o>*&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%x %x %x %x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=c1>//å°ç«¯è¾“å‡º:78 56 34 12
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=c1></span>    <span class=c1>//å¤§ç«¯è¾“å‡º:12 34 56 78
</span></span></span></code></pre></div><p>ç”±äºx86ä½“ç³»æ¶æ„å­—èŠ‚åºä¸ºlittle-endian,å› æ­¤å®é™…è¾“å‡ºä¸º&rsquo;r&rsquo;,&rsquo;l&rsquo;,&rsquo;d'.</p><p>å¦‚æœx86ä½“ç³»æ¶æ„ä¸ºlarge-endian,é‚£ä¹ˆiçš„å€¼åº”è¯¥æ”¹ä¸º0x00726c64ï¼Œä»¥å®ç°ç›¸åŒçš„è¾“å‡ºç»“æœã€‚</p><p>57616ä¸éœ€è¦åšä¿®æ”¹ï¼Œå› ä¸ºæ•´æ•°ç±»å‹staic_castä¸å­˜åœ¨å­—èŠ‚åºé—®é¢˜ã€‚</p><blockquote>5.In the following code, what is going to be printed afterÂ `'y='`? (note: the answer is not a specific value.) Why does this happen?<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl>         <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;x=%d y=%d&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span></code></pre></div></blockquote><p>xçš„ç»“æœå°±æ˜¯3ï¼Œyçš„è¾“å‡ºæ˜¯æ²¡æ„ä¹‰çš„ä¸€ä¸ªæ•´æ•°ã€‚åŸå› æ˜¯ï¼Œè¿™å¥è¯ä¼šå‘ç”Ÿå½“va_listä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªå˜é‡æ—¶ï¼Œä»ç„¶ä½¿ç”¨va_argå»å–ä¸‹ä¸€ä¸ªå˜é‡ã€‚è€Œæ ¹æ®<a href=http://en.cppreference.com/w/cpp/utility/variadic/va_arg>va_arg</a>ï¼Œæ­¤æ—¶çš„è¡Œä¸ºæ˜¯undefined behaviour.</p><blockquote>6.Let's say that GCC changed its calling convention so that it pushed arguments on the stack in declaration order, so that the last argument is pushed last. How would you have to changeÂ `cprintf`Â or its interface so that it would still be possible to pass it a variable number of arguments?<p>æ„Ÿè§‰å¦‚æœçŸ¥è¯†ä¿®æ”¹cprintfæ¥è¾¾åˆ°ç›®çš„æœ‰ç‚¹éš¾ï¼Ÿ å› ä¸ºå‹æ ˆé¡ºåºå’Œä¹‹å‰ç›¸åäº†ï¼Œé‚£ä¹ˆva_argè¿™ä¸ªå®éœ€è¦ä¿®æ”¹ä¸€ä¸‹&mldr;æˆ–è€…ï¼Œæ·»åŠ ä¸€ä¸ªbufferï¼Œä¸æ˜¯ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå‚æ•°ï¼Œè€Œæ˜¯å…ˆå°†å‚æ•°å…¨éƒ¨è¯»å–ï¼Œç„¶åè°ƒæ¢é¡ºåºï¼Œä¹‹åå†è¿›è¡Œå¤„ç†ã€‚</blockquote></p><h3 id=the-stack>The Stack</h3><blockquote>Exercise 9.Â Determine where the kernel initializes its stack, and exactly where in memory its stack is located. How does the kernel reserve space for its stack? And at which "end" of this reserved area is the stack pointer initialized to point to?</blockquote><p>å‚è€ƒobj/kernel.asm</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln> 1</span><span class=cl>    <span class=nf>f010002c</span> <span class=err>&lt;</span><span class=no>relocated</span><span class=err>&gt;</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=nl>relocated:</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    
</span></span><span class=line><span class=ln> 4</span><span class=cl>            <span class=c1># Clear the frame pointer register (EBP)
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>            <span class=c1># so that once we get into debugging C code,
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>            <span class=c1># stack backtraces will be terminated properly.
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>            <span class=nf>movl</span>    <span class=no>$0x0</span><span class=p>,</span><span class=no>p</span>                       <span class=c1># nuke frame pointer
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>    <span class=nl>f010002c:</span>       <span class=nf>bd</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>mov</span>    <span class=no>$0x0</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=c1># Set the stack pointer
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>            <span class=nf>movl</span>    <span class=no>$</span><span class=p>(</span><span class=no>bootstacktop</span><span class=p>),</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nl>f0100031:</span>       <span class=nf>bc</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>11</span> <span class=no>f0</span>          <span class=no>mov</span>    <span class=no>$0xf0110000</span><span class=p>,</span><span class=nv>%esp</span>
</span></span></code></pre></div><p>å¾—çŸ¥kernelåˆå§‹åŒ–stackæ˜¯åœ¨åœ°å€0xf010002cå’Œ0xf0100031å®Œæˆçš„ã€‚stackè¢«åŠ è½½åˆ°äº†åœ°å€0xf01100000. è‡³äºkernelå¦‚ä½•ä¸ºstackä¿ç•™ç©ºé—´è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼Œstackç°åœ¨æœ‰äº†åˆå§‹ä½ç½®ï¼Œä½†æ˜¯å®ƒå¦‚ä½•çŸ¥é“è‡ªå·±æœ‰å¤šå¤§ç©ºé—´å‘¢ï¼Ÿ æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªé—®é¢˜é—®çš„æ˜¯kernelå¦‚ä½•å†³å®šstackçš„å¤§å°ã€‚è¿™ä¸€éƒ¨åˆ†å…¶å®å®šä¹‰åœ¨inc/memlayout.hä¸­ï¼Œ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>    <span class=c1>// All physical memory mapped at this address
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span>    <span class=cp>#define	KERNBASE	0xF0000000
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cp></span>    
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=c1>// At IOPHYSMEM (640K) there is a 384K hole for I/O.  From the kernel,
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>    <span class=c1>// IOPHYSMEM can be addressed at KERNBASE + IOPHYSMEM.  The hole ends
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>    <span class=c1>// at physical address EXTPHYSMEM.
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>    <span class=cp>#define IOPHYSMEM	0x0A0000
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=cp></span>    <span class=cp>#define EXTPHYSMEM	0x100000
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=cp></span>    
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=c1>// Kernel stack.
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>    <span class=cp>#define KSTACKTOP	KERNBASE
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=cp></span>    <span class=cp>#define KSTKSIZE	(8*PGSIZE)   		</span><span class=c1>// size of a kernel stack
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>    <span class=cp>#define KSTKGAP		(8*PGSIZE)   		</span><span class=c1>// size of a kernel stack guard
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=c1>// Memory-mapped IO.
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span>    <span class=cp>#define MMIOLIM		(KSTACKTOP - PTSIZE)
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=cp></span>    <span class=cp>#define MMIOBASE	(MMIOLIM - PTSIZE)
</span></span></span></code></pre></div><p>æœ€åä¸€ä¸ªé—®é¢˜ï¼Œç”±äºx86ä½“ç³»æ¶æ„ä¸‹æ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ã€‚å› æ­¤stack pointeråˆå§‹æŒ‡å‘è¿™æ®µä¿ç•™åŒºåŸŸçš„å¤§åœ°å€ç«¯ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢)</p><blockquote>Exercise 10.Â To become familiar with the C calling conventions on the x86, find the address of theÂ `test_backtrace`Â function inÂ obj/kern/kernel.asm, set a breakpoint there, and examine what happens each time it gets called after the kernel starts. How many 32-bit words does each recursive nesting level ofÂ `test_backtrace`Â push on the stack, and what are those words?<p>Note that, for this exercise to work properly, you should be using the patched version of QEMU available on theÂ <a href=https://pdos.csail.mit.edu/6.828/2018/tools.html>tools</a>Â page or on Athena. Otherwise, you&rsquo;ll have to manually translate all breakpoint and memory addresses to linear addresses.</blockquote></p><p>test_backtraceçš„å…¥å£åœ°å€åœ¨0xf0100040,åœ¨è¿™é‡Œè®¾ç½®æ–­ç‚¹ï¼Œç„¶åæœ€åçš„è¾“å‡ºç»“æœå¦‚ä¸‹:</p><pre><code>entering test_backtrace 5
entering test_backtrace 4
entering test_backtrace 3
entering test_backtrace 2
entering test_backtrace 1
entering test_backtrace 0
leaving test_backtrace 0
leaving test_backtrace 1
leaving test_backtrace 2
leaving test_backtrace 3
leaving test_backtrace 4
leaving test_backtrace 5
Welcome to the JOS kernel monitor!
</code></pre><p>å¯¹äºæ¯æ¬¡è°ƒç”¨å‡½æ•°test_backtrace,æœ‰ä¸‰ä¸ª32-bitçš„å˜é‡è¢«å‹æ ˆï¼Œå¯ä»¥å‚è€ƒ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ASM data-lang=ASM><span class=line><span class=ln> 1</span><span class=cl>    <span class=c1>// Test the stack backtrace function (lab 1 only)
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span>    <span class=nf>void</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nf>test_backtrace</span><span class=p>(</span><span class=no>int</span> <span class=no>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=err>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nl>f0100040:</span>       <span class=err>55</span>                      <span class=nf>push</span>   <span class=no>p</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nl>f0100041:</span>       <span class=err>89</span> <span class=nf>e5</span>                   <span class=no>mov</span>    <span class=nv>%esp</span><span class=p>,</span><span class=no>p</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nl>f0100043:</span>       <span class=err>53</span>                      <span class=nf>push</span>   <span class=no>x</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=nl>f0100044:</span>       <span class=err>83</span> <span class=nf>ec</span> <span class=mi>14</span>                <span class=no>sub</span>    <span class=no>$0x14</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=nl>f0100047:</span>       <span class=err>8</span><span class=nf>b</span> <span class=mi>5</span><span class=no>d</span> <span class=mi>08</span>                <span class=no>mov</span>    <span class=mi>0x8</span><span class=p>(</span><span class=no>p</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=nf>cprintf</span><span class=p>(</span><span class=err>&#34;</span><span class=no>entering</span> <span class=no>test_backtrace</span> <span class=nv>%d</span><span class=err>\</span><span class=no>n</span><span class=err>&#34;</span><span class=p>,</span> <span class=no>x</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>    <span class=nl>f010004a:</span>       <span class=err>89</span> <span class=err>5</span><span class=nf>c</span> <span class=mi>24</span> <span class=mi>04</span>             <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=nl>f010004e:</span>       <span class=nf>c7</span> <span class=mi>04</span> <span class=mi>24</span> <span class=no>e0</span> <span class=mi>18</span> <span class=mi>10</span> <span class=no>f0</span>    <span class=no>movl</span>   <span class=no>$0xf01018e0</span><span class=p>,(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=nl>f0100055:</span>       <span class=nf>e8</span> <span class=no>d7</span> <span class=mi>08</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>call</span>   <span class=mh>f0100931</span> <span class=p>&lt;</span><span class=no>cprintf</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>            <span class=nf>if</span> <span class=p>(</span><span class=no>x</span>  <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nl>f010005a:</span>       <span class=err>85</span> <span class=nf>db</span>                   <span class=no>test</span>   <span class=no>x</span><span class=p>,</span><span class=no>x</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=nl>f010005c:</span>       <span class=err>7</span><span class=nf>e</span> <span class=mi>0</span><span class=no>d</span>                   <span class=no>jle</span>    <span class=mh>f010006b</span> <span class=p>&lt;</span><span class=no>test_backtrace</span><span class=p>+</span><span class=mi>0x2b</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>                    <span class=nf>test_backtrace</span><span class=p>(</span><span class=no>x-1</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>    <span class=nl>f010005e:</span>       <span class=err>8</span><span class=nf>d</span> <span class=mi>43</span> <span class=no>ff</span>                <span class=no>lea</span>    <span class=p>-</span><span class=mi>0x1</span><span class=p>(</span><span class=no>x</span><span class=p>),</span><span class=no>x</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nl>f0100061:</span>       <span class=err>89</span> <span class=err>04</span> <span class=err>24</span>                <span class=nf>mov</span>    <span class=no>x</span><span class=p>,(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=nl>f0100064:</span>       <span class=nf>e8</span> <span class=no>d7</span> <span class=no>ff</span> <span class=no>ff</span> <span class=no>ff</span>          <span class=no>call</span>   <span class=mh>f0100040</span> <span class=p>&lt;</span><span class=no>test_backtrace</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=nl>f0100069:</span>       <span class=nf>eb</span> <span class=mi>1</span><span class=no>c</span>                   <span class=no>jmp</span>    <span class=mh>f0100087</span> <span class=p>&lt;</span><span class=no>test_backtrace</span><span class=p>+</span><span class=mi>0x47</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>            <span class=nf>else</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>                    <span class=nf>mon_backtrace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span>    <span class=nl>f010006b:</span>       <span class=nf>c7</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>08</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>    <span class=no>movl</span>   <span class=no>$0x0</span><span class=p>,</span><span class=mi>0x8</span><span class=p>(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nl>f0100072:</span>       <span class=err>00</span> 
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=nl>f0100073:</span>       <span class=nf>c7</span> <span class=mi>44</span> <span class=mi>24</span> <span class=mi>04</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>    <span class=no>movl</span>   <span class=no>$0x0</span><span class=p>,</span><span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=nl>f010007a:</span>       <span class=err>00</span> 
</span></span><span class=line><span class=ln>28</span><span class=cl>    <span class=nl>f010007b:</span>       <span class=nf>c7</span> <span class=mi>04</span> <span class=mi>24</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span> <span class=mi>00</span>    <span class=no>movl</span>   <span class=no>$0x0</span><span class=p>,(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=nl>f0100082:</span>       <span class=nf>e8</span> <span class=mi>18</span> <span class=mi>07</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>call</span>   <span class=mh>f010079f</span> <span class=p>&lt;</span><span class=no>mon_backtrace</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>            <span class=nf>cprintf</span><span class=p>(</span><span class=err>&#34;</span><span class=no>leaving</span> <span class=no>test_backtrace</span> <span class=nv>%d</span><span class=err>\</span><span class=no>n</span><span class=err>&#34;</span><span class=p>,</span> <span class=no>x</span><span class=p>)</span><span class=c1>;
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1></span>    <span class=nl>f0100087:</span>       <span class=err>89</span> <span class=err>5</span><span class=nf>c</span> <span class=mi>24</span> <span class=mi>04</span>             <span class=no>mov</span>    <span class=no>x</span><span class=p>,</span><span class=mi>0x4</span><span class=p>(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=nl>f010008b:</span>       <span class=nf>c7</span> <span class=mi>04</span> <span class=mi>24</span> <span class=no>fc</span> <span class=mi>18</span> <span class=mi>10</span> <span class=no>f0</span>    <span class=no>movl</span>   <span class=no>$0xf01018fc</span><span class=p>,(</span><span class=nv>%esp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=nl>f0100092:</span>       <span class=nf>e8</span> <span class=mi>9</span><span class=no>a</span> <span class=mi>08</span> <span class=mi>00</span> <span class=mi>00</span>          <span class=no>call</span>   <span class=mh>f0100931</span> <span class=p>&lt;</span><span class=no>cprintf</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=err>}</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=nl>f0100097:</span>       <span class=err>83</span> <span class=nf>c4</span> <span class=mi>14</span>                <span class=no>add</span>    <span class=no>$0x14</span><span class=p>,</span><span class=nv>%esp</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=nl>f010009a:</span>       <span class=err>5</span><span class=nf>b</span>                      <span class=no>pop</span>    <span class=no>x</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>    <span class=nl>f010009b:</span>       <span class=err>5</span><span class=nf>d</span>                      <span class=no>pop</span>    <span class=no>p</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>    <span class=nl>f010009c:</span>       <span class=nf>c3</span>                      <span class=no>ret</span>
</span></span></code></pre></div><p>åˆ†åˆ«æ˜¯å‚æ•°x,ebpå’Œebx. å‚æ•°xå’Œebpçš„å‹æ ˆæ˜¯å¸¸è§„æ“ä½œï¼Œå°±ä¸è§£é‡Šäº†ã€‚ebxçš„å‹æ ˆå¯èƒ½æœ‰äº›ç–‘é—®ï¼Œå¯ä»¥å‚è€ƒ<a href=https://stackoverflow.com/questions/9797335/why-are-these-registers-pushed-to-stack>Why are these registers pushed to stack?</a></p><p>ä¸‹ä¸€ä¸ªç»ƒä¹ :</p><blockquote>Exercise 11.Â Implement the backtrace function as specified above. Use the same format as in the example, since otherwise the grading script will be confused. When you think you have it working right, runÂ make gradeÂ to see if its output conforms to what our grading script expects, and fix it if it doesn't.Â _After_Â you have handed in your Lab 1 code, you are welcome to change the output format of the backtrace function any way you like.<p>If you useÂ <code>read_ebp()</code>, note that GCC may generate &ldquo;optimized&rdquo; code that callsÂ <code>read_ebp()</code>Â <em>before</em><code>mon_backtrace()</code>&rsquo;s function prologue, which results in an incomplete stack trace (the stack frame of the most recent function call is missing). While we have tried to disable optimizations that cause this reordering, you may want to examine the assembly ofÂ <code>mon_backtrace()</code>Â and make sure the call to<code>read_ebp()</code>Â is happening after the function prologue.</blockquote></p><p>è¿™ä¸ªç»ƒä¹ ä¸»è¦å‚è€ƒ<a href=https://111qqz.com/2019/01/x86-calling-conventions/>x86-calling-conventions</a>, ä¸»è¦æ˜¯éœ€è¦çŸ¥é“ebpçš„å†…å®¹æ˜¯ä¸Šä¸€ä¸ªstack frameä¸­çš„ebp,ä»¥åŠebp+4æ˜¯è¿”å›åœ°å€,ebp+8æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿˜æœ‰ebpçš„åˆå§‹å€¼æ˜¯0.</p><p>æœ€åçš„å®ç°ä¸º:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>    <span class=kt>int</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=nf>mon_backtrace</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>struct</span> <span class=n>Trapframe</span> <span class=o>*</span><span class=n>tf</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>            <span class=c1>// Your code here.
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>            <span class=kt>uint32_t</span> <span class=o>*</span><span class=n>ebp</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span><span class=p>)</span><span class=nf>read_ebp</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>            <span class=kt>int</span> <span class=n>i</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=n>ebp</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>                    <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;ebp x  eip x  &#34;</span><span class=p>,</span><span class=n>ebp</span><span class=p>,</span><span class=o>*</span><span class=p>(</span><span class=n>ebp</span><span class=o>+</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>                    <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;args&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>                    <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span> <span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>7</span> <span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>                            <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34; x&#34;</span><span class=p>,</span><span class=o>*</span><span class=p>(</span><span class=n>ebp</span><span class=o>+</span><span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>                    <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>                    <span class=n>ebp</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span><span class=p>)</span><span class=o>*</span><span class=n>ebp</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>ç„¶åæ˜¯æœ€åä¸€ä¸ªç»ƒä¹ :</p><blockquote>Exercise 12.Â Modify your stack backtrace function to display, for eachÂ eip, the function name, source file name, and line number corresponding to thatÂ eip.<p>InÂ <code>debuginfo_eip</code>, where doÂ _<em>STAB</em>*Â come from? This question has a long answer; to help you to discover the answer, here are some things you might want to do:</p><pre><code>  * look in the fileÂ kern/kernel.ldÂ forÂ __STAB_*
  * runÂ objdump -h obj/kern/kernel
  * runÂ objdump -G obj/kern/kernel
  * runÂ gcc -pipe -nostdinc -O2 -fno-builtin -I. -MD -Wall -Wno-format -DJOS_KERNEL -gstabs -c -S kern/init.c, and look at init.s.
  * see if the bootloader loads the symbol table in memory as part of loading the kernel binary
</code></pre><p>Complete the implementation ofÂ <code>debuginfo_eip</code>Â by inserting the call toÂ <code>stab_binsearch</code>Â to find the line number for an address.</p><p>Add aÂ backtraceÂ command to the kernel monitor, and extend your implementation ofÂ <code>mon_backtrace</code>Â to callÂ <code>debuginfo_eip</code>Â and print a line for each stack frame of the form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln>1</span><span class=cl> <span class=nf>K</span> <span class=no>backtrace</span>
</span></span><span class=line><span class=ln>2</span><span class=cl> <span class=nf>Stack</span> <span class=no>backtrace</span><span class=p>:</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>   <span class=nf>ebp</span> <span class=no>f010ff78</span>  <span class=no>eip</span> <span class=no>f01008ae</span>  <span class=no>args</span> <span class=mi>00000001</span> <span class=no>f010ff8c</span> <span class=mi>00000000</span> <span class=no>f0110580</span> <span class=mi>00000000</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>          <span class=nf>kern</span><span class=err>/</span><span class=no>monitor.c</span><span class=p>:</span><span class=mi>143</span><span class=p>:</span> <span class=no>monitor</span><span class=err>+</span><span class=mi>106</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>   <span class=nf>ebp</span> <span class=no>f010ffd8</span>  <span class=no>eip</span> <span class=no>f0100193</span>  <span class=no>args</span> <span class=mi>00000000</span> <span class=mi>00001</span><span class=no>aac</span> <span class=mi>00000660</span> <span class=mi>00000000</span> <span class=mi>00000000</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>          <span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>49</span><span class=p>:</span> <span class=no>i386_init</span><span class=err>+</span><span class=mi>59</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>   <span class=nf>ebp</span> <span class=no>f010fff8</span>  <span class=no>eip</span> <span class=no>f010003d</span>  <span class=no>args</span> <span class=mi>00000000</span> <span class=mi>00000000</span> <span class=mi>0000</span><span class=no>ffff</span> <span class=mi>10</span><span class=no>cf9a00</span> <span class=mi>0000</span><span class=no>ffff</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>          <span class=nf>kern</span><span class=err>/</span><span class=no>entry.S</span><span class=p>:</span><span class=mi>70</span><span class=p>:</span> <span class=err>&lt;</span><span class=no>unknown</span><span class=err>&gt;+</span><span class=mi>0</span>
</span></span><span class=line><span class=ln>9</span><span class=cl> <span class=nf>K</span> 
</span></span></code></pre></div><p>Each line gives the file name and line within that file of the stack frame&rsquo;sÂ eip, followed by the name of the function and the offset of theÂ eipÂ from the first instruction of the function (e.g.,Â monitor+106Â means the returnÂ eipÂ is 106 bytes past the beginning ofÂ monitor).</p><p>Be sure to print the file and function names on a separate line, to avoid confusing the grading script.</p><p>Tip: printf format strings provide an easy, albeit obscure, way to print non-null-terminated strings like those in STABS tables. <code>printf("%.*s", length, string)</code>Â prints at mostÂ <code>length</code>Â characters ofÂ <code>string</code>. Take a look at the printf man page to find out why this works.</p><p>You may find that some functions are missing from the backtrace. For example, you will probably see a call toÂ <code>monitor()</code>Â but not toÂ <code>runcmd()</code>. This is because the compiler in-lines some function calls. Other optimizations may cause you to see unexpected line numbers. If you get rid of theÂ -O2Â fromGNUMakefile, the backtraces may make more sense (but your kernel will run more slowly).</blockquote></p><p>éœ€è¦å…ˆäº†è§£ä¸€ä¸‹stab,ç®€å•æ¥è¯´æ˜¯ä¸€ç§è°ƒè¯•æ•°æ®æ ¼å¼ã€‚å…·ä½“å¯ä»¥å‚è€ƒ<a href=https://en.wikipedia.org/wiki/Stabs>stabs</a>Â å’ŒÂ <a href=https://www.ibm.com/developerworks/cn/opensource/os-debugging/>è°ƒè¯• DWARF å’Œ STAB æ ¼å¼</a>Â ã€‚</p><p>objdump -h obj/kern/kernelçš„è¾“å‡ºä¸º</p><pre><code>obj/kern/kernel:     file format elf32-i386

Sections:
Idx Name          Size      VMA       LMA       File off  Algn
  0 .text         00001937  f0100000  00100000  00001000  2**4
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
  1 .rodata       0000079c  f0101940  00101940  00002940  2**5
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  2 .stab         000038e9  f01020dc  001020dc  000030dc  2**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  3 .stabstr      000018f0  f01059c5  001059c5  000069c5  2**0
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  4 .data         0000a300  f0108000  00108000  00009000  2**12
                  CONTENTS, ALLOC, LOAD, DATA
  5 .bss          00000648  f0112300  00112300  00013300  2**5
                  CONTENTS, ALLOC, LOAD, DATA
  6 .comment      00000023  00000000  00000000  00013948  2**0
                  CONTENTS, READONLY
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°stabstræ®µçš„link address(VMA)ä¸ºf01059c5.</p><p>ç„¶åç”¨gdbè°ƒè¯•ï¼Œå…ˆæ–­ç‚¹åˆ°0x10000c,ä¹Ÿå°±æ˜¯bootloaderè®°è½½kernelçš„ä½ç½®ã€‚ç„¶åå†å•æ­¥æ‰§è¡Œå‡ æ­¥ï¼Œç›´åˆ°å¼€å¯ä¿æŠ¤æ¨¡å¼ã€‚æ­¤æ—¶æŸ¥çœ‹ åœ°å€f01059c5ï¼Œç»“æœå¦‚ä¸‹ï¼Œè¯´æ˜boot loaderåœ¨åŠ è½½kernelçš„åŒæ—¶ä¹Ÿå°†ç¬¦å·è¡¨åŠ è½½åˆ°äº†å†…å­˜ä¸­</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln>1</span><span class=cl><span class=err>(</span><span class=nf>gdb</span><span class=p>)</span> <span class=no>x</span><span class=err>/</span><span class=mi>8</span><span class=no>s</span> <span class=mi>0xf01059c5</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=err>0</span><span class=nl>xf01059c5:</span>     <span class=err>&#34;&#34;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=err>0</span><span class=nl>xf01059c6:</span>     <span class=err>&#34;{</span><span class=nf>standard</span> <span class=no>input</span><span class=err>}&#34;</span>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=err>0</span><span class=nl>xf01059d7:</span>     <span class=err>&#34;</span><span class=nf>kern</span><span class=err>/</span><span class=no>entry.S</span><span class=err>&#34;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=err>0</span><span class=nl>xf01059e4:</span>     <span class=err>&#34;</span><span class=nf>kern</span><span class=err>/</span><span class=no>entrypgdir.c</span><span class=err>&#34;</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=err>0</span><span class=nl>xf01059f6:</span>     <span class=err>&#34;</span><span class=nf>gcc2_compiled.</span><span class=err>&#34;</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=err>0</span><span class=nl>xf0105a05:</span>     <span class=err>&#34;</span><span class=nl>int:</span><span class=nf>t</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=err>=</span><span class=no>r</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=c1>;-2147483648;2147483647;&#34;
</span></span></span><span class=line><span class=ln>8</span><span class=cl><span class=c1></span><span class=err>0</span><span class=nl>xf0105a2f:</span>     <span class=err>&#34;</span><span class=nl>char:</span><span class=nf>t</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=err>=</span><span class=no>r</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=c1>;0;127;&#34;
</span></span></span><span class=line><span class=ln>9</span><span class=cl><span class=c1></span><span class=err>0</span><span class=nl>xf0105a49:</span>     <span class=err>&#34;</span><span class=nf>long</span> <span class=no>int</span><span class=p>:</span><span class=no>t</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span><span class=err>=</span><span class=no>r</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span><span class=c1>;-2147483648;2147483647;&#34;
</span></span></span></code></pre></div><p>æ¥ä¸‹æ¥å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬è¦è¡¥å…¨çš„kern/kdebug.cæ–‡ä»¶</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>  1</span><span class=cl>    <span class=kt>int</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>    <span class=nf>debuginfo_eip</span><span class=p>(</span><span class=kt>uintptr_t</span> <span class=n>addr</span><span class=p>,</span> <span class=k>struct</span> <span class=n>Eipdebuginfo</span> <span class=o>*</span><span class=n>info</span><span class=p>)</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl>    	<span class=k>const</span> <span class=k>struct</span> <span class=n>Stab</span> <span class=o>*</span><span class=n>stabs</span><span class=p>,</span> <span class=o>*</span><span class=n>stab_end</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>    	<span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>stabstr</span><span class=p>,</span> <span class=o>*</span><span class=n>stabstr_end</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>    	<span class=kt>int</span> <span class=n>lfile</span><span class=p>,</span> <span class=n>rfile</span><span class=p>,</span> <span class=n>lfun</span><span class=p>,</span> <span class=n>rfun</span><span class=p>,</span> <span class=n>lline</span><span class=p>,</span> <span class=n>rline</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>    
</span></span><span class=line><span class=ln>  8</span><span class=cl>    	<span class=c1>// Initialize *info
</span></span></span><span class=line><span class=ln>  9</span><span class=cl><span class=c1></span>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_file</span> <span class=o>=</span> <span class=s>&#34;&lt;unknown&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_line</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_name</span> <span class=o>=</span> <span class=s>&#34;&lt;unknown&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_namelen</span> <span class=o>=</span> <span class=mi>9</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_addr</span> <span class=o>=</span> <span class=n>addr</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_narg</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>    
</span></span><span class=line><span class=ln> 16</span><span class=cl>    	<span class=c1>// Find the relevant set of stabs
</span></span></span><span class=line><span class=ln> 17</span><span class=cl><span class=c1></span>    	<span class=k>if</span> <span class=p>(</span><span class=n>addr</span> <span class=o>&gt;=</span> <span class=n>ULIM</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>    		<span class=n>stabs</span> <span class=o>=</span> <span class=n>__STAB_BEGIN__</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 19</span><span class=cl>    		<span class=n>stab_end</span> <span class=o>=</span> <span class=n>__STAB_END__</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>    		<span class=n>stabstr</span> <span class=o>=</span> <span class=n>__STABSTR_BEGIN__</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>    		<span class=n>stabstr_end</span> <span class=o>=</span> <span class=n>__STABSTR_END__</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>    	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>    		<span class=c1>// Can&#39;t search for user-level addresses yet!
</span></span></span><span class=line><span class=ln> 24</span><span class=cl><span class=c1></span>      	        <span class=nf>panic</span><span class=p>(</span><span class=s>&#34;User address&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>    	<span class=p>}</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>    
</span></span><span class=line><span class=ln> 27</span><span class=cl>    	<span class=c1>// String table validity checks
</span></span></span><span class=line><span class=ln> 28</span><span class=cl><span class=c1></span>    	<span class=k>if</span> <span class=p>(</span><span class=n>stabstr_end</span> <span class=o>&lt;=</span> <span class=n>stabstr</span> <span class=o>||</span> <span class=n>stabstr_end</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>    		<span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>    
</span></span><span class=line><span class=ln> 31</span><span class=cl>    	<span class=c1>// Now we find the right stabs that define the function containing
</span></span></span><span class=line><span class=ln> 32</span><span class=cl><span class=c1></span>    	<span class=c1>// &#39;eip&#39;.  First, we find the basic source file containing &#39;eip&#39;.
</span></span></span><span class=line><span class=ln> 33</span><span class=cl><span class=c1></span>    	<span class=c1>// Then, we look in that source file for the function.  Then we look
</span></span></span><span class=line><span class=ln> 34</span><span class=cl><span class=c1></span>    	<span class=c1>// for the line number.
</span></span></span><span class=line><span class=ln> 35</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 36</span><span class=cl>    	<span class=c1>// Search the entire set of stabs for the source file (type N_SO).
</span></span></span><span class=line><span class=ln> 37</span><span class=cl><span class=c1></span>    	<span class=n>lfile</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>    	<span class=n>rfile</span> <span class=o>=</span> <span class=p>(</span><span class=n>stab_end</span> <span class=o>-</span> <span class=n>stabs</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>    	<span class=nf>stab_binsearch</span><span class=p>(</span><span class=n>stabs</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>lfile</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>rfile</span><span class=p>,</span> <span class=n>N_SO</span><span class=p>,</span> <span class=n>addr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>    	<span class=k>if</span> <span class=p>(</span><span class=n>lfile</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>    		<span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>    
</span></span><span class=line><span class=ln> 43</span><span class=cl>    	<span class=c1>// Search within that file&#39;s stabs for the function definition
</span></span></span><span class=line><span class=ln> 44</span><span class=cl><span class=c1></span>    	<span class=c1>// (N_FUN).
</span></span></span><span class=line><span class=ln> 45</span><span class=cl><span class=c1></span>    	<span class=n>lfun</span> <span class=o>=</span> <span class=n>lfile</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>    	<span class=n>rfun</span> <span class=o>=</span> <span class=n>rfile</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>    	<span class=nf>stab_binsearch</span><span class=p>(</span><span class=n>stabs</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>lfun</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>rfun</span><span class=p>,</span> <span class=n>N_FUN</span><span class=p>,</span> <span class=n>addr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl>    
</span></span><span class=line><span class=ln> 49</span><span class=cl>    	<span class=k>if</span> <span class=p>(</span><span class=n>lfun</span> <span class=o>&lt;=</span> <span class=n>rfun</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>    		<span class=c1>// stabs[lfun] points to the function name
</span></span></span><span class=line><span class=ln> 51</span><span class=cl><span class=c1></span>    		<span class=c1>// in the string table, but check bounds just in case.
</span></span></span><span class=line><span class=ln> 52</span><span class=cl><span class=c1></span>    		<span class=k>if</span> <span class=p>(</span><span class=n>stabs</span><span class=p>[</span><span class=n>lfun</span><span class=p>].</span><span class=n>n_strx</span> <span class=o>&lt;</span> <span class=n>stabstr_end</span> <span class=o>-</span> <span class=n>stabstr</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>    			<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_name</span> <span class=o>=</span> <span class=n>stabstr</span> <span class=o>+</span> <span class=n>stabs</span><span class=p>[</span><span class=n>lfun</span><span class=p>].</span><span class=n>n_strx</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>    		<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_addr</span> <span class=o>=</span> <span class=n>stabs</span><span class=p>[</span><span class=n>lfun</span><span class=p>].</span><span class=n>n_value</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>    		<span class=n>addr</span> <span class=o>-=</span> <span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_addr</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl>    		<span class=c1>// Search within the function definition for the line number.
</span></span></span><span class=line><span class=ln> 57</span><span class=cl><span class=c1></span>    		<span class=n>lline</span> <span class=o>=</span> <span class=n>lfun</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>    		<span class=n>rline</span> <span class=o>=</span> <span class=n>rfun</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>    	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>    		<span class=c1>// Couldn&#39;t find function stab!  Maybe we&#39;re in an assembly
</span></span></span><span class=line><span class=ln> 61</span><span class=cl><span class=c1></span>    		<span class=c1>// file.  Search the whole file for the line number.
</span></span></span><span class=line><span class=ln> 62</span><span class=cl><span class=c1></span>    		<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_addr</span> <span class=o>=</span> <span class=n>addr</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>    		<span class=n>lline</span> <span class=o>=</span> <span class=n>lfile</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>    		<span class=n>rline</span> <span class=o>=</span> <span class=n>rfile</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>    	<span class=p>}</span>
</span></span><span class=line><span class=ln> 66</span><span class=cl>    	<span class=c1>// Ignore stuff after the colon.
</span></span></span><span class=line><span class=ln> 67</span><span class=cl><span class=c1></span>    	<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_namelen</span> <span class=o>=</span> <span class=nf>strfind</span><span class=p>(</span><span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_name</span><span class=p>,</span> <span class=sc>&#39;:&#39;</span><span class=p>)</span> <span class=o>-</span> <span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_name</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>    
</span></span><span class=line><span class=ln> 69</span><span class=cl>    
</span></span><span class=line><span class=ln> 70</span><span class=cl>    	<span class=c1>// Search within [lline, rline] for the line number stab.
</span></span></span><span class=line><span class=ln> 71</span><span class=cl><span class=c1></span>    	<span class=c1>// If found, set info-&gt;eip_line to the right line number.
</span></span></span><span class=line><span class=ln> 72</span><span class=cl><span class=c1></span>    	<span class=c1>// If not found, return -1.
</span></span></span><span class=line><span class=ln> 73</span><span class=cl><span class=c1></span>    	<span class=c1>//
</span></span></span><span class=line><span class=ln> 74</span><span class=cl><span class=c1></span>    	<span class=c1>// Hint:
</span></span></span><span class=line><span class=ln> 75</span><span class=cl><span class=c1></span>    	<span class=c1>//	There&#39;s a particular stabs type used for line numbers.
</span></span></span><span class=line><span class=ln> 76</span><span class=cl><span class=c1></span>    	<span class=c1>//	Look at the STABS documentation and &lt;inc/stab.h to find
</span></span></span><span class=line><span class=ln> 77</span><span class=cl><span class=c1></span>    	<span class=c1>//	which one.
</span></span></span><span class=line><span class=ln> 78</span><span class=cl><span class=c1></span>    	<span class=c1>//   use N_SLINE
</span></span></span><span class=line><span class=ln> 79</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 80</span><span class=cl>    	<span class=c1>// Your code here.
</span></span></span><span class=line><span class=ln> 81</span><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=ln> 82</span><span class=cl>    
</span></span><span class=line><span class=ln> 83</span><span class=cl>    
</span></span><span class=line><span class=ln> 84</span><span class=cl>    
</span></span><span class=line><span class=ln> 85</span><span class=cl>    
</span></span><span class=line><span class=ln> 86</span><span class=cl>    	<span class=c1>// Search backwards from the line number for the relevant filename
</span></span></span><span class=line><span class=ln> 87</span><span class=cl><span class=c1></span>    	<span class=c1>// stab.
</span></span></span><span class=line><span class=ln> 88</span><span class=cl><span class=c1></span>    	<span class=c1>// We can&#39;t just use the &#34;lfile&#34; stab because inlined functions
</span></span></span><span class=line><span class=ln> 89</span><span class=cl><span class=c1></span>    	<span class=c1>// can interpolate code from a different file!
</span></span></span><span class=line><span class=ln> 90</span><span class=cl><span class=c1></span>    	<span class=c1>// Such included source files use the N_SOL stab type.
</span></span></span><span class=line><span class=ln> 91</span><span class=cl><span class=c1></span>    	<span class=k>while</span> <span class=p>(</span><span class=n>lline</span> <span class=o>&gt;=</span> <span class=n>lfile</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>    	       <span class=o>&amp;&amp;</span> <span class=n>stabs</span><span class=p>[</span><span class=n>lline</span><span class=p>].</span><span class=n>n_type</span> <span class=o>!=</span> <span class=n>N_SOL</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>    	       <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>stabs</span><span class=p>[</span><span class=n>lline</span><span class=p>].</span><span class=n>n_type</span> <span class=o>!=</span> <span class=n>N_SO</span> <span class=o>||</span> <span class=o>!</span><span class=n>stabs</span><span class=p>[</span><span class=n>lline</span><span class=p>].</span><span class=n>n_value</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>    		<span class=n>lline</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>    	<span class=k>if</span> <span class=p>(</span><span class=n>lline</span> <span class=o>&gt;=</span> <span class=n>lfile</span> <span class=o>&amp;&amp;</span> <span class=n>stabs</span><span class=p>[</span><span class=n>lline</span><span class=p>].</span><span class=n>n_strx</span> <span class=o>&lt;</span> <span class=n>stabstr_end</span> <span class=o>-</span> <span class=n>stabstr</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>    		<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_file</span> <span class=o>=</span> <span class=n>stabstr</span> <span class=o>+</span> <span class=n>stabs</span><span class=p>[</span><span class=n>lline</span><span class=p>].</span><span class=n>n_strx</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>    
</span></span><span class=line><span class=ln> 98</span><span class=cl>    
</span></span><span class=line><span class=ln> 99</span><span class=cl>    	<span class=c1>// Set eip_fn_narg to the number of arguments taken by the function,
</span></span></span><span class=line><span class=ln>100</span><span class=cl><span class=c1></span>    	<span class=c1>// or 0 if there was no containing function.
</span></span></span><span class=line><span class=ln>101</span><span class=cl><span class=c1></span>    	<span class=k>if</span> <span class=p>(</span><span class=n>lfun</span> <span class=o>&lt;</span> <span class=n>rfun</span><span class=p>)</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>    		<span class=k>for</span> <span class=p>(</span><span class=n>lline</span> <span class=o>=</span> <span class=n>lfun</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>    		     <span class=n>lline</span> <span class=o>&lt;</span> <span class=n>rfun</span> <span class=o>&amp;&amp;</span> <span class=n>stabs</span><span class=p>[</span><span class=n>lline</span><span class=p>].</span><span class=n>n_type</span> <span class=o>==</span> <span class=n>N_PSYM</span><span class=p>;</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>    		     <span class=n>lline</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>    			<span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_fn_narg</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>106</span><span class=cl>    
</span></span><span class=line><span class=ln>107</span><span class=cl>    	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>109</span><span class=cl>
</span></span><span class=line><span class=ln>110</span><span class=cl><span class=err>```</span><span class=n>c</span>
</span></span><span class=line><span class=ln>111</span><span class=cl><span class=err>å‘ç°è¦è¡¥å…¨çš„åœ°æ–¹</span><span class=p>...</span><span class=err>å…¶å®å¾ˆå®¹æ˜“å†™ï¼Ÿ</span> <span class=err>å› ä¸ºåœ¨è¦è¡¥å…¨çš„äºŒåˆ†ä¹‹å‰ï¼Œå·²ç»åšäº†ä¸¤æ¬¡äºŒåˆ†</span><span class=p>...</span><span class=err>ç…§ç€å†™ä¸€ä¸‹å°±å¥½äº†ã€‚</span>
</span></span><span class=line><span class=ln>112</span><span class=cl>
</span></span><span class=line><span class=ln>113</span><span class=cl><span class=err>```</span><span class=n>c</span>    
</span></span><span class=line><span class=ln>114</span><span class=cl>            <span class=nf>stab_binsearch</span><span class=p>(</span><span class=n>stabs</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>lline</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>rline</span><span class=p>,</span> <span class=n>N_SLINE</span><span class=p>,</span> <span class=n>addr</span><span class=p>);</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>lline</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>116</span><span class=cl>            <span class=n>info</span><span class=o>-&gt;</span><span class=n>eip_line</span> <span class=o>=</span> <span class=n>stabs</span><span class=p>[</span><span class=n>rline</span><span class=p>].</span><span class=n>n_desc</span><span class=p>;</span>
</span></span></code></pre></div><p>ç„¶åå°±æ˜¯åœ¨monitor.cä¸­ä¿®æ”¹monitor.cä¸­ï¼Œè°ƒç”¨debuginfo_eipï¼Œè¿™éƒ¨åˆ†ä¹Ÿå¾ˆå®¹æ˜“ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl>    
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=kt>int</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=nf>mon_backtrace</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>struct</span> <span class=n>Trapframe</span> <span class=o>*</span><span class=n>tf</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>            <span class=c1>// Your code here.
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>            <span class=kt>uint32_t</span> <span class=o>*</span><span class=n>ebp</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span><span class=p>)</span><span class=nf>read_ebp</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>            <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;Stack backtrace:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>            <span class=kt>int</span> <span class=n>i</span> <span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>            <span class=k>struct</span> <span class=n>Eipdebuginfo</span> <span class=n>info</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>            <span class=k>while</span> <span class=p>(</span><span class=n>ebp</span><span class=p>)</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>                    <span class=kt>uint32_t</span> <span class=n>eip</span> <span class=o>=</span> <span class=n>ebp</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>                    <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;ebp x  eip x  &#34;</span><span class=p>,</span><span class=n>ebp</span><span class=p>,</span><span class=n>eip</span><span class=p>);</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>                    <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;args&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>                    <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span> <span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>7</span> <span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>                            <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34; x&#34;</span><span class=p>,</span><span class=o>*</span><span class=p>(</span><span class=n>ebp</span><span class=o>+</span><span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>                    <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>                    <span class=kt>int</span> <span class=n>status</span> <span class=o>=</span> <span class=nf>debuginfo_eip</span><span class=p>(</span><span class=n>eip</span><span class=p>,</span><span class=o>&amp;</span><span class=n>info</span><span class=p>);</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>status</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>                    <span class=p>{</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>     
</span></span><span class=line><span class=ln>24</span><span class=cl>                      <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;%s:%d: &#34;</span><span class=p>,</span><span class=n>info</span><span class=p>.</span><span class=n>eip_file</span><span class=p>,</span><span class=n>info</span><span class=p>.</span><span class=n>eip_line</span><span class=p>);</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>                      <span class=nf>cprintf</span><span class=p>(</span><span class=s>&#34;%.*s+%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>info</span><span class=p>.</span><span class=n>eip_fn_namelen</span><span class=p>,</span><span class=n>info</span><span class=p>.</span><span class=n>eip_fn_name</span><span class=p>,</span><span class=n>eip</span><span class=o>-</span><span class=n>info</span><span class=p>.</span><span class=n>eip_fn_addr</span><span class=p>);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>                    <span class=n>ebp</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span><span class=p>)</span><span class=o>*</span><span class=n>ebp</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    
</span></span><span class=line><span class=ln>30</span><span class=cl>    
</span></span><span class=line><span class=ln>31</span><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>æœ€ç»ˆæ•ˆæœå¤§æ¦‚å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=ln> 1</span><span class=cl><span class=nf>entering</span> <span class=no>test_backtrace</span> <span class=mi>5</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=nf>entering</span> <span class=no>test_backtrace</span> <span class=mi>4</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=nf>entering</span> <span class=no>test_backtrace</span> <span class=mi>3</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=nf>entering</span> <span class=no>test_backtrace</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=nf>entering</span> <span class=no>test_backtrace</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=nf>entering</span> <span class=no>test_backtrace</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=nf>Stack</span> <span class=no>backtrace</span><span class=p>:</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110ec8</span>  <span class=no>eip</span> <span class=no>f0100b09</span>  <span class=no>args</span> <span class=no>f0102499</span> <span class=no>f0102499</span> <span class=no>f0100b09</span> <span class=mi>00000000</span> <span class=no>f0100d9c</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>monitor.c</span><span class=p>:</span><span class=mi>66</span><span class=p>:</span> <span class=no>mon_backtrace</span><span class=err>+</span><span class=mi>26</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110f18</span>  <span class=no>eip</span> <span class=no>f010008b</span>  <span class=no>args</span> <span class=mi>00000000</span> <span class=mi>00000000</span> <span class=mi>00000000</span> <span class=mi>00000000</span> <span class=no>f0102238</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>19</span><span class=p>:</span> <span class=no>test_backtrace</span><span class=err>+</span><span class=mi>75</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110f38</span>  <span class=no>eip</span> <span class=no>f010006d</span>  <span class=no>args</span> <span class=mi>00000000</span> <span class=mi>00000001</span> <span class=no>f0110f64</span> <span class=mi>00000000</span> <span class=no>f0102238</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span> <span class=no>test_backtrace</span><span class=err>+</span><span class=mi>45</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110f58</span>  <span class=no>eip</span> <span class=no>f010006d</span>  <span class=no>args</span> <span class=mi>00000001</span> <span class=mi>00000002</span> <span class=no>f0110f84</span> <span class=mi>00000000</span> <span class=no>f0102238</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span> <span class=no>test_backtrace</span><span class=err>+</span><span class=mi>45</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110f78</span>  <span class=no>eip</span> <span class=no>f010006d</span>  <span class=no>args</span> <span class=mi>00000002</span> <span class=mi>00000003</span> <span class=no>f0110fa4</span> <span class=mi>00000000</span> <span class=no>f0102238</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span> <span class=no>test_backtrace</span><span class=err>+</span><span class=mi>45</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110f98</span>  <span class=no>eip</span> <span class=no>f010006d</span>  <span class=no>args</span> <span class=mi>00000003</span> <span class=mi>00000004</span> <span class=no>f0110fc4</span> <span class=mi>00000000</span> <span class=no>f010226f</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span> <span class=no>test_backtrace</span><span class=err>+</span><span class=mi>45</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110fb8</span>  <span class=no>eip</span> <span class=no>f010006d</span>  <span class=no>args</span> <span class=mi>00000004</span> <span class=mi>00000005</span> <span class=no>f0110fe4</span> <span class=mi>00000000</span> <span class=mi>00000000</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>16</span><span class=p>:</span> <span class=no>test_backtrace</span><span class=err>+</span><span class=mi>45</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110fd8</span>  <span class=no>eip</span> <span class=no>f01000f1</span>  <span class=no>args</span> <span class=mi>00000005</span> <span class=mi>00001</span><span class=no>aac</span> <span class=mi>00000640</span> <span class=mi>00000000</span> <span class=mi>00000000</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>init.c</span><span class=p>:</span><span class=mi>43</span><span class=p>:</span> <span class=no>i386_init</span><span class=err>+</span><span class=mi>81</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=nf>ebp</span> <span class=no>f0110ff8</span>  <span class=no>eip</span> <span class=no>f010003e</span>  <span class=no>args</span> <span class=mi>00000003</span> <span class=mi>00001003</span> <span class=mi>00002003</span> <span class=mi>00003003</span> <span class=mi>00004003</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=nf>kern</span><span class=err>/</span><span class=no>entry.S</span><span class=p>:</span><span class=mi>83</span><span class=p>:</span> <span class=err>&lt;</span><span class=no>unknown</span><span class=err>&gt;+</span><span class=mi>0</span>
</span></span><span class=line><span class=ln>26</span><span class=cl><span class=nf>leaving</span> <span class=no>test_backtrace</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=nf>leaving</span> <span class=no>test_backtrace</span> <span class=mi>1</span>
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=nf>leaving</span> <span class=no>test_backtrace</span> <span class=mi>2</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=nf>leaving</span> <span class=no>test_backtrace</span> <span class=mi>3</span>
</span></span><span class=line><span class=ln>30</span><span class=cl><span class=nf>leaving</span> <span class=no>test_backtrace</span> <span class=mi>4</span>
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=nf>leaving</span> <span class=no>test_backtrace</span> <span class=mi>5</span>
</span></span><span class=line><span class=ln>32</span><span class=cl><span class=nf>Welcome</span> <span class=no>to</span> <span class=no>the</span> <span class=no>JOS</span> <span class=no>kernel</span> <span class=no>monitor</span><span class=p>!</span>
</span></span></code></pre></div><p>å¦‚æœæœ‰äº›å‡½æ•°æ²¡æœ‰å‡ºç°åœ¨ä¸Šé¢ï¼Œå¯èƒ½æ˜¯è¢«ä¼˜åŒ–æ‰äº†ï¼Œè¯•ç€ä¿®æ”¹makefileä¸­çš„ç¼–è¯‘é€‰é¡¹ï¼ŒæŠŠO2æˆ–è€…O1ä¿®æ”¹ä¸ºO0ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†lab1çš„å…¨éƒ¨å†…å®¹ã€‚å®Œç»“æ’’èŠ±ï½</p><p>è™½ç„¶åšäº†ä¸‰åä¸ªå°æ—¶&mldr;ä¸è¿‡çœŸçš„æ”¶è·è›®å¤šï¼Œæ„Ÿè§‰åƒæ˜¯åœ¨ç©è§£è°œæ¸¸æˆï¼Œçº¿ç´¢å°±æ˜¯æ¯ä¸ªç»ƒä¹ å‰åçš„é‚£äº›é—®é¢˜ã€‚</p><p><a href="http://dict.youdao.com/search?q=routline&amp;keyfrom=chrome.extension">routline</a>Â <a href="http://www.youdao.com/search?q=routline&amp;ue=utf8&amp;keyfrom=chrome.extension">è¯¦ç»†</a>X</p><p>Â Â æ²¡æœ‰è‹±æ±‰äº’è¯‘ç»“æœ
<a href="http://www.youdao.com/search?q=routline&amp;ue=utf8&amp;keyfrom=chrome.extension">è¯·å°è¯•ç½‘é¡µæœç´¢</a></p></div><div class=post_comments><script src=https://giscus.app/client.js data-repo=111qqz/111qqz.github.io data-repo-id='MDEwOlJlcG9zaXRvcnkxODYwNDY3NTQ=' data-category=Announcements data-category-id=DIC_kwDOCxbZIs4C3Y8D data-mapping=pathname data-strict=1 data-reactions-enabled=1 data-emit-metadata=1 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></div></article><aside class=sidebar><section class=sidebar_inner><h2>111qqz</h2><div class=author_bio>ex-ICPCer@HUST, engineer@Tencent</div><a href=https://111qqz.com/top/about/ class="button mt-1" role=button title=é˜…è¯»æ›´å¤š>é˜…è¯»æ›´å¤š</a><h2 class=mt-4>æœ€æ–°æ–‡ç« </h2><ul class=flex-column><li><a href=https://111qqz.com/2020/06caffe-notes/ class=nav-link title="caffe æºç é˜…è¯»ç¬”è®°">caffe æºç é˜…è¯»ç¬”è®°</a></li><li><a href=https://111qqz.com/2023/12cupy-torch-import-order-impact/ class=nav-link title="[æ–½å·¥ä¸­] cupyä¸torchçš„å¯¼å…¥é¡ºåºä¸åŒå¯¹è®¡ç®—ç»“æœçš„å½±å“">[æ–½å·¥ä¸­] cupyä¸torchçš„å¯¼å…¥é¡ºåºä¸åŒå¯¹è®¡ç®—ç»“æœçš„å½±å“</a></li><li><a href=https://111qqz.com/2023/01build-onnxruntime-with-bazel/ class=nav-link title="Build Onnxruntime With Bazel">Build Onnxruntime With Bazel</a></li><li><a href=https://111qqz.com/2022/12Specify-User-to-Run-Docker-Executor-in-Gitlab-Ci/ class=nav-link title="ã€æ–½å·¥ä¸­ã€‘gitlab ci docker executoræŒ‡å®šç”¨æˆ·æ‰§è¡Œ">ã€æ–½å·¥ä¸­ã€‘gitlab ci docker executoræŒ‡å®šç”¨æˆ·æ‰§è¡Œ</a></li><li><a href=https://111qqz.com/2022/08caffe-source-code-analysis-part12/ class=nav-link title="[æ–½å·¥ä¸­]caffe æºç å­¦ä¹ ç¬”è®°(11) softmax">[æ–½å·¥ä¸­]caffe æºç å­¦ä¹ ç¬”è®°(11) softmax</a></li><li><a href=https://111qqz.com/2022/04cpp-value-categories/ class=nav-link title="æµ…è°ˆ Cpp Value Categories">æµ…è°ˆ Cpp Value Categories</a></li><li><a href=https://111qqz.com/2022/04redis-notes/ class=nav-link title=rediså­¦ä¹ ç¬”è®°>rediså­¦ä¹ ç¬”è®°</a></li><li><a href=https://111qqz.com/2022/03ledeldb-notes-06/ class=nav-link title="[æ–½å·¥ä¸­] levelDB ä»£ç é˜…è¯»ç¬”è®° 06 iterator">[æ–½å·¥ä¸­] levelDB ä»£ç é˜…è¯»ç¬”è®° 06 iterator</a></li><li><a href=https://111qqz.com/2022/03ledeldb-notes-05/ class=nav-link title="levelDB ä»£ç é˜…è¯»ç¬”è®° 05 arena">levelDB ä»£ç é˜…è¯»ç¬”è®° 05 arena</a></li><li><a href=https://111qqz.com/2022/03ledeldb-notes-04/ class=nav-link title="levelDB ä»£ç é˜…è¯»ç¬”è®° 04 filter">levelDB ä»£ç é˜…è¯»ç¬”è®° 04 filter</a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>åˆ†ç±»</h2><nav class=tags_nav><a href=https://111qqz.com/categories/acm/ class="post_tag button button_translucent" title=acm>ACM
<span class=button_tally>913</span>
</a><a href=https://111qqz.com/categories/%E5%85%B6%E4%BB%96/ class="post_tag button button_translucent" title=å…¶ä»–>å…¶ä»–
<span class=button_tally>90</span>
</a><a href=https://111qqz.com/categories/deep-learning/ class="post_tag button button_translucent" title=deep-learning>DEEP-LEARNING
<span class=button_tally>68</span>
</a><a href=https://111qqz.com/categories/%E9%9D%A2%E8%AF%95/ class="post_tag button button_translucent" title=é¢è¯•>é¢è¯•
<span class=button_tally>63</span>
</a><a href=https://111qqz.com/categories/%E5%B7%A5%E7%A8%8B/ class="post_tag button button_translucent" title=å·¥ç¨‹>å·¥ç¨‹
<span class=button_tally>59</span>
</a><a href=https://111qqz.com/categories/%E9%9A%8F%E7%AC%94%E6%9D%82%E8%B0%88/ class="post_tag button button_translucent" title=éšç¬”æ‚è°ˆ>éšç¬”æ‚è°ˆ
<span class=button_tally>55</span>
</a><a href=https://111qqz.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/ class="post_tag button button_translucent" title=è®¡ç®—æœºè§†è§‰>è®¡ç®—æœºè§†è§‰
<span class=button_tally>21</span>
</a><a href=https://111qqz.com/categories/mooc/ class="post_tag button button_translucent" title=mooc>MOOC
<span class=button_tally>15</span>
</a><a href=https://111qqz.com/categories/%E4%BC%98%E5%8C%96/ class="post_tag button button_translucent" title=ä¼˜åŒ–>ä¼˜åŒ–
<span class=button_tally>10</span>
</a><a href=https://111qqz.com/categories/c++/ class="post_tag button button_translucent" title=c++>C++
<span class=button_tally>4</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=series-section>ä¸“æ </h2><nav class=tags_nav><a href=https://111qqz.com/series/caffe%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/ class="post_tag button button_translucent" title=caffeæºç é˜…è¯»ç¬”è®°>CAFFEæºç é˜…è¯»ç¬”è®°
<span class=button_tally>13</span>
</a><a href=https://111qqz.com/series/leveldb%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/ class="post_tag button button_translucent" title=leveldbä»£ç é˜…è¯»ç¬”è®°>LEVELDBä»£ç é˜…è¯»ç¬”è®°
<span class=button_tally>9</span>
</a><a href=https://111qqz.com/series/csapp/ class="post_tag button button_translucent" title=csapp>CSAPP
<span class=button_tally>7</span>
</a><a href=https://111qqz.com/series/cpp-faq/ class="post_tag button button_translucent" title="cpp faq">CPP FAQ
<span class=button_tally>1</span>
</a><a href=https://111qqz.com/series/modern-cpp/ class="post_tag button button_translucent" title="modern cpp">MODERN CPP
<span class=button_tally>1</span></a></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>æ ‡ç­¾</h2><nav class=tags_nav><a href=https://111qqz.com/tags/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/ class="post_tag button button_translucent" title=ç®—æ³•ç«èµ›>ç®—æ³•ç«èµ›
<span class=button_tally>236</span>
</a><a href=https://111qqz.com/tags/dp/ class="post_tag button button_translucent" title=dp>DP
<span class=button_tally>73</span>
</a><a href=https://111qqz.com/tags/math/ class="post_tag button button_translucent" title=math>MATH
<span class=button_tally>49</span>
</a><a href=https://111qqz.com/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/ class="post_tag button button_translucent" title=çº¿æ®µæ ‘>çº¿æ®µæ ‘
<span class=button_tally>43</span>
</a><a href=https://111qqz.com/tags/brute-force/ class="post_tag button button_translucent" title="brute force">BRUTE FORCE
<span class=button_tally>39</span>
</a><a href=https://111qqz.com/tags/leetcode/ class="post_tag button button_translucent" title=leetcode>LEETCODE
<span class=button_tally>39</span>
</a><a href=https://111qqz.com/tags/greedy/ class="post_tag button button_translucent" title=greedy>GREEDY
<span class=button_tally>36</span>
</a><a href=https://111qqz.com/tags/dfs/ class="post_tag button button_translucent" title=dfs>DFS
<span class=button_tally>34</span>
</a><a href=https://111qqz.com/tags/number-theory/ class="post_tag button button_translucent" title="number theory">NUMBER THEORY
<span class=button_tally>27</span>
</a><a href=https://111qqz.com/tags/cpp/ class="post_tag button button_translucent" title=cpp>CPP
<span class=button_tally>26</span>
</a><a href=https://111qqz.com/tags/%E6%A8%A1%E6%8B%9F/ class="post_tag button button_translucent" title=æ¨¡æ‹Ÿ>æ¨¡æ‹Ÿ
<span class=button_tally>24</span>
</a><a href=https://111qqz.com/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/ class="post_tag button button_translucent" title=åšå¼ˆè®º>åšå¼ˆè®º
<span class=button_tally>22</span>
</a><a href=https://111qqz.com/tags/%E6%9E%84%E9%80%A0/ class="post_tag button button_translucent" title=æ„é€ >æ„é€ 
<span class=button_tally>22</span>
</a><a href=https://111qqz.com/tags/binary-search/ class="post_tag button button_translucent" title="binary search">BINARY SEARCH
<span class=button_tally>21</span>
</a><a href=https://111qqz.com/tags/%E6%AF%8D%E5%87%BD%E6%95%B0/ class="post_tag button button_translucent" title=æ¯å‡½æ•°>æ¯å‡½æ•°
<span class=button_tally>21</span></a><br><div class="post_tags_toggle button">æ‰€æœ‰æ ‡ç­¾</div><div class=post_tags><div class=tags_list><a href=https://111qqz.com/tags/01%E8%83%8C%E5%8C%85/ class="post_tag button button_translucent" data-position=9 title=01èƒŒåŒ…>01èƒŒåŒ…<span class=button_tally>9</span>
</a><a href=https://111qqz.com/tags/2-sat/ class="post_tag button button_translucent" data-position=1 title=2-sat>2-SAT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/6.828/ class="post_tag button button_translucent" data-position=4 title=6.828>6.828<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/acm/ class="post_tag button button_translucent" data-position=2 title=acm>ACM<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/ac%E8%87%AA%E5%8A%A8%E6%9C%BA/ class="post_tag button button_translucent" data-position=3 title=acè‡ªåŠ¨æœº>ACè‡ªåŠ¨æœº<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/anaconda/ class="post_tag button button_translucent" data-position=1 title=anaconda>ANACONDA<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/anchor-box/ class="post_tag button button_translucent" data-position=1 title="anchor box">ANCHOR BOX<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/anti-sg/ class="post_tag button button_translucent" data-position=2 title=anti-sg>ANTI-SG<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/archlinux/ class="post_tag button button_translucent" data-position=2 title=archlinux>ARCHLINUX<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/async/ class="post_tag button button_translucent" data-position=1 title=async>ASYNC<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/atom/ class="post_tag button button_translucent" data-position=1 title=atom>ATOM<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/avx/ class="post_tag button button_translucent" data-position=1 title=avx>AVX<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/awk/ class="post_tag button button_translucent" data-position=1 title=awk>AWK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/bazel/ class="post_tag button button_translucent" data-position=1 title=bazel>BAZEL<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/bfs/ class="post_tag button button_translucent" data-position=20 title=bfs>BFS<span class=button_tally>20</span>
</a><a href=https://111qqz.com/tags/binary-search/ class="post_tag button button_translucent" data-position=21 title="binary search">BINARY SEARCH<span class=button_tally>21</span>
</a><a href=https://111qqz.com/tags/binary-search-tree/ class="post_tag button button_translucent" data-position=1 title="binary search tree">BINARY SEARCH TREE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/bitset%E4%BC%98%E5%8C%96/ class="post_tag button button_translucent" data-position=4 title=bitsetä¼˜åŒ–>BITSETä¼˜åŒ–<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/blog/ class="post_tag button button_translucent" data-position=1 title=blog>BLOG<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/boost/ class="post_tag button button_translucent" data-position=1 title=boost>BOOST<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/boosting/ class="post_tag button button_translucent" data-position=1 title=boosting>BOOSTING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/brute-force/ class="post_tag button button_translucent" data-position=39 title="brute force">BRUTE FORCE<span class=button_tally>39</span>
</a><a href=https://111qqz.com/tags/bsgs/ class="post_tag button button_translucent" data-position=4 title=bsgs>BSGS<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/c++/ class="post_tag button button_translucent" data-position=7 title=c++>C++<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/c++11/ class="post_tag button button_translucent" data-position=1 title=c++11>C++11<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cache/ class="post_tag button button_translucent" data-position=1 title=cache>CACHE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/caffe/ class="post_tag button button_translucent" data-position=14 title=caffe>CAFFE<span class=button_tally>14</span>
</a><a href=https://111qqz.com/tags/caffe2/ class="post_tag button button_translucent" data-position=1 title=caffe2>CAFFE2<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/call-stack/ class="post_tag button button_translucent" data-position=1 title="call stack">CALL STACK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/call_once/ class="post_tag button button_translucent" data-position=1 title=call_once>CALL_ONCE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cdq%E5%88%86%E6%B2%BB/ class="post_tag button button_translucent" data-position=3 title=cdqåˆ†æ²»>CDQåˆ†æ²»<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/checkpoint/ class="post_tag button button_translucent" data-position=1 title=checkpoint>CHECKPOINT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/chromebook/ class="post_tag button button_translucent" data-position=1 title=chromebook>CHROMEBOOK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/ci/ class="post_tag button button_translucent" data-position=1 title=ci>CI<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cmake/ class="post_tag button button_translucent" data-position=1 title=cmake>CMAKE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/codeforces/ class="post_tag button button_translucent" data-position=3 title=codeforces>CODEFORCES<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/condition_variable/ class="post_tag button button_translucent" data-position=1 title=condition_variable>CONDITION_VARIABLE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/convolutional-neural-network/ class="post_tag button button_translucent" data-position=1 title="convolutional neural network">CONVOLUTIONAL NEURAL NETWORK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cpp/ class="post_tag button button_translucent" data-position=26 title=cpp>CPP<span class=button_tally>26</span>
</a><a href=https://111qqz.com/tags/cs231n/ class="post_tag button button_translucent" data-position=1 title=cs231n>CS231N<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cs341/ class="post_tag button button_translucent" data-position=1 title=cs341>CS341<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/csapp/ class="post_tag button button_translucent" data-position=7 title=csapp>CSAPP<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/cse599w/ class="post_tag button button_translucent" data-position=1 title=cse599w>CSE599W<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cuda/ class="post_tag button button_translucent" data-position=6 title=cuda>CUDA<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/cumulative-match-characteristi/ class="post_tag button button_translucent" data-position=1 title="cumulative match characteristi">CUMULATIVE MATCH CHARACTERISTI<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/cupy/ class="post_tag button button_translucent" data-position=1 title=cupy>CUPY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/d/ class="post_tag button button_translucent" data-position=1 title=d>D<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/dfs/ class="post_tag button button_translucent" data-position=34 title=dfs>DFS<span class=button_tally>34</span>
</a><a href=https://111qqz.com/tags/dfs%E5%BA%8F/ class="post_tag button button_translucent" data-position=1 title=dfsåº>DFSåº<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/dijkstra/ class="post_tag button button_translucent" data-position=2 title=dijkstra>DIJKSTRA<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/discourse/ class="post_tag button button_translucent" data-position=1 title=discourse>DISCOURSE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/dl-sys/ class="post_tag button button_translucent" data-position=1 title=dl-sys>DL-SYS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/docker/ class="post_tag button button_translucent" data-position=7 title=docker>DOCKER<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/dp/ class="post_tag button button_translucent" data-position=73 title=dp>DP<span class=button_tally>73</span>
</a><a href=https://111qqz.com/tags/eigen/ class="post_tag button button_translucent" data-position=1 title=eigen>EIGEN<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/end-to-end/ class="post_tag button button_translucent" data-position=1 title=end-to-end>END-TO-END<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/factorial-number-system/ class="post_tag button button_translucent" data-position=1 title="factorial number system">FACTORIAL NUMBER SYSTEM<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/faster-rcnn/ class="post_tag button button_translucent" data-position=3 title=faster-rcnn>FASTER-RCNN<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/feature-pyramid-networks/ class="post_tag button button_translucent" data-position=1 title=feature-pyramid-networks>FEATURE-PYRAMID-NETWORKS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/fedora/ class="post_tag button button_translucent" data-position=1 title=fedora>FEDORA<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/fish/ class="post_tag button button_translucent" data-position=1 title=fish>FISH<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/floyd/ class="post_tag button button_translucent" data-position=10 title=floyd>FLOYD<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/floyd-%E5%88%A4%E5%9C%88/ class="post_tag button button_translucent" data-position=2 title="floyd åˆ¤åœˆ">FLOYD åˆ¤åœˆ<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/fpn/ class="post_tag button button_translucent" data-position=1 title=fpn>FPN<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/future/ class="post_tag button button_translucent" data-position=2 title=future>FUTURE<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/g++/ class="post_tag button button_translucent" data-position=1 title=g++>G++<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/galliumos/ class="post_tag button button_translucent" data-position=1 title=galliumos>GALLIUMOS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/gcc/ class="post_tag button button_translucent" data-position=1 title=gcc>GCC<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/gcd/ class="post_tag button button_translucent" data-position=2 title=gcd>GCD<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/gdb/ class="post_tag button button_translucent" data-position=1 title=gdb>GDB<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/gedit/ class="post_tag button button_translucent" data-position=1 title=gedit>GEDIT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/geekos/ class="post_tag button button_translucent" data-position=4 title=geekos>GEEKOS<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/github/ class="post_tag button button_translucent" data-position=1 title=github>GITHUB<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/gitlab/ class="post_tag button button_translucent" data-position=1 title=gitlab>GITLAB<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/golang/ class="post_tag button button_translucent" data-position=1 title=golang>GOLANG<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/greedy/ class="post_tag button button_translucent" data-position=36 title=greedy>GREEDY<span class=button_tally>36</span>
</a><a href=https://111qqz.com/tags/grpc/ class="post_tag button button_translucent" data-position=2 title=grpc>GRPC<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/grub/ class="post_tag button button_translucent" data-position=1 title=grub>GRUB<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/grundy/ class="post_tag button button_translucent" data-position=1 title=grundy>GRUNDY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/halide/ class="post_tag button button_translucent" data-position=2 title=halide>HALIDE<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/haproxy/ class="post_tag button button_translucent" data-position=1 title=haproxy>HAPROXY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/hash/ class="post_tag button button_translucent" data-position=13 title=hash>HASH<span class=button_tally>13</span>
</a><a href=https://111qqz.com/tags/hash-map/ class="post_tag button button_translucent" data-position=1 title="hash map">HASH MAP<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/haskell/ class="post_tag button button_translucent" data-position=1 title=haskell>HASKELL<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/high-performance-computing/ class="post_tag button button_translucent" data-position=1 title="high performance computing">HIGH PERFORMANCE COMPUTING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/hugo/ class="post_tag button button_translucent" data-position=2 title=hugo>HUGO<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/image-denoising/ class="post_tag button button_translucent" data-position=1 title="image denoising">IMAGE DENOISING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/inception/ class="post_tag button button_translucent" data-position=1 title=inception>INCEPTION<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/java/ class="post_tag button button_translucent" data-position=5 title=java>JAVA<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/javascript/ class="post_tag button button_translucent" data-position=1 title=javascript>JAVASCRIPT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/jdk/ class="post_tag button button_translucent" data-position=1 title=jdk>JDK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/jetson-nano/ class="post_tag button button_translucent" data-position=2 title="jetson nano">JETSON NANO<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/json/ class="post_tag button button_translucent" data-position=1 title=json>JSON<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/k-means/ class="post_tag button button_translucent" data-position=2 title=k-means>K-MEANS<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/k-sum/ class="post_tag button button_translucent" data-position=3 title=k-sum>K-SUM<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/k8s/ class="post_tag button button_translucent" data-position=2 title=k8s>K8S<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/kafka/ class="post_tag button button_translucent" data-position=1 title=kafka>KAFKA<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/kd-tree/ class="post_tag button button_translucent" data-position=6 title=kd-tree>KD-TREE<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/km/ class="post_tag button button_translucent" data-position=14 title=km>KM<span class=button_tally>14</span>
</a><a href=https://111qqz.com/tags/kmp/ class="post_tag button button_translucent" data-position=19 title=kmp>KMP<span class=button_tally>19</span>
</a><a href=https://111qqz.com/tags/km%E7%AE%97%E6%B3%95/ class="post_tag button button_translucent" data-position=1 title=kmç®—æ³•>KMç®—æ³•<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/latent-factor-model/ class="post_tag button button_translucent" data-position=1 title="latent factor model">LATENT FACTOR MODEL<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/latex/ class="post_tag button button_translucent" data-position=1 title=latex>LATEX<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/lazy%E6%A0%87%E8%AE%B0/ class="post_tag button button_translucent" data-position=9 title=lazyæ ‡è®°>LAZYæ ‡è®°<span class=button_tally>9</span>
</a><a href=https://111qqz.com/tags/lca/ class="post_tag button button_translucent" data-position=10 title=lca>LCA<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/leetcode/ class="post_tag button button_translucent" data-position=39 title=leetcode>LEETCODE<span class=button_tally>39</span>
</a><a href=https://111qqz.com/tags/leveldb/ class="post_tag button button_translucent" data-position=10 title=leveldb>LEVELDB<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/linear-classification/ class="post_tag button button_translucent" data-position=1 title="linear classification">LINEAR CLASSIFICATION<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/linux/ class="post_tag button button_translucent" data-position=9 title=linux>LINUX<span class=button_tally>9</span>
</a><a href=https://111qqz.com/tags/linux-mint/ class="post_tag button button_translucent" data-position=1 title="linux mint">LINUX MINT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/lis/ class="post_tag button button_translucent" data-position=5 title=lis>LIS<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/log/ class="post_tag button button_translucent" data-position=2 title=log>LOG<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/lru/ class="post_tag button button_translucent" data-position=2 title=lru>LRU<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/lstm/ class="post_tag button button_translucent" data-position=1 title=lstm>LSTM<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/lua/ class="post_tag button button_translucent" data-position=1 title=lua>LUA<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/lucas%E5%AE%9A%E7%90%86/ class="post_tag button button_translucent" data-position=3 title=lucaså®šç†>LUCASå®šç†<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/manacher/ class="post_tag button button_translucent" data-position=4 title=manacher>MANACHER<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/manjaro/ class="post_tag button button_translucent" data-position=3 title=manjaro>MANJARO<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/map/ class="post_tag button button_translucent" data-position=6 title=map>MAP<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/math/ class="post_tag button button_translucent" data-position=49 title=math>MATH<span class=button_tally>49</span>
</a><a href=https://111qqz.com/tags/mean-average-precision/ class="post_tag button button_translucent" data-position=1 title="mean average precision">MEAN AVERAGE PRECISION<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/metric-learning/ class="post_tag button button_translucent" data-position=1 title="metric learning">METRIC LEARNING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/miller-rabin%E7%B4%A0%E6%95%B0%E6%B5%8B%E8%AF%95/ class="post_tag button button_translucent" data-position=1 title=miller-rabinç´ æ•°æµ‹è¯•>MILLER-RABINç´ æ•°æµ‹è¯•<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/model-distillation/ class="post_tag button button_translucent" data-position=1 title="model distillation">MODEL DISTILLATION<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/model-convertor/ class="post_tag button button_translucent" data-position=1 title=model-convertor>MODEL-CONVERTOR<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/modern-cpp/ class="post_tag button button_translucent" data-position=10 title="modern cpp">MODERN CPP<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/mpi/ class="post_tag button button_translucent" data-position=1 title=mpi>MPI<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/mst/ class="post_tag button button_translucent" data-position=6 title=mst>MST<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/murmurhash/ class="post_tag button button_translucent" data-position=1 title=murmurhash>MURMURHASH<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/mutual-learning/ class="post_tag button button_translucent" data-position=1 title="mutual learning">MUTUAL LEARNING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/mysql/ class="post_tag button button_translucent" data-position=3 title=mysql>MYSQL<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/nerdtree/ class="post_tag button button_translucent" data-position=1 title=nerdtree>NERDTREE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/network/ class="post_tag button button_translucent" data-position=1 title=network>NETWORK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/nim%E6%B8%B8%E6%88%8F/ class="post_tag button button_translucent" data-position=4 title=nimæ¸¸æˆ>NIMæ¸¸æˆ<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/nlp/ class="post_tag button button_translucent" data-position=1 title=nlp>NLP<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/nms/ class="post_tag button button_translucent" data-position=1 title=nms>NMS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/non-local-means/ class="post_tag button button_translucent" data-position=1 title="non-local means">NON-LOCAL MEANS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/non-local-neural-networks/ class="post_tag button button_translucent" data-position=1 title="non-local neural networks">NON-LOCAL NEURAL NETWORKS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/number-theory/ class="post_tag button button_translucent" data-position=27 title="number theory">NUMBER THEORY<span class=button_tally>27</span>
</a><a href=https://111qqz.com/tags/numpy/ class="post_tag button button_translucent" data-position=1 title=numpy>NUMPY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/object-detection/ class="post_tag button button_translucent" data-position=2 title="object detection">OBJECT DETECTION<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/once_flag/ class="post_tag button button_translucent" data-position=1 title=once_flag>ONCE_FLAG<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/onnxruntime/ class="post_tag button button_translucent" data-position=1 title=onnxruntime>ONNXRUNTIME<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/packaged_task/ class="post_tag button button_translucent" data-position=1 title=packaged_task>PACKAGED_TASK<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/pca/ class="post_tag button button_translucent" data-position=2 title=pca>PCA<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/perfect-forwarding/ class="post_tag button button_translucent" data-position=1 title="perfect forwarding">PERFECT FORWARDING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/pipline/ class="post_tag button button_translucent" data-position=1 title=pipline>PIPLINE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/pose-driven/ class="post_tag button button_translucent" data-position=1 title=pose-driven>POSE-DRIVEN<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/prim/ class="post_tag button button_translucent" data-position=1 title=prim>PRIM<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/promise/ class="post_tag button button_translucent" data-position=2 title=promise>PROMISE<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/property_tree/ class="post_tag button button_translucent" data-position=1 title=property_tree>PROPERTY_TREE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/protobuf/ class="post_tag button button_translucent" data-position=1 title=protobuf>PROTOBUF<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/python/ class="post_tag button button_translucent" data-position=11 title=python>PYTHON<span class=button_tally>11</span>
</a><a href=https://111qqz.com/tags/pytorch/ class="post_tag button button_translucent" data-position=2 title=pytorch>PYTORCH<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/qt/ class="post_tag button button_translucent" data-position=5 title=qt>QT<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/react/ class="post_tag button button_translucent" data-position=3 title=react>REACT<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/redis/ class="post_tag button button_translucent" data-position=1 title=redis>REDIS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/redux/ class="post_tag button button_translucent" data-position=1 title=redux>REDUX<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/reid/ class="post_tag button button_translucent" data-position=3 title=reid>REID<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/resnet/ class="post_tag button button_translucent" data-position=2 title=resnet>RESNET<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/retinanet/ class="post_tag button button_translucent" data-position=1 title=retinanet>RETINANET<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/rmq/ class="post_tag button button_translucent" data-position=17 title=rmq>RMQ<span class=button_tally>17</span>
</a><a href=https://111qqz.com/tags/rnn/ class="post_tag button button_translucent" data-position=1 title=rnn>RNN<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/set/ class="post_tag button button_translucent" data-position=8 title=set>SET<span class=button_tally>8</span>
</a><a href=https://111qqz.com/tags/sg%E5%87%BD%E6%95%B0/ class="post_tag button button_translucent" data-position=12 title=sgå‡½æ•°>SGå‡½æ•°<span class=button_tally>12</span>
</a><a href=https://111qqz.com/tags/shadowsocks/ class="post_tag button button_translucent" data-position=2 title=shadowsocks>SHADOWSOCKS<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/simd/ class="post_tag button button_translucent" data-position=1 title=simd>SIMD<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/simhash/ class="post_tag button button_translucent" data-position=1 title=simhash>SIMHASH<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/similarity-learning/ class="post_tag button button_translucent" data-position=1 title="similarity learning">SIMILARITY LEARNING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/single-state-detector/ class="post_tag button button_translucent" data-position=1 title="single state detector">SINGLE STATE DETECTOR<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/sj%E5%AE%9A%E7%90%86/ class="post_tag button button_translucent" data-position=2 title=sjå®šç†>SJå®šç†<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/sliding-windows/ class="post_tag button button_translucent" data-position=1 title="sliding windows">SLIDING WINDOWS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/slim/ class="post_tag button button_translucent" data-position=1 title=slim>SLIM<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/sort/ class="post_tag button button_translucent" data-position=1 title=sort>SORT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/sortings/ class="post_tag button button_translucent" data-position=3 title=sortings>SORTINGS<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/spfa/ class="post_tag button button_translucent" data-position=10 title=spfa>SPFA<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/spring/ class="post_tag button button_translucent" data-position=2 title=spring>SPRING<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/ssd/ class="post_tag button button_translucent" data-position=1 title=ssd>SSD<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/stdany/ class="post_tag button button_translucent" data-position=1 title=std::any>STD::ANY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/stdshared_ptr/ class="post_tag button button_translucent" data-position=1 title=std::shared_ptr>STD::SHARED_PTR<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/steam/ class="post_tag button button_translucent" data-position=2 title=steam>STEAM<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/stl/ class="post_tag button button_translucent" data-position=16 title=stl>STL<span class=button_tally>16</span>
</a><a href=https://111qqz.com/tags/stream/ class="post_tag button button_translucent" data-position=1 title=stream>STREAM<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/supercomputing/ class="post_tag button button_translucent" data-position=1 title=supercomputing>SUPERCOMPUTING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/supervisor/ class="post_tag button button_translucent" data-position=1 title=supervisor>SUPERVISOR<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/tarjan/ class="post_tag button button_translucent" data-position=2 title=tarjan>TARJAN<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/tensorflow/ class="post_tag button button_translucent" data-position=12 title=tensorflow>TENSORFLOW<span class=button_tally>12</span>
</a><a href=https://111qqz.com/tags/tensorrt/ class="post_tag button button_translucent" data-position=2 title=tensorrt>TENSORRT<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/threading-building-blocks/ class="post_tag button button_translucent" data-position=1 title="threading building blocks">THREADING BUILDING BLOCKS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/thrust/ class="post_tag button button_translucent" data-position=1 title=thrust>THRUST<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/todo/ class="post_tag button button_translucent" data-position=4 title=todo>TODO<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/tree/ class="post_tag button button_translucent" data-position=7 title=tree>TREE<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/trie/ class="post_tag button button_translucent" data-position=7 title=trie>TRIE<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/triplet-loss/ class="post_tag button button_translucent" data-position=1 title="triplet loss">TRIPLET LOSS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/tsp/ class="post_tag button button_translucent" data-position=2 title=tsp>TSP<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/two-pointer/ class="post_tag button button_translucent" data-position=5 title="two pointer">TWO POINTER<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/typescript/ class="post_tag button button_translucent" data-position=1 title=typescript>TYPESCRIPT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/unicode/ class="post_tag button button_translucent" data-position=1 title=unicode>UNICODE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/value-catrgory/ class="post_tag button button_translucent" data-position=1 title="value catrgory">VALUE CATRGORY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/variadic-function/ class="post_tag button button_translucent" data-position=1 title="variadic function">VARIADIC FUNCTION<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/variety/ class="post_tag button button_translucent" data-position=1 title=variety>VARIETY<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/vector/ class="post_tag button button_translucent" data-position=2 title=vector>VECTOR<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/vim/ class="post_tag button button_translucent" data-position=6 title=vim>VIM<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/vundle/ class="post_tag button button_translucent" data-position=1 title=vundle>VUNDLE<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/whitening/ class="post_tag button button_translucent" data-position=1 title=whitening>WHITENING<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/wordpress/ class="post_tag button button_translucent" data-position=1 title=wordpress>WORDPRESS<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/youcompleteme/ class="post_tag button button_translucent" data-position=1 title=youcompleteme>YOUCOMPLETEME<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/yuv-image-format/ class="post_tag button button_translucent" data-position=1 title="yuv image format">YUV IMAGE FORMAT<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%B7%B4%E4%BB%80%E5%8D%9A%E5%A5%95/ class="post_tag button button_translucent" data-position=5 title=å·´ä»€åšå¥•>å·´ä»€åšå¥•<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E7%99%BE%E5%BA%A6/ class="post_tag button button_translucent" data-position=1 title=ç™¾åº¦>ç™¾åº¦<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%B4%9D%E5%B0%94%E6%95%B0/ class="post_tag button button_translucent" data-position=2 title=è´å°”æ•°>è´å°”æ•°<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E7%BC%96%E8%AF%91%E5%99%A8/ class="post_tag button button_translucent" data-position=1 title=ç¼–è¯‘å™¨>ç¼–è¯‘å™¨<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/ class="post_tag button button_translucent" data-position=1 title=ç¼–è¯‘åŸç†>ç¼–è¯‘åŸç†<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/ class="post_tag button button_translucent" data-position=9 title=å¹¶æŸ¥é›†>å¹¶æŸ¥é›†<span class=button_tally>9</span>
</a><a href=https://111qqz.com/tags/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97/ class="post_tag button button_translucent" data-position=2 title=å¹¶è¡Œè®¡ç®—>å¹¶è¡Œè®¡ç®—<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/ class="post_tag button button_translucent" data-position=22 title=åšå¼ˆè®º>åšå¼ˆè®º<span class=button_tally>22</span>
</a><a href=https://111qqz.com/tags/%E5%B7%AE%E5%88%86%E5%BA%8F%E5%88%97/ class="post_tag button button_translucent" data-position=1 title=å·®åˆ†åºåˆ—>å·®åˆ†åºåˆ—<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%8B%86%E7%82%B9/ class="post_tag button button_translucent" data-position=6 title=æ‹†ç‚¹>æ‹†ç‚¹<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/%E5%B0%BA%E5%8F%96/ class="post_tag button button_translucent" data-position=2 title=å°ºå–>å°ºå–<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%B0%BA%E5%8F%96%E6%B3%95/ class="post_tag button button_translucent" data-position=10 title=å°ºå–æ³•>å°ºå–æ³•<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/%E6%8A%BD%E5%B1%89%E5%8E%9F%E7%90%86/ class="post_tag button button_translucent" data-position=6 title=æŠ½å±‰åŸç†>æŠ½å±‰åŸç†<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/%E4%BC%A0%E9%80%92%E9%97%AD%E5%8C%85/ class="post_tag button button_translucent" data-position=5 title=ä¼ é€’é—­åŒ…>ä¼ é€’é—­åŒ…<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E6%AC%A1%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/ class="post_tag button button_translucent" data-position=2 title=æ¬¡å°ç”Ÿæˆæ ‘>æ¬¡å°ç”Ÿæˆæ ‘<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E9%94%99%E6%8E%92%E5%85%AC%E5%BC%8F/ class="post_tag button button_translucent" data-position=2 title=é”™æ’å…¬å¼>é”™æ’å…¬å¼<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%89%93%E8%A1%A8/ class="post_tag button button_translucent" data-position=2 title=æ‰“è¡¨>æ‰“è¡¨<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97/ class="post_tag button button_translucent" data-position=3 title=å•è°ƒé˜Ÿåˆ—>å•è°ƒé˜Ÿåˆ—<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E5%8D%95%E8%B0%83%E6%80%A7%E4%BC%98%E5%8C%96/ class="post_tag button button_translucent" data-position=1 title=å•è°ƒæ€§ä¼˜åŒ–>å•è°ƒæ€§ä¼˜åŒ–<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8D%95%E8%B0%83%E6%A0%88/ class="post_tag button button_translucent" data-position=10 title=å•è°ƒæ ˆ>å•è°ƒæ ˆ<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/%E9%80%92%E6%8E%A8/ class="post_tag button button_translucent" data-position=2 title=é€’æ¨>é€’æ¨<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E7%AC%AC%E4%BA%8C%E7%B1%BB%E6%96%AF%E7%89%B9%E6%9E%97%E6%95%B0/ class="post_tag button button_translucent" data-position=1 title=ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°>ç¬¬äºŒç±»æ–¯ç‰¹æ—æ•°<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8A%A8%E6%80%81%E8%BF%9E%E9%80%9A%E6%80%A7/ class="post_tag button button_translucent" data-position=1 title=åŠ¨æ€è¿é€šæ€§>åŠ¨æ€è¿é€šæ€§<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8A%A8%E6%80%81%E7%BA%BF%E6%AE%B5%E6%A0%91/ class="post_tag button button_translucent" data-position=1 title=åŠ¨æ€çº¿æ®µæ ‘>åŠ¨æ€çº¿æ®µæ ‘<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%AF%B9%E6%8B%8D/ class="post_tag button button_translucent" data-position=1 title=å¯¹æ‹>å¯¹æ‹<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99/ class="post_tag button button_translucent" data-position=4 title=äºŒæ¬¡å‰©ä½™>äºŒæ¬¡å‰©ä½™<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E5%88%86/ class="post_tag button button_translucent" data-position=2 title=äºŒåˆ†>äºŒåˆ†<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E5%88%86%E5%9B%BE/ class="post_tag button button_translucent" data-position=5 title=äºŒåˆ†å›¾>äºŒåˆ†å›¾<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D/ class="post_tag button button_translucent" data-position=4 title=äºŒåˆ†å›¾åŒ¹é…>äºŒåˆ†å›¾åŒ¹é…<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E4%BD%B3%E5%8C%B9%E9%85%8D/ class="post_tag button button_translucent" data-position=14 title=äºŒåˆ†å›¾æœ€ä½³åŒ¹é…>äºŒåˆ†å›¾æœ€ä½³åŒ¹é…<span class=button_tally>14</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/ class="post_tag button button_translucent" data-position=1 title=äºŒè¿›åˆ¶>äºŒè¿›åˆ¶<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E7%BB%B4%E7%BA%BF%E6%AE%B5%E6%A0%91/ class="post_tag button button_translucent" data-position=1 title=äºŒç»´çº¿æ®µæ ‘>äºŒç»´çº¿æ®µæ ‘<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86/ class="post_tag button button_translucent" data-position=1 title=äºŒé¡¹å¼å®šç†>äºŒé¡¹å¼å®šç†<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8F%8D%E7%B4%A0%E6%95%B0/ class="post_tag button button_translucent" data-position=5 title=åç´ æ•°>åç´ æ•°<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD/ class="post_tag button button_translucent" data-position=1 title=åå‘ä¼ æ’­>åå‘ä¼ æ’­<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91/ class="post_tag button button_translucent" data-position=7 title=æ–æ³¢é‚£å¥‘>æ–æ³¢é‚£å¥‘<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E8%B4%B9%E9%A9%AC%E7%82%B9/ class="post_tag button button_translucent" data-position=1 title=è´¹é©¬ç‚¹>è´¹é©¬ç‚¹<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%B4%B9%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86/ class="post_tag button button_translucent" data-position=3 title=è´¹é©¬å°å®šç†>è´¹é©¬å°å®šç†<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E7%B3%BB%E7%BB%9F/ class="post_tag button button_translucent" data-position=1 title=åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿ>åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%88%86%E5%9D%97/ class="post_tag button button_translucent" data-position=12 title=åˆ†å—>åˆ†å—<span class=button_tally>12</span>
</a><a href=https://111qqz.com/tags/%E5%88%86%E7%B1%BB%E8%AE%A8%E8%AE%BA/ class="post_tag button button_translucent" data-position=1 title=åˆ†ç±»è®¨è®º>åˆ†ç±»è®¨è®º<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%88%86%E6%B2%BB/ class="post_tag button button_translucent" data-position=2 title=åˆ†æ²»>åˆ†æ²»<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%B3%B0%E5%BA%A6/ class="post_tag button button_translucent" data-position=1 title=å³°åº¦>å³°åº¦<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%AC%A6%E5%8F%B7%E8%A1%A8/ class="post_tag button button_translucent" data-position=1 title=ç¬¦å·è¡¨>ç¬¦å·è¡¨<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E6%80%A7/ class="post_tag button button_translucent" data-position=1 title=ç¬¦å·å¯è§æ€§>ç¬¦å·å¯è§æ€§<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%A6%82%E7%8E%87/ class="post_tag button button_translucent" data-position=13 title=æ¦‚ç‡>æ¦‚ç‡<span class=button_tally>13</span>
</a><a href=https://111qqz.com/tags/%E9%AB%98%E7%B2%BE%E5%BA%A6/ class="post_tag button button_translucent" data-position=2 title=é«˜ç²¾åº¦>é«˜ç²¾åº¦<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83/ class="post_tag button button_translucent" data-position=1 title=é«˜æ–¯æ¶ˆå…ƒ>é«˜æ–¯æ¶ˆå…ƒ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%93%A5%E5%BE%B7%E5%B7%B4%E8%B5%AB%E7%8C%9C%E6%83%B3/ class="post_tag button button_translucent" data-position=1 title=å“¥å¾·å·´èµ«çŒœæƒ³>å“¥å¾·å·´èµ«çŒœæƒ³<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8B%BE%E8%82%A1%E6%95%B0/ class="post_tag button button_translucent" data-position=1 title=å‹¾è‚¡æ•°>å‹¾è‚¡æ•°<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%9E%84%E9%80%A0/ class="post_tag button button_translucent" data-position=22 title=æ„é€ >æ„é€ <span class=button_tally>22</span>
</a><a href=https://111qqz.com/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/ class="post_tag button button_translucent" data-position=1 title=è§‚å¯Ÿè€…æ¨¡å¼>è§‚å¯Ÿè€…æ¨¡å¼<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%85%89%E6%B5%81%E6%B3%95/ class="post_tag button button_translucent" data-position=1 title=å…‰æµæ³•>å…‰æµæ³•<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%90%8E%E7%BC%80%E5%92%8C/ class="post_tag button button_translucent" data-position=1 title=åç¼€å’Œ>åç¼€å’Œ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84/ class="post_tag button button_translucent" data-position=10 title=åç¼€æ•°ç»„>åç¼€æ•°ç»„<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA/ class="post_tag button button_translucent" data-position=13 title=åç¼€è‡ªåŠ¨æœº>åç¼€è‡ªåŠ¨æœº<span class=button_tally>13</span>
</a><a href=https://111qqz.com/tags/%E5%9B%9E%E6%96%87%E4%B8%B2/ class="post_tag button button_translucent" data-position=2 title=å›æ–‡ä¸²>å›æ–‡ä¸²<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%9B%9E%E6%96%87%E8%87%AA%E5%8A%A8%E6%9C%BA/ class="post_tag button button_translucent" data-position=7 title=å›æ–‡è‡ªåŠ¨æœº>å›æ–‡è‡ªåŠ¨æœº<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E5%9F%BA%E7%A1%80%E5%9B%BE%E8%AE%BA/ class="post_tag button button_translucent" data-position=1 title=åŸºç¡€å›¾è®º>åŸºç¡€å›¾è®º<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/ class="post_tag button button_translucent" data-position=1 title=æ¿€æ´»å‡½æ•°>æ¿€æ´»å‡½æ•°<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%AE%A1%E6%95%B0%E6%8E%92%E5%BA%8F/ class="post_tag button button_translucent" data-position=2 title=è®¡æ•°æ’åº>è®¡æ•°æ’åº<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E8%AE%A1%E6%95%B0%E9%97%AE%E9%A2%98/ class="post_tag button button_translucent" data-position=10 title=è®¡æ•°é—®é¢˜>è®¡æ•°é—®é¢˜<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/ class="post_tag button button_translucent" data-position=2 title=è®¡ç®—æœºè§†è§‰>è®¡ç®—æœºè§†è§‰<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/ class="post_tag button button_translucent" data-position=20 title=è®¡ç®—å‡ ä½•>è®¡ç®—å‡ ä½•<span class=button_tally>20</span>
</a><a href=https://111qqz.com/tags/%E8%AE%A1%E7%BB%84/ class="post_tag button button_translucent" data-position=1 title=è®¡ç»„>è®¡ç»„<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%AE%B0%E5%BF%86%E5%8C%96%E6%90%9C%E7%B4%A2/ class="post_tag button button_translucent" data-position=2 title=è®°å¿†åŒ–æœç´¢>è®°å¿†åŒ–æœç´¢<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%89%AA%E6%9E%9D/ class="post_tag button button_translucent" data-position=1 title=å‰ªæ>å‰ªæ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BA%A4%E5%8F%89%E6%9F%93%E8%89%B2%E6%B3%95/ class="post_tag button button_translucent" data-position=6 title=äº¤å‰æŸ“è‰²æ³•>äº¤å‰æŸ“è‰²æ³•<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/%E4%BA%A4%E4%BA%92%E9%A2%98/ class="post_tag button button_translucent" data-position=1 title=äº¤äº’é¢˜>äº¤äº’é¢˜<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%BB%93%E8%AE%BA%E9%A2%98/ class="post_tag button button_translucent" data-position=1 title=ç»“è®ºé¢˜>ç»“è®ºé¢˜<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BA%AC%E4%B8%9C/ class="post_tag button button_translucent" data-position=1 title=äº¬ä¸œ>äº¬ä¸œ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%B1%80%E9%83%A8%E6%95%8F%E6%84%9Fhash/ class="post_tag button button_translucent" data-position=2 title=å±€éƒ¨æ•æ„Ÿhash>å±€éƒ¨æ•æ„ŸHASH<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E7%9F%A9%E5%BD%A2%E9%9D%A2%E7%A7%AF%E4%BA%A4/ class="post_tag button button_translucent" data-position=1 title=çŸ©å½¢é¢ç§¯äº¤>çŸ©å½¢é¢ç§¯äº¤<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%9F%A9%E5%BD%A2%E5%91%A8%E9%95%BF%E5%B9%B6/ class="post_tag button button_translucent" data-position=1 title=çŸ©å½¢å‘¨é•¿å¹¶>çŸ©å½¢å‘¨é•¿å¹¶<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%9F%A9%E9%98%B5/ class="post_tag button button_translucent" data-position=20 title=çŸ©é˜µ>çŸ©é˜µ<span class=button_tally>20</span>
</a><a href=https://111qqz.com/tags/%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82/ class="post_tag button button_translucent" data-position=5 title=çŸ©é˜µå¿«é€Ÿå¹‚>çŸ©é˜µå¿«é€Ÿå¹‚<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80/ class="post_tag button button_translucent" data-position=2 title=åº·æ‰˜å±•å¼€>åº·æ‰˜å±•å¼€<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80/%E9%80%86%E5%B1%95%E5%BC%80/ class="post_tag button button_translucent" data-position=1 title=åº·æ‰˜å±•å¼€/é€†å±•å¼€>åº·æ‰˜å±•å¼€/é€†å±•å¼€<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class="post_tag button button_translucent" data-position=5 title=å¯æŒä¹…åŒ–æ•°æ®ç»“æ„>å¯æŒä¹…åŒ–æ•°æ®ç»“æ„<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E5%BF%AB%E9%80%9F%E4%B9%98/ class="post_tag button button_translucent" data-position=1 title=å¿«é€Ÿä¹˜>å¿«é€Ÿä¹˜<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%BF%AB%E9%80%9F%E5%B9%82/ class="post_tag button button_translucent" data-position=20 title=å¿«é€Ÿå¹‚>å¿«é€Ÿå¹‚<span class=button_tally>20</span>
</a><a href=https://111qqz.com/tags/%E5%BF%AB%E9%80%9F%E7%AD%9B/ class="post_tag button button_translucent" data-position=2 title=å¿«é€Ÿç­›>å¿«é€Ÿç­›<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%89%A9%E5%B1%95bsgs/ class="post_tag button button_translucent" data-position=2 title=æ‰©å±•bsgs>æ‰©å±•BSGS<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/ class="post_tag button button_translucent" data-position=8 title=æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•<span class=button_tally>8</span>
</a><a href=https://111qqz.com/tags/%E6%8B%AC%E5%8F%B7%E5%8C%B9%E9%85%8D/ class="post_tag button button_translucent" data-position=2 title=æ‹¬å·åŒ¹é…>æ‹¬å·åŒ¹é…<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E7%A6%BB%E6%95%A3%E5%8C%96/ class="post_tag button button_translucent" data-position=11 title=ç¦»æ•£åŒ–>ç¦»æ•£åŒ–<span class=button_tally>11</span>
</a><a href=https://111qqz.com/tags/%E8%BF%9E%E9%80%9A%E6%80%A7/ class="post_tag button button_translucent" data-position=2 title=è¿é€šæ€§>è¿é€šæ€§<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E9%93%BE%E5%BC%8F%E5%89%8D%E5%90%91%E6%98%9F/ class="post_tag button button_translucent" data-position=1 title=é“¾å¼å‰å‘æ˜Ÿ>é“¾å¼å‰å‘æ˜Ÿ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%B7%AF%E5%BE%84dp/ class="post_tag button button_translucent" data-position=1 title=è·¯å¾„dp>è·¯å¾„DP<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%B7%AF%E5%BE%84%E8%AE%B0%E5%BD%95/ class="post_tag button button_translucent" data-position=2 title=è·¯å¾„è®°å½•>è·¯å¾„è®°å½•<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E4%B9%B1%E6%90%9E/ class="post_tag button button_translucent" data-position=6 title=ä¹±æ>ä¹±æ<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/%E6%9B%BC%E5%93%88%E9%A1%BF%E8%B7%9D%E7%A6%BB/ class="post_tag button button_translucent" data-position=4 title=æ›¼å“ˆé¡¿è·ç¦»>æ›¼å“ˆé¡¿è·ç¦»<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E6%9E%9A%E4%B8%BE%E5%AD%90%E9%9B%86/ class="post_tag button button_translucent" data-position=4 title=æšä¸¾å­é›†>æšä¸¾å­é›†<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E9%9D%A2%E8%AF%95/ class="post_tag button button_translucent" data-position=2 title=é¢è¯•>é¢è¯•<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%8E%86/ class="post_tag button button_translucent" data-position=3 title=é¢è¯•ç»å†>é¢è¯•ç»å†<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E6%A8%A1%E6%8B%9F/ class="post_tag button button_translucent" data-position=24 title=æ¨¡æ‹Ÿ>æ¨¡æ‹Ÿ<span class=button_tally>24</span>
</a><a href=https://111qqz.com/tags/%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB/ class="post_tag button button_translucent" data-position=5 title=æ¨¡æ‹Ÿé€€ç«>æ¨¡æ‹Ÿé€€ç«<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2/ class="post_tag button button_translucent" data-position=1 title=æ¨¡å‹è½¬æ¢>æ¨¡å‹è½¬æ¢<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%8E%AB%E9%98%9F%E7%AE%97%E6%B3%95/ class="post_tag button button_translucent" data-position=10 title=è«é˜Ÿç®—æ³•>è«é˜Ÿç®—æ³•<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/%E6%AF%8D%E5%87%BD%E6%95%B0/ class="post_tag button button_translucent" data-position=21 title=æ¯å‡½æ•°>æ¯å‡½æ•°<span class=button_tally>21</span>
</a><a href=https://111qqz.com/tags/%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C/ class="post_tag button button_translucent" data-position=1 title=å†…å­˜å±éšœ>å†…å­˜å±éšœ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E9%80%86%E5%BA%8F%E5%AF%B9/ class="post_tag button button_translucent" data-position=5 title=é€†åºå¯¹>é€†åºå¯¹<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E9%80%86%E5%85%83/ class="post_tag button button_translucent" data-position=5 title=é€†å…ƒ>é€†å…ƒ<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0/ class="post_tag button button_translucent" data-position=4 title=æ¬§æ‹‰å‡½æ•°>æ¬§æ‹‰å‡½æ•°<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E6%AC%A7%E6%8B%89%E8%B7%AF/ class="post_tag button button_translucent" data-position=1 title=æ¬§æ‹‰è·¯>æ¬§æ‹‰è·¯<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%88%AC%E8%99%AB/ class="post_tag button button_translucent" data-position=2 title=çˆ¬è™«>çˆ¬è™«<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E7%88%AC%E5%B1%B1%E6%B3%95/ class="post_tag button button_translucent" data-position=1 title=çˆ¬å±±æ³•>çˆ¬å±±æ³•<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88/ class="post_tag button button_translucent" data-position=8 title=æ’åˆ—ç»„åˆ>æ’åˆ—ç»„åˆ<span class=button_tally>8</span>
</a><a href=https://111qqz.com/tags/%E8%A3%B4%E8%9C%80%E5%AE%9A%E7%90%86/ class="post_tag button button_translucent" data-position=5 title=è£´èœ€å®šç†>è£´èœ€å®šç†<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E5%81%8F%E5%BA%A6/ class="post_tag button button_translucent" data-position=1 title=ååº¦>ååº¦<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%85%B6%E4%BB%96/ class="post_tag button button_translucent" data-position=1 title=å…¶ä»–>å…¶ä»–<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%89%8D%E7%AB%AF/ class="post_tag button button_translucent" data-position=6 title=å‰ç«¯>å‰ç«¯<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/%E5%89%8D%E7%BC%80%E5%92%8C/ class="post_tag button button_translucent" data-position=17 title=å‰ç¼€å’Œ>å‰ç¼€å’Œ<span class=button_tally>17</span>
</a><a href=https://111qqz.com/tags/%E5%8C%BA%E9%97%B4dp/ class="post_tag button button_translucent" data-position=13 title=åŒºé—´dp>åŒºé—´DP<span class=button_tally>13</span>
</a><a href=https://111qqz.com/tags/%E5%8C%BA%E9%97%B4%E7%AC%ACk%E5%A4%A7/ class="post_tag button button_translucent" data-position=2 title=åŒºé—´ç¬¬kå¤§>åŒºé—´ç¬¬Kå¤§<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%8C%BA%E9%97%B4%E5%90%88%E5%B9%B6/ class="post_tag button button_translucent" data-position=1 title=åŒºé—´åˆå¹¶>åŒºé—´åˆå¹¶<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%8C%BA%E9%97%B4%E8%AE%A1%E6%95%B0/ class="post_tag button button_translucent" data-position=1 title=åŒºé—´è®¡æ•°>åŒºé—´è®¡æ•°<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%9F%93%E8%89%B2%E9%97%AE%E9%A2%98/ class="post_tag button button_translucent" data-position=1 title=æŸ“è‰²é—®é¢˜>æŸ“è‰²é—®é¢˜<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86/ class="post_tag button button_translucent" data-position=5 title=å®¹æ–¥åŸç†>å®¹æ–¥åŸç†<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E4%B8%89%E5%88%86/ class="post_tag button button_translucent" data-position=2 title=ä¸‰åˆ†>ä¸‰åˆ†<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%89%AB%E6%8F%8F%E7%BA%BF/ class="post_tag button button_translucent" data-position=4 title=æ‰«æçº¿>æ‰«æçº¿<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E7%AD%9B%E6%B3%95/ class="post_tag button button_translucent" data-position=1 title=ç­›æ³•>ç­›æ³•<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/ class="post_tag button button_translucent" data-position=2 title=è®¾è®¡æ¨¡å¼>è®¾è®¡æ¨¡å¼<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%B0%84%E7%BA%BF%E6%B3%95/ class="post_tag button button_translucent" data-position=1 title=å°„çº¿æ³•>å°„çº¿æ³•<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%89%A9%E4%BD%99%E7%B3%BB/ class="post_tag button button_translucent" data-position=3 title=å‰©ä½™ç³»>å‰©ä½™ç³»<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E8%BE%93%E5%85%A5%E6%8C%82/ class="post_tag button button_translucent" data-position=2 title=è¾“å…¥æŒ‚>è¾“å…¥æŒ‚<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84/ class="post_tag button button_translucent" data-position=9 title=æ ‘çš„ç›´å¾„>æ ‘çš„ç›´å¾„<span class=button_tally>9</span>
</a><a href=https://111qqz.com/tags/%E6%A0%91%E5%A5%97%E6%A0%91/ class="post_tag button button_translucent" data-position=1 title=æ ‘å¥—æ ‘>æ ‘å¥—æ ‘<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%A0%91%E5%BD%A2dp/ class="post_tag button button_translucent" data-position=6 title=æ ‘å½¢dp>æ ‘å½¢DP<span class=button_tally>6</span>
</a><a href=https://111qqz.com/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/ class="post_tag button button_translucent" data-position=20 title=æ ‘çŠ¶æ•°ç»„>æ ‘çŠ¶æ•°ç»„<span class=button_tally>20</span>
</a><a href=https://111qqz.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ class="post_tag button button_translucent" data-position=2 title=æ•°æ®ç»“æ„>æ•°æ®ç»“æ„<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/ class="post_tag button button_translucent" data-position=1 title=æ•°æ®å‹ç¼©>æ•°æ®å‹ç¼©<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%95%B0%E8%AE%BA/ class="post_tag button button_translucent" data-position=2 title=æ•°è®º>æ•°è®º<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%95%B0%E4%BD%8Ddp/ class="post_tag button button_translucent" data-position=17 title=æ•°ä½dp>æ•°ä½DP<span class=button_tally>17</span>
</a><a href=https://111qqz.com/tags/%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95/ class="post_tag button button_translucent" data-position=2 title=æ•°å€¼è®¡ç®—æ–¹æ³•>æ•°å€¼è®¡ç®—æ–¹æ³•<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/ class="post_tag button button_translucent" data-position=2 title=æ•°å­—å›¾åƒå¤„ç†>æ•°å­—å›¾åƒå¤„ç†<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%B0%B4/ class="post_tag button button_translucent" data-position=5 title=æ°´>æ°´<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E6%B0%B4%E9%A2%98/ class="post_tag button button_translucent" data-position=7 title=æ°´é¢˜>æ°´é¢˜<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E6%80%9D%E7%BB%B4/ class="post_tag button button_translucent" data-position=1 title=æ€ç»´>æ€ç»´<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%80%9D%E7%BB%B4%E9%A2%98/ class="post_tag button button_translucent" data-position=7 title=æ€ç»´é¢˜>æ€ç»´é¢˜<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E5%9B%9B%E5%8F%89%E6%A0%91/ class="post_tag button button_translucent" data-position=1 title=å››å‰æ ‘>å››å‰æ ‘<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/ class="post_tag button button_translucent" data-position=236 title=ç®—æ³•ç«èµ›>ç®—æ³•ç«èµ›<span class=button_tally>236</span>
</a><a href=https://111qqz.com/tags/%E9%9A%8F%E7%AC%94%E6%9D%82%E8%B0%88/ class="post_tag button button_translucent" data-position=7 title=éšç¬”æ‚è°ˆ>éšç¬”æ‚è°ˆ<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/ class="post_tag button button_translucent" data-position=7 title=æ‹“æ‰‘æ’åº>æ‹“æ‰‘æ’åº<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E6%B3%B0%E5%8B%92%E5%B1%95%E5%BC%80/ class="post_tag button button_translucent" data-position=3 title=æ³°å‹’å±•å¼€>æ³°å‹’å±•å¼€<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E8%B4%AA%E5%BF%83/ class="post_tag button button_translucent" data-position=1 title=è´ªå¿ƒ>è´ªå¿ƒ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/ class="post_tag button button_translucent" data-position=1 title=æ¢¯åº¦ä¸‹é™>æ¢¯åº¦ä¸‹é™<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%90%8C%E6%9E%84/ class="post_tag button button_translucent" data-position=1 title=åŒæ„>åŒæ„<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%87%B8%E5%8C%85/ class="post_tag button button_translucent" data-position=1 title=å‡¸åŒ…>å‡¸åŒ…<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%9B%BE%E8%AE%BA/ class="post_tag button button_translucent" data-position=16 title=å›¾è®º>å›¾è®º<span class=button_tally>16</span>
</a><a href=https://111qqz.com/tags/%E5%9B%BE%E8%AE%BA%E5%9F%BA%E7%A1%80/ class="post_tag button button_translucent" data-position=1 title=å›¾è®ºåŸºç¡€>å›¾è®ºåŸºç¡€<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/ class="post_tag button button_translucent" data-position=2 title=å›¾åƒå¤„ç†>å›¾åƒå¤„ç†<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/ class="post_tag button button_translucent" data-position=3 title=æ¨èç³»ç»Ÿ>æ¨èç³»ç»Ÿ<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E5%AE%8C%E5%85%A8%E8%83%8C%E5%8C%85/ class="post_tag button button_translucent" data-position=2 title=å®Œå…¨èƒŒåŒ…>å®Œå…¨èƒŒåŒ…<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/ class="post_tag button button_translucent" data-position=4 title=ä½è¿ç®—>ä½è¿ç®—<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E6%96%87%E6%98%8E/ class="post_tag button button_translucent" data-position=1 title=æ–‡æ˜>æ–‡æ˜<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%97%A0%E5%90%91%E5%9B%BE%E7%9A%84%E7%8E%AF/ class="post_tag button button_translucent" data-position=3 title=æ— å‘å›¾çš„ç¯>æ— å‘å›¾çš„ç¯<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/ class="post_tag button button_translucent" data-position=1 title=ç³»ç»Ÿè°ƒç”¨>ç³»ç»Ÿè°ƒç”¨<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%BB%86%E8%8A%82%E9%A2%98/ class="post_tag button button_translucent" data-position=1 title=ç»†èŠ‚é¢˜>ç»†èŠ‚é¢˜<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/ class="post_tag button button_translucent" data-position=43 title=çº¿æ®µæ ‘>çº¿æ®µæ ‘<span class=button_tally>43</span>
</a><a href=https://111qqz.com/tags/%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4/ class="post_tag button button_translucent" data-position=1 title=ååŒè¿‡æ»¤>ååŒè¿‡æ»¤<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/ class="post_tag button button_translucent" data-position=3 title=æ–œç‡ä¼˜åŒ–>æ–œç‡ä¼˜åŒ–<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E8%BE%9B%E6%99%AE%E6%A3%AE%E7%A7%AF%E5%88%86/ class="post_tag button button_translucent" data-position=2 title=è¾›æ™®æ£®ç§¯åˆ†>è¾›æ™®æ£®ç§¯åˆ†<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95/ class="post_tag button button_translucent" data-position=15 title=åŒˆç‰™åˆ©ç®—æ³•>åŒˆç‰™åˆ©ç®—æ³•<span class=button_tally>15</span>
</a><a href=https://111qqz.com/tags/%E8%99%9A%E7%82%B9/ class="post_tag button button_translucent" data-position=1 title=è™šç‚¹>è™šç‚¹<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E8%93%84%E6%B0%B4%E6%B1%A0%E6%8A%BD%E6%A0%B7/ class="post_tag button button_translucent" data-position=1 title=è“„æ°´æ± æŠ½æ ·>è“„æ°´æ± æŠ½æ ·<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%BE%AA%E7%8E%AF%E8%8A%82/ class="post_tag button button_translucent" data-position=8 title=å¾ªç¯èŠ‚>å¾ªç¯èŠ‚<span class=button_tally>8</span>
</a><a href=https://111qqz.com/tags/%E5%BE%AA%E7%8E%AF%E5%B1%95%E5%BC%80/ class="post_tag button button_translucent" data-position=1 title=å¾ªç¯å±•å¼€>å¾ªç¯å±•å¼€<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/ class="post_tag button button_translucent" data-position=1 title=ä¸€è‡´æ€§å“ˆå¸Œ>ä¸€è‡´æ€§å“ˆå¸Œ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/ class="post_tag button button_translucent" data-position=1 title=ä¾èµ–æ³¨å…¥>ä¾èµ–æ³¨å…¥<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/ class="post_tag button button_translucent" data-position=4 title=ä¼˜å…ˆé˜Ÿåˆ—>ä¼˜å…ˆé˜Ÿåˆ—<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E6%B8%B8%E6%88%8F/ class="post_tag button button_translucent" data-position=1 title=æ¸¸æˆ>æ¸¸æˆ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E9%A2%84%E5%A4%84%E7%90%86/ class="post_tag button button_translucent" data-position=1 title=é¢„å¤„ç†>é¢„å¤„ç†<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%A0%88/ class="post_tag button button_translucent" data-position=1 title=æ ˆ>æ ˆ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/ class="post_tag button button_translucent" data-position=1 title=æ­£åˆ™è¡¨è¾¾å¼>æ­£åˆ™è¡¨è¾¾å¼<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%8C%87%E6%95%B0%E5%BE%AA%E7%8E%AF%E8%8A%82/ class="post_tag button button_translucent" data-position=7 title=æŒ‡æ•°å¾ªç¯èŠ‚>æŒ‡æ•°å¾ªç¯èŠ‚<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E7%BD%AE%E6%8D%A2%E7%BE%A4/ class="post_tag button button_translucent" data-position=1 title=ç½®æ¢ç¾¤>ç½®æ¢ç¾¤<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86/ class="post_tag button button_translucent" data-position=4 title=ä¸­å›½å‰©ä½™å®šç†>ä¸­å›½å‰©ä½™å®šç†<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E9%87%8D%E5%BF%83/ class="post_tag button button_translucent" data-position=1 title=é‡å¿ƒ>é‡å¿ƒ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E4%B8%BB%E5%B8%AD%E6%A0%91/ class="post_tag button button_translucent" data-position=5 title=ä¸»å¸­æ ‘>ä¸»å¸­æ ‘<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/ class="post_tag button button_translucent" data-position=1 title=çŠ¶æ€å‹ç¼©>çŠ¶æ€å‹ç¼©<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%8A%B6%E5%8E%8Bdp/ class="post_tag button button_translucent" data-position=1 title=çŠ¶å‹dp>çŠ¶å‹DP<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/ class="post_tag button button_translucent" data-position=14 title=å­—ç¬¦ä¸²>å­—ç¬¦ä¸²<span class=button_tally>14</span>
</a><a href=https://111qqz.com/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2dp/ class="post_tag button button_translucent" data-position=1 title=å­—ç¬¦ä¸²dp>å­—ç¬¦ä¸²DP<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BE%AA%E7%8E%AF%E5%90%8C%E6%9E%84/ class="post_tag button button_translucent" data-position=4 title=å­—ç¬¦ä¸²å¾ªç¯åŒæ„>å­—ç¬¦ä¸²å¾ªç¯åŒæ„<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/ class="post_tag button button_translucent" data-position=1 title=ç»„æˆåŸç†>ç»„æˆåŸç†<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F/ class="post_tag button button_translucent" data-position=1 title=ç»„åˆæ¨¡å¼>ç»„åˆæ¨¡å¼<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/ class="post_tag button button_translucent" data-position=10 title=ç»„åˆæ•°å­¦>ç»„åˆæ•°å­¦<span class=button_tally>10</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%A4%A7%E7%8B%AC%E7%AB%8B%E9%9B%86/ class="post_tag button button_translucent" data-position=1 title=æœ€å¤§ç‹¬ç«‹é›†>æœ€å¤§ç‹¬ç«‹é›†<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%A4%A7%E8%BF%9E%E7%BB%AD%E5%92%8C/ class="post_tag button button_translucent" data-position=1 title=æœ€å¤§è¿ç»­å’Œ>æœ€å¤§è¿ç»­å’Œ<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%A4%A7%E8%BF%9E%E7%BB%AD%E5%8C%BA%E9%97%B4%E5%92%8C/ class="post_tag button button_translucent" data-position=3 title=æœ€å¤§è¿ç»­åŒºé—´å’Œ>æœ€å¤§è¿ç»­åŒºé—´å’Œ<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/ class="post_tag button button_translucent" data-position=5 title=æœ€çŸ­è·¯>æœ€çŸ­è·¯<span class=button_tally>5</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%B0%8F%E8%A1%A8%E7%A4%BA%E6%B3%95/ class="post_tag button button_translucent" data-position=7 title=æœ€å°è¡¨ç¤ºæ³•>æœ€å°è¡¨ç¤ºæ³•<span class=button_tally>7</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%B0%8F%E9%A1%B6%E7%82%B9%E8%A6%86%E7%9B%96/ class="post_tag button button_translucent" data-position=2 title=æœ€å°é¡¶ç‚¹è¦†ç›–>æœ€å°é¡¶ç‚¹è¦†ç›–<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E4%B8%B2/ class="post_tag button button_translucent" data-position=3 title=æœ€å°è¦†ç›–å­ä¸²>æœ€å°è¦†ç›–å­ä¸²<span class=button_tally>3</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E7%9F%A9%E5%BD%A2/ class="post_tag button button_translucent" data-position=1 title=æœ€å°è¦†ç›–å­çŸ©å½¢>æœ€å°è¦†ç›–å­çŸ©å½¢<span class=button_tally>1</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%B0%8F%E8%B7%AF%E5%BE%84%E8%A6%86%E7%9B%96/ class="post_tag button button_translucent" data-position=2 title=æœ€å°è·¯å¾„è¦†ç›–>æœ€å°è·¯å¾„è¦†ç›–<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/ class="post_tag button button_translucent" data-position=2 title=æœ€å°ç”Ÿæˆæ ‘>æœ€å°ç”Ÿæˆæ ‘<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%97%E4%B8%B2/ class="post_tag button button_translucent" data-position=4 title=æœ€é•¿å…¬å…±å­—ä¸²>æœ€é•¿å…¬å…±å­—ä¸²<span class=button_tally>4</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E9%95%BF%E8%B7%AF/ class="post_tag button button_translucent" data-position=2 title=æœ€é•¿è·¯>æœ€é•¿è·¯<span class=button_tally>2</span>
</a><a href=https://111qqz.com/tags/%E6%9C%80%E9%95%BF%E4%B8%8B%E9%99%8D%E5%AD%90%E5%BA%8F%E5%88%97/ class="post_tag button button_translucent" data-position=1 title=æœ€é•¿ä¸‹é™å­åºåˆ—>æœ€é•¿ä¸‹é™å­åºåˆ—<span class=button_tally>1</span></a><div class=tags_sort><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span></div><span class=tags_hide><svg class="icon"><use xlink:href="#closeme"/></svg></span></div></div></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://111qqz.com/icons/apple-touch-icon.png class="icon icon_2 transparent" alt=111qqzçš„å°çª><p>Copyright&nbsp;<span class=year></span>&nbsp;111QQZçš„å°çª. All Rights Reserved</p><a class=to_top href=#documentTop><svg class="icon"><use xlink:href="#arrow"/></svg></a></div></footer><script type=text/javascript src=https://111qqz.com/js/bundle.min.bcaa4356b3671ffa6f41987d56e87dfd749683d23fd99a70769b5dda29225b669759d387454da9cdf0988ec4da70f274486671d24ab4dcea2ae987fe33bdc030.js integrity="sha512-vKpDVrNnH/pvQZh9Vuh9/XSWg9I/2Zpwdptd2ikiW2aXWdOHRU2pzfCYjsTacPJ0SGZx0kq03Ooq6Yf+M73AMA==" crossorigin=anonymous></script></body></html>
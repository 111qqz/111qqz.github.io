<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="111qqz的小窝">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://111qqz.github.io/img/2.png">
    <meta property="twitter:image" content="https://111qqz.github.io/img/2.png" />
    

    
    <meta name="title" content="FPN:Feature Pyramid Networks 学习笔记" />
    <meta property="og:title" content="FPN:Feature Pyramid Networks 学习笔记" />
    <meta property="twitter:title" content="FPN:Feature Pyramid Networks 学习笔记" />
    

    
    <meta name="description" content="">
    <meta property="og:description" content="" />
    <meta property="twitter:description" content="" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="ACM,111qqz,商汤科技,hust,华中科技大学">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>FPN:Feature Pyramid Networks 学习笔记-111qqz的小窝</title>

    <link rel="canonical" href="/2019/12/feature-pyramid-networks">

    <link rel="stylesheet" href="/css/iDisqus.min.css"/>
	
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    
    <link rel="stylesheet" href="/css/syntax.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    
    <script src="/js/jquery.min.js"></script>
    
    
    <script src="/js/bootstrap.min.js"></script>
    
    
    <script src="/js/hux-blog.min.js"></script>
	
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/docco.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <link rel="stylesheet" href="/css/hux-blog.min.css">
    <link rel="stylesheet" href="/css/hux-blog.min-custom.css">
</head>


<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">111qqz的小窝</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
		    
                        <li><a href="/categories/acm/">ACM-ICPC</a></li>
                    
                        <li><a href="/categories/deep-learning/">深度学习</a></li>
                    
                        <li><a href="/categories/mooc/">公开课</a></li>
                    
                        <li><a href="/categories/%e5%85%b6%e4%bb%96/">其他</a></li>
                    
                        <li><a href="/top/about/">ABOUT</a></li>
                    

                    
		    <li>
                        <a href="/search">SEARCH <img src="/img/search.png" height="15" style="cursor: pointer;" alt="Search"></a>
		    </li>
                    
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/2.png')
    }
</style>
<header class="intro-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/feature-pyramid-networks" title="feature-pyramid-networks">
                            feature-pyramid-networks
                        </a>
                        
                        <a class="tag" href="/tags/fpn" title="FPN">
                            FPN
                        </a>
                        
                    </div>
                    <h1>FPN:Feature Pyramid Networks 学习笔记</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
			Posted by 
			
			    111qqz
			 
			on 
			Sunday, December 8, 2019
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <header>
                    <h2>TOC</h2>
                </header>
                <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#之前的工作">之前的工作</a>
<ul>
<li><a href="#featurized-image-pyramid">Featurized image pyramid</a></li>
<li><a href="#single-feature-map">Single feature map</a></li>
<li><a href="#pyramidal-feature-hierarchy">Pyramidal feature hierarchy</a></li>
</ul></li>
<li><a href="#feature-pyramid-networks">Feature Pyramid Networks</a></li>
<li><a href="#fpn-用于-faster-rcnn">FPN 用于 faster rcnn</a>
<ul>
<li><a href="#fpn-作用于rpn">FPN 作用于RPN</a></li>
<li><a href="#fpn-作用于fast-rcnn">FPN 作用于fast rcnn</a></li>
</ul></li>
<li><a href="#参考">参考</a></li>
</ul></li>
</ul>
</nav>
                
                

<p>检测不同尺度的物体一直是计算机视觉领域中比较有挑战性的事情．我们先从之前的工作出发，并对比FPN比起之前的工作有哪些改进．</p>

<h2 id="之前的工作">之前的工作</h2>

<h3 id="featurized-image-pyramid">Featurized image pyramid</h3>

<p><img src="https://i.loli.net/2019/12/08/vhsEbJoYNBcMKdk.png" alt="Featurized image pyramid.png" /></p>

<p>思路是对于同一张图，生成不同的scale，然后每个scale的image单独去做检测．
这个方法是手工设计feautre时代的常用办法．
这个办法是比较显然的，也的确可以解决检测不同尺度物体的问题．
缺点非常明显&hellip;inference的速度几乎和scale的个数线性相关．
以及由于显存的开销，没办法做end-to-end 的training.</p>

<h3 id="single-feature-map">Single feature map</h3>

<p><img src="https://i.loli.net/2019/12/08/prs9x427mKRWv1o.png" alt="single_feature_map.png" /></p>

<p>再之后，手工设计的feature逐渐被由CNN生成的feature取代了．
这种办法更加鲁棒，对image的一些变化不敏感．
但是如果只有一个scale 的图片去过这个feature map,只有最终的feature map去做predict..准确率不太行．．因此还是要与Featurized image pyramid一起．只是优化了得到feature 的部分．</p>

<h3 id="pyramidal-feature-hierarchy">Pyramidal feature hierarchy</h3>

<p>就..CNN本身就有显然的层次结构啊．．．
为什么不直接拿来用，而是提前scale image呢．．．</p>

<p><img src="https://i.loli.net/2019/12/08/vhsEbJoYNBcMKdk.png" alt="Featurized image pyramid.png" /></p>

<p>也就是选若干个feature map直接去做predict..
这个办法美滋滋，既有多个feature map保证了一定的准确率，同时也没有增加很多inference的cost.</p>

<p>SSD应该是率先使用这种方法的．
但是这种办法仍然有不足之处，就是低层的高分辨率的feature map的semantics 太弱了．．
这就导致说对小物体的检测效果不太理想．．．</p>

<p>那么该怎么办呢．．．这时候就该介绍FPN啦</p>

<h2 id="feature-pyramid-networks">Feature Pyramid Networks</h2>

<p><img src="https://i.loli.net/2019/12/08/WLNExRUl4ozFcIk.png" alt="feature_pyramid_network.png" /></p>

<p>后面再更．</p>

<h2 id="fpn-用于-faster-rcnn">FPN 用于 faster rcnn</h2>

<p>FPN同时作用于RPN阶段和fast-rcnn detector</p>

<p>以下的代码实现出自　<a href="https://github.com/jwyang/fpn.pytorch">fpn.pytorch</a></p>

<h3 id="fpn-作用于rpn">FPN 作用于RPN</h3>

<p>感觉直接上代码比较容易理解</p>

<p>先看　整个网络的forward函数</p>

<pre><code class="language-python">

 def forward(self, im_data, im_info, gt_boxes, num_boxes):
        batch_size = im_data.size(0)

        im_info = im_info.data
        gt_boxes = gt_boxes.data
        num_boxes = num_boxes.data

        # feed image data to base model to obtain base feature map
        # Bottom-up
        c1 = self.RCNN_layer0(im_data)
        c2 = self.RCNN_layer1(c1)
        c3 = self.RCNN_layer2(c2)
        c4 = self.RCNN_layer3(c3)
        c5 = self.RCNN_layer4(c4)
        # Top-down
        p5 = self.RCNN_toplayer(c5)
        p4 = self._upsample_add(p5, self.RCNN_latlayer1(c4))
        p4 = self.RCNN_smooth1(p4)
        p3 = self._upsample_add(p4, self.RCNN_latlayer2(c3))
        p3 = self.RCNN_smooth2(p3)
        p2 = self._upsample_add(p3, self.RCNN_latlayer3(c2))
        p2 = self.RCNN_smooth3(p2)

        p6 = self.maxpool2d(p5)

        rpn_feature_maps = [p2, p3, p4, p5, p6]
        mrcnn_feature_maps = [p2, p3, p4, p5]

        rois, rpn_loss_cls, rpn_loss_bbox = self.RCNN_rpn(rpn_feature_maps, im_info, gt_boxes, num_boxes)

</code></pre>

<p>其中RCNN_layer就是用了resnet对应的layer.  可以看出c1,c2,c3,c4是bottom-up的几个feature map, p对应的是top-down的feature map</p>

<p><strong>需要注意这里的下标,不管是p还是c,数字越大表示的都是feature map越小. 相同数字的p和c(比如p4和c4)是同一个level的feature.</strong></p>

<p>然后中间是通过　_upsample_add　直接元素相加</p>

<pre><code class="language-python">
 def _upsample_add(self, x, y):
        '''Upsample and add two feature maps.
        Args:
          x: (Variable) top feature map to be upsampled.
          y: (Variable) lateral feature map.
        Returns:
          (Variable) added feature map.
        Note in PyTorch, when input size is odd, the upsampled feature map
        with `F.upsample(..., scale_factor=2, mode='nearest')`
        maybe not equal to the lateral feature map size.
        e.g.
        original input size: [N,_,15,15] -&gt;
        conv2d feature map size: [N,_,8,8] -&gt;
        upsampled feature map size: [N,_,16,16]
        So we choose bilinear upsample which supports arbitrary output sizes.
        '''
        _,_,H,W = y.size()
        return F.upsample(x, size=(H,W), mode='bilinear') + y

</code></pre>

<p>至于为什么能相加，</p>

<blockquote>
<blockquote>
<p>作者解释说这个原因在于我们做了 end-to-end 的 training，因为不同层的参数不是固定的，不同层同时给监督做 end-to-end training，所以相加训练出来的东西能够更有效地融合浅层和深层的信息。</p>

<p>da哥解释说，只要work了，故事随便讲</p>
</blockquote>
</blockquote>

<p>我们看到这里拿了[p2, p3, p4, p5, p6] 这几个feature 输入到rpn网络中．</p>

<p>然后我们看一下RPN-FPN的forward 部分</p>

<pre><code class="language-python">

    def forward(self, rpn_feature_maps, im_info, gt_boxes, num_boxes):        


        n_feat_maps = len(rpn_feature_maps)

        rpn_cls_scores = []
        rpn_cls_probs = []
        rpn_bbox_preds = []
        rpn_shapes = []
        #  对于每一个feature map，来做rpn得到prob和bbox 
        for i in range(n_feat_maps):
            feat_map = rpn_feature_maps[i]
            batch_size = feat_map.size(0)
            
            # return feature map after convrelu layer
            rpn_conv1 = F.relu(self.RPN_Conv(feat_map), inplace=True)
            # get rpn classification score
            rpn_cls_score = self.RPN_cls_score(rpn_conv1)

            rpn_cls_score_reshape = self.reshape(rpn_cls_score, 2)
            rpn_cls_prob_reshape = F.softmax(rpn_cls_score_reshape)
            rpn_cls_prob = self.reshape(rpn_cls_prob_reshape, self.nc_score_out)

            # get rpn offsets to the anchor boxes
            rpn_bbox_pred = self.RPN_bbox_pred(rpn_conv1)

            rpn_shapes.append([rpn_cls_score.size()[2], rpn_cls_score.size()[3]])
            # permute是为了把坐标/分数放在最外面一个维度
            rpn_cls_scores.append(rpn_cls_score.permute(0, 2, 3, 1).contiguous().view(batch_size, -1, 2))
            rpn_cls_probs.append(rpn_cls_prob.permute(0, 2, 3, 1).contiguous().view(batch_size, -1, 2))
            rpn_bbox_preds.append(rpn_bbox_pred.permute(0, 2, 3, 1).contiguous().view(batch_size, -1, 4))

        rpn_cls_score_alls = torch.cat(rpn_cls_scores, 1)
        rpn_cls_prob_alls = torch.cat(rpn_cls_probs, 1)
        rpn_bbox_pred_alls = torch.cat(rpn_bbox_preds, 1)

        n_rpn_pred = rpn_cls_score_alls.size(1)

        # proposal layer
        cfg_key = 'TRAIN' if self.training else 'TEST'
        # 　现在rpn网络已经对anchors的好坏做出了学习，这里的好坏只是指前景或者背景，不包括具体类别的分数．
        #   同时rpn 也学习到了这些anchor的偏移，使得anchor的坐标往更好的方向做一些微调

        # 组成了一个tuple,把这些输入作为一个整体的Input输入了进去
        rois = self.RPN_proposal((rpn_cls_prob_alls.data, rpn_bbox_pred_alls.data,
                                 im_info, cfg_key, rpn_shapes))

</code></pre>

<p>可以看到是对于每一个scale的feaute_map单独过rpn,然后把得到的结果concat到了一起去做proposal</p>

<p>接下来我们看一下proposal的代码，细节稍微多一些．</p>

<p>简单来说,proposal　layer按照顺序大概做了如下几件事．</p>

<ul>
<li>bbox_transform_inv　根据rpn的结果调整anchors，得到更好的anchors</li>
<li>clip_boxes　把调整后的anchors根据图片尺寸进行截断，使得所有anchors都在图片范围内</li>
<li>按照分数高低选一定数量的anchors做nms,作为nms得到的这些anchors再取topk就称之为rois(或者proposals)</li>
</ul>

<p>整个proposals流程的代码如下，添加了必要的注释</p>

<pre><code class="language-python">
def forward(self, input):

        # Algorithm:
        #
        # for each (H, W) location i
        #   generate A anchor boxes centered on cell i
        #   apply predicted bbox deltas at cell i to each of the A anchors
        # clip predicted boxes to image
        # remove predicted boxes with either height or width &lt; threshold
        # sort all (proposal, score) pairs by score from highest to lowest
        # take top pre_nms_topN proposals before NMS
        # apply NMS with threshold 0.7 to remaining proposals
        # take after_nms_topN proposals after NMS
        # return the top proposals (-&gt; RoIs top, scores top)


        # the first set of _num_anchors channels are bg probs
        # the second set are the fg probs
        scores = input[0][:, :, 1]  # batch_size x num_rois x 1
        #  0是背景分数,1是前景分数．　这里我们直接取了前景分数

        bbox_deltas = input[1]      # batch_size x num_rois x 4
        im_info = input[2]
        cfg_key = input[3]
        feat_shapes = input[4]        

        pre_nms_topN  = cfg[cfg_key].RPN_PRE_NMS_TOP_N
        post_nms_topN = cfg[cfg_key].RPN_POST_NMS_TOP_N
        nms_thresh    = cfg[cfg_key].RPN_NMS_THRESH
        min_size      = cfg[cfg_key].RPN_MIN_SIZE

        batch_size = bbox_deltas.size(0)

        anchors = torch.from_numpy(generate_anchors_all_pyramids(self._fpn_scales, self._anchor_ratios, 
                feat_shapes, self._fpn_feature_strides, self._fpn_anchor_stride)).type_as(scores)
        # 　anchors shape : [anchor_count, (y1, x1, y2, x2)] 其中anchor_count是所有scale的feature map上的anchor总和
        num_anchors = anchors.size(0)

        anchors = anchors.view(1, num_anchors, 4).expand(batch_size, num_anchors, 4)
        # Any dimension of size 1 can be expanded to an arbitrary value without allocating new memory.　
        # 所以其实是同一份anchor,为了每个batch使用,expand成了batch_size份．
        # 　先view从(num_anchors,4)变成(1,num_anchors,4)增加一个维度
        #   然后变成了(batch_size,num_anchors,4)的维度

        # Convert anchors into proposals via bbox transformations
        proposals = bbox_transform_inv(anchors, bbox_deltas, batch_size)

        # 2. clip predicted boxes to image
        proposals = clip_boxes(proposals, im_info, batch_size)
        # keep_idx = self._filter_boxes(proposals, min_size).squeeze().long().nonzero().squeeze()
                
        scores_keep = scores
        proposals_keep = proposals

        _, order = torch.sort(scores_keep, 1, True)
        # torch.sort(tensor,dim,descending)
        #  因此这里是把分数在num_rois的维度降序排列，返回(values, indices)
        # 我们要用的是indices，就是在排序前的下标
        output = scores.new(batch_size, post_nms_topN, 5).zero_()
        for i in range(batch_size):
            # # 3. remove predicted boxes with either height or width &lt; threshold
            # # (NOTE: convert min_size to input image scale stored in im_info[2])
            proposals_single = proposals_keep[i]
            scores_single = scores_keep[i]

            # # 4. sort all (proposal, score) pairs by score from highest to lowest
            # # 5. take top pre_nms_topN (e.g. 6000)
            order_single = order[i]
            # 　torch.numel() : Returns the total number of elements in the input tensor.
            if pre_nms_topN &gt; 0 and pre_nms_topN &lt; scores_keep.numel():
                order_single = order_single[:pre_nms_topN]
            # 　得到分数最高的前pre_nms_topN个的下标　

            proposals_single = proposals_single[order_single, :]
            # 从下标得到具体的proposals(就是调整过后的anchors)
            scores_single = scores_single[order_single].view(-1,1)

            # 6. apply nms (e.g. threshold = 0.7)
            # 7. take after_nms_topN (e.g. 300)
            # 8. return the top proposals (-&gt; RoIs top)

            keep_idx_i = nms(torch.cat((proposals_single, scores_single), 1), nms_thresh)
            keep_idx_i = keep_idx_i.long().view(-1)

            if post_nms_topN &gt; 0:
                keep_idx_i = keep_idx_i[:post_nms_topN]
            proposals_single = proposals_single[keep_idx_i, :]
            scores_single = scores_single[keep_idx_i, :]

            # padding 0 at the end.
            num_proposal = proposals_single.size(0)
            output[i,:,0] = i
            output[i,:num_proposal,1:] = proposals_single
            # 　output: (batch_size, post_nms_topN, 5)

        return output

</code></pre>

<p>其中　bbox_transform_inv和　clip_boxes的代码分别如下:</p>

<pre><code class="language-python">

def bbox_transform_inv(boxes, deltas, batch_size):
    # 　boxes: 　(batch_size,num_anchors,4), 4的坐标顺序为(x1, y1, x2, y2)
    # 　（原代码注释写的是　(y1,x1,y2,x2),似乎不正确）　

    # deltas: batch_size x num_rois x 4
    widths = boxes[:, :, 2] - boxes[:, :, 0] + 1.0
    heights = boxes[:, :, 3] - boxes[:, :, 1] + 1.0
    ctr_x = boxes[:, :, 0] + 0.5 * widths
    ctr_y = boxes[:, :, 1] + 0.5 * heights
    # 　widths,heights,ctr_x,ctr_y的维度都是(batch_size,num_rois)

    #  ctx是中心点坐标

    dx = deltas[:, :, 0::4]
    dy = deltas[:, :, 1::4]
    # 　dx,dy是预测得到的中心点偏移距离相对width和height的比例
    dw = deltas[:, :, 2::4]
    dh = deltas[:, :, 3::4]
    # 把　deltas的坐标展开，每一个的shape为(batch_size,num_rois,1),为了方便做向量化操作

    pred_ctr_x = dx * widths.unsqueeze(2) + ctr_x.unsqueeze(2)
    pred_ctr_y = dy * heights.unsqueeze(2) + ctr_y.unsqueeze(2)
    #  dx的维度是(batch_size,num_rois,1),widths和ctr_x的维度为(batch_size,num_rios),unsqueeze是为了做ele-wise的运算

    pred_w = torch.exp(dw) * widths.unsqueeze(2)
    pred_h = torch.exp(dh) * heights.unsqueeze(2)

    # 　按照原公式的log做了逆向运算

    pred_boxes = deltas.clone()
    # x1
    pred_boxes[:, :, 0::4] = pred_ctr_x - 0.5 * pred_w
    # y1
    pred_boxes[:, :, 1::4] = pred_ctr_y - 0.5 * pred_h
    # x2
    pred_boxes[:, :, 2::4] = pred_ctr_x + 0.5 * pred_w
    # y2
    pred_boxes[:, :, 3::4] = pred_ctr_y + 0.5 * pred_h

    # 得到的是经过　deltas修正过的anchors

    return pred_boxes

</code></pre>

<pre><code class="language-python">
def clip_boxes(boxes, im_shape, batch_size):
    #  把修正过的anchors截断到图片范围之内．　
    　
    for i in range(batch_size):
        boxes[i,:,0::4].clamp_(0, im_shape[i, 1]-1)
        boxes[i,:,1::4].clamp_(0, im_shape[i, 0]-1)
        boxes[i,:,2::4].clamp_(0, im_shape[i, 1]-1)
        boxes[i,:,3::4].clamp_(0, im_shape[i, 0]-1)

    return boxes


</code></pre>

<p><strong>这两个函数是各种对不齐的重灾区</strong></p>

<p>至此，我们得到了roi,完成了rpn和proposal 阶段</p>

<h3 id="fpn-作用于fast-rcnn">FPN 作用于fast rcnn</h3>

<p>回想faster rcnn,我们只有一个feature map,因此所有的roi都会作用在feature map上.</p>

<p>但是现在我们有多个不同scale的feature map,因此每个roi作用在哪个feature map上就是一个问题.</p>

<p>按照paper中的描述,我们不妨将这些由FPN生成的不同scale的feature map考虑成是由image pyramid 生成的.
&gt; We view our feature pyramid as if it were produced from
an image pyramid. Thus we can adapt the assignment strategy
of region-based detectors [15, 11] in the case when they
are run on image pyramids</p>

<p>那么显然,越大的roi应该是由越大scale的image得到的. 对应回我们的FPN,也就是越大的roi对应越大scale的feature map.</p>

<pre><code class="language-python">
  def _PyramidRoI_Feat(self, feat_maps, rois, im_info):
        ''' roi pool on pyramid feature maps'''
        # do roi pooling based on predicted rois
        img_area = im_info[0][0] * im_info[0][1]
        h = rois.data[:, 4] - rois.data[:, 2] + 1
        w = rois.data[:, 3] - rois.data[:, 1] + 1
        # 基于roi的scale来判断这个roi对应哪一层的feature 
        # 对于大尺度的roi,就用更深的feature map
        roi_level = torch.log(torch.sqrt(h * w) / 224.0)
        roi_level = torch.round(roi_level + 4)
        roi_level[roi_level &lt; 2] = 2
        roi_level[roi_level &gt; 5] = 5
        # 保护边界为[2,5]
        
</code></pre>

<h2 id="参考">参考</h2>

<ul>
<li><a href="https://arxiv.org/abs/1612.03144">Feature Pyramid Networks for Object Detection</a></li>
<li><a href="https://github.com/jwyang/fpn.pytorch">fpn.pytorch</a></li>
</ul>


                
                
<div class="entry-shang text-center">
    
	    <p>「真诚赞赏，手留余香」</p>
	
	<button class="zs show-zs btn btn-bred">赞赏支持</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">×</button>
		<span class="author"><a href="https://111qqz.github.io"><img src="/img/favicon.png" />111qqz的小窝</a></span>
        
	        <p class="tip"><i></i><span>真诚赞赏，手留余香</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2元</button>
			<button class="btn btn-blink" data-num="5">5元</button>
			<button class="btn btn-blink" data-num="10">10元</button>
			<button class="btn btn-blink" data-num="50">50元</button>
			<button class="btn btn-blink" data-num="100">100元</button>
			<button class="btn btn-blink" data-num="1">任意金额</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2元</button>
			<p>使用<span id="pay-type">微信</span>扫描二维码完成支付</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/12/single-short-detector" data-toggle="tooltip" data-placement="top" title="SSD: Single Shot MultiBox Detector　学习笔记">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/12/debug-faster-rcnn-once-again" data-toggle="tooltip" data-placement="top" title="记一次faster-rcnn debug记录">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>

                



<div id="git-comments"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://ihtcboy.com/script/gitment.browser.js"></script>
<script>
  var gitment = new Gitment({
    id: decodeURI(window.location.pathname),  
    owner: '111qqz',
    repo: '111qqz.github.io',
    oauth: {
      client_id: '8839ce5e58d5197e2490',
      client_secret: '2d475a8a7e27a8b509847a6c60f692b8cbaa274e',
    }
  })
  gitment.render('git-comments')
</script>


            </div>
            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/km" title="KM">
                            KM
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/bfs" title="bfs">
                            bfs
                        </a>
                        
                        
                        
                        <a href="/tags/binary-search" title="binary search">
                            binary search
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/brute-force" title="brute force">
                            brute force
                        </a>
                        
                        
                        
                        <a href="/tags/c&#43;&#43;" title="c&#43;&#43;">
                            c&#43;&#43;
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/caffe" title="caffe">
                            caffe
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/dfs" title="dfs">
                            dfs
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/dp" title="dp">
                            dp
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/greedy" title="greedy">
                            greedy
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/hash" title="hash">
                            hash
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kmp" title="kmp">
                            kmp
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/leetcode" title="leetcode">
                            leetcode
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/math" title="math">
                            math
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/number-theory" title="number theory">
                            number theory
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/rmq" title="rmq">
                            rmq
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/sg%E5%87%BD%E6%95%B0" title="sg函数">
                            sg函数
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/stl" title="stl">
                            stl
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/tensorflow" title="tensorflow">
                            tensorflow
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E4%BD%B3%E5%8C%B9%E9%85%8D" title="二分图最佳匹配">
                            二分图最佳匹配
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%88%86%E5%9D%97" title="分块">
                            分块
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%89%8D%E7%BC%80%E5%92%8C" title="前缀和">
                            前缀和
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95" title="匈牙利算法">
                            匈牙利算法
                        </a>
                        
                        
                        
                        <a href="/tags/%E5%8C%BA%E9%97%B4dp" title="区间dp">
                            区间dp
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA" title="博弈论">
                            博弈论
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA" title="后缀自动机">
                            后缀自动机
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%9B%BE%E8%AE%BA" title="图论">
                            图论
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2" title="字符串">
                            字符串
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E5%BF%AB%E9%80%9F%E5%B9%82" title="快速幂">
                            快速幂
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%95%B0%E4%BD%8Ddp" title="数位dp">
                            数位dp
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%9E%84%E9%80%A0" title="构造">
                            构造
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84" title="树状数组">
                            树状数组
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%A6%82%E7%8E%87" title="概率">
                            概率
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%A8%A1%E6%8B%9F" title="模拟">
                            模拟
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%AF%8D%E5%87%BD%E6%95%B0" title="母函数">
                            母函数
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%9F%A9%E9%98%B5" title="矩阵">
                            矩阵
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%A6%BB%E6%95%A3%E5%8C%96" title="离散化">
                            离散化
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91" title="线段树">
                            线段树
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95" title="计算几何">
                            计算几何
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://111qqz.com">111qqz的wordpress博客</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>






<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                   
                   <li>
                       <a href="" rel="alternate" type="application/rss+xml" title="111qqz的小窝" >
                           <span class="fa-stack fa-lg">
                               <i class="fa fa-circle fa-stack-2x"></i>
                               <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
                   
                    
                    <li>
                        <a href="mailto:hust.111qqz@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                    
                    

                    

		    
                    
                    <li>
                        <a target="_blank" href="/img/wechat.jpg">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-wechat fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    <li>
                        <a target="_blank" href="https://github.com/111qqz/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		    
                    
                    
                </ul>
		<p class="copyright text-muted">
                    Copyright &copy; 111qqz的小窝 2021
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    async("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






</body>
</html>
